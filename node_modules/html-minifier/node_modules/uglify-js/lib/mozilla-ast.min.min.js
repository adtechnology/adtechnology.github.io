"use strict";(function(){var ab=function(c){var a=true;for(var b=0;b<c.length;b++){if(a&&c[b] instanceof AST_Statement&&c[b].body instanceof AST_String){c[b]=new AST_Directive({start:c[b].start,end:c[b].end,value:c[b].body.value})}else{if(a&&!(c[b] instanceof AST_Statement&&c[b].body instanceof AST_String)){a=false}}}return c};var af={Program:function(a){return new AST_Toplevel({start:ao(a),end:ah(a),body:ab(a.body.map(an))})},FunctionDeclaration:function(a){return new AST_Defun({start:ao(a),end:ah(a),name:an(a.id),argnames:a.params.map(an),body:ab(an(a.body).body)})},FunctionExpression:function(a){return new AST_Function({start:ao(a),end:ah(a),name:an(a.id),argnames:a.params.map(an),body:ab(an(a.body).body)})},ExpressionStatement:function(a){return new AST_SimpleStatement({start:ao(a),end:ah(a),body:an(a.expression)})},TryStatement:function(a){var b=a.handlers||[a.handler];if(b.length>1||a.guardedHandlers&&a.guardedHandlers.length){throw new Error("Multiple catch clauses are not supported.")}return new AST_Try({start:ao(a),end:ah(a),body:an(a.block).body,bcatch:an(b[0]),bfinally:a.finalizer?new AST_Finally(an(a.finalizer)):null})},Property:function(a){var b=a.key;var c={start:ao(b),end:ah(a.value),key:b.type=="Identifier"?b.name:b.value,value:an(a.value)};if(a.kind=="init"){return new AST_ObjectKeyVal(c)}c.key=new AST_SymbolAccessor({name:c.key});c.value=new AST_Accessor(c.value);if(a.kind=="get"){return new AST_ObjectGetter(c)}if(a.kind=="set"){return new AST_ObjectSetter(c)}},ArrayExpression:function(a){return new AST_Array({start:ao(a),end:ah(a),elements:a.elements.map(function(b){return b===null?new AST_Hole():an(b)})})},ObjectExpression:function(a){return new AST_Object({start:ao(a),end:ah(a),properties:a.properties.map(function(b){b.type="Property";return an(b)})})},SequenceExpression:function(a){return new AST_Sequence({start:ao(a),end:ah(a),expressions:a.expressions.map(an)})},MemberExpression:function(a){return new (a.computed?AST_Sub:AST_Dot)({start:ao(a),end:ah(a),property:a.computed?an(a.property):a.property.name,expression:an(a.object)})},SwitchCase:function(a){return new (a.test?AST_Case:AST_Default)({start:ao(a),end:ah(a),expression:an(a.test),body:a.consequent.map(an)})},VariableDeclaration:function(a){return new AST_Var({start:ao(a),end:ah(a),definitions:a.declarations.map(an)})},Literal:function(a){var b=a.value,d={start:ao(a),end:ah(a)};if(b===null){return new AST_Null(d)}var c=a.regex;if(c&&c.pattern){d.value=new RegExp(c.pattern,c.flags);d.value.raw_source=c.pattern;return new AST_RegExp(d)}else{if(c){d.value=a.regex&&a.raw?a.raw:b;return new AST_RegExp(d)}}switch(typeof b){case"string":d.value=b;return new AST_String(d);case"number":d.value=b;return new AST_Number(d);case"boolean":return new (b?AST_True:AST_False)(d)}},Identifier:function(a){var b=T[T.length-2];return new (b.type=="LabeledStatement"?AST_Label:b.type=="VariableDeclarator"&&b.id===a?AST_SymbolVar:b.type=="FunctionExpression"?(b.id===a?AST_SymbolLambda:AST_SymbolFunarg):b.type=="FunctionDeclaration"?(b.id===a?AST_SymbolDefun:AST_SymbolFunarg):b.type=="CatchClause"?AST_SymbolCatch:b.type=="BreakStatement"||b.type=="ContinueStatement"?AST_LabelRef:AST_SymbolRef)({start:ao(a),end:ah(a),name:a.name})}};af.UpdateExpression=af.UnaryExpression=function am(a){var b="prefix" in a?a.prefix:a.type=="UnaryExpression"?true:false;return new (b?AST_UnaryPrefix:AST_UnaryPostfix)({start:ao(a),end:ah(a),operator:a.operator,expression:an(a.argument)})};P("EmptyStatement",AST_EmptyStatement);P("BlockStatement",AST_BlockStatement,"body@body");P("IfStatement",AST_If,"test>condition, consequent>body, alternate>alternative");P("LabeledStatement",AST_LabeledStatement,"label>label, body>body");P("BreakStatement",AST_Break,"label>label");P("ContinueStatement",AST_Continue,"label>label");P("WithStatement",AST_With,"object>expression, body>body");P("SwitchStatement",AST_Switch,"discriminant>expression, cases@body");P("ReturnStatement",AST_Return,"argument>value");P("ThrowStatement",AST_Throw,"argument>value");P("WhileStatement",AST_While,"test>condition, body>body");P("DoWhileStatement",AST_Do,"test>condition, body>body");P("ForStatement",AST_For,"init>init, test>condition, update>step, body>body");P("ForInStatement",AST_ForIn,"left>init, right>object, body>body");P("DebuggerStatement",AST_Debugger);P("VariableDeclarator",AST_VarDef,"id>name, init>value");P("CatchClause",AST_Catch,"param>argname, body%body");P("ThisExpression",AST_This);P("BinaryExpression",AST_Binary,"operator=operator, left>left, right>right");P("LogicalExpression",AST_Binary,"operator=operator, left>left, right>right");P("AssignmentExpression",AST_Assign,"operator=operator, left>left, right>right");P("ConditionalExpression",AST_Conditional,"test>condition, consequent>consequent, alternate>alternative");P("NewExpression",AST_New,"callee>expression, arguments@args");P("CallExpression",AST_Call,"callee>expression, arguments@args");ai(AST_Toplevel,function V(a){return L("Program",a)});ai(AST_Defun,function S(a){return{type:"FunctionDeclaration",id:X(a.name),params:a.argnames.map(X),body:L("BlockStatement",a)}});ai(AST_Function,function ae(a){return{type:"FunctionExpression",id:X(a.name),params:a.argnames.map(X),body:L("BlockStatement",a)}});ai(AST_Directive,function ac(a){return{type:"ExpressionStatement",expression:{type:"Literal",value:a.value}}});ai(AST_SimpleStatement,function ag(a){return{type:"ExpressionStatement",expression:X(a.body)}});ai(AST_SwitchBranch,function aa(a){return{type:"SwitchCase",test:X(a.expression),consequent:a.body.map(X)}});ai(AST_Try,function W(a){return{type:"TryStatement",block:N(a),handler:X(a.bcatch),guardedHandlers:[],finalizer:X(a.bfinally)}});ai(AST_Catch,function Y(a){return{type:"CatchClause",param:X(a.argname),guard:null,body:N(a)}});ai(AST_Definitions,function al(a){return{type:"VariableDeclaration",kind:"var",declarations:a.definitions.map(X)}});ai(AST_Sequence,function ad(a){return{type:"SequenceExpression",expressions:a.expressions.map(X)}});ai(AST_PropAccess,function Q(a){var b=a instanceof AST_Sub;return{type:"MemberExpression",object:X(a.expression),computed:b,property:b?X(a.property):{type:"Identifier",name:a.property}}});ai(AST_Unary,function am(a){return{type:a.operator=="++"||a.operator=="--"?"UpdateExpression":"UnaryExpression",operator:a.operator,prefix:a instanceof AST_UnaryPrefix,argument:X(a.expression)}});ai(AST_Binary,function aj(a){return{type:a.operator=="&&"||a.operator=="||"?"LogicalExpression":"BinaryExpression",left:X(a.left),operator:a.operator,right:X(a.right)}});ai(AST_Array,function ak(a){return{type:"ArrayExpression",elements:a.elements.map(X)}});ai(AST_Object,function O(a){return{type:"ObjectExpression",properties:a.properties.map(X)}});ai(AST_ObjectProperty,function ap(a){var c={type:"Literal",value:a.key instanceof AST_SymbolAccessor?a.key.name:a.key};var b;if(a instanceof AST_ObjectKeyVal){b="init"}else{if(a instanceof AST_ObjectGetter){b="get"}else{if(a instanceof AST_ObjectSetter){b="set"}}}return{type:"Property",kind:b,key:c,value:X(a.value)}});ai(AST_Symbol,function U(a){var b=a.definition();return{type:"Identifier",name:b?b.mangled_name||b.name:a.name}});ai(AST_RegExp,function Z(a){var c=a.value.toString().match(/[gimuy]*$/)[0];var b="/"+a.value.raw_source+"/"+c;return{type:"Literal",value:b,raw:b,regex:{pattern:a.value.raw_source,flags:c}}});ai(AST_Constant,function J(a){var b=a.value;if(typeof b==="number"&&(b<0||(b===0&&1/b<0))){return{type:"UnaryExpression",operator:"-",prefix:true,argument:{type:"Literal",value:-b,raw:a.start.raw}}}return{type:"Literal",value:b,raw:a.start.raw}});ai(AST_Atom,function I(a){return{type:"Identifier",name:String(a.value)}});AST_Boolean.DEFMETHOD("to_mozilla_ast",AST_Constant.prototype.to_mozilla_ast);AST_Null.DEFMETHOD("to_mozilla_ast",AST_Constant.prototype.to_mozilla_ast);AST_Hole.DEFMETHOD("to_mozilla_ast",function K(){return null});AST_Block.DEFMETHOD("to_mozilla_ast",AST_BlockStatement.prototype.to_mozilla_ast);AST_Lambda.DEFMETHOD("to_mozilla_ast",AST_Function.prototype.to_mozilla_ast);function M(a){if(a.type=="Literal"){return a.raw!=null?a.raw:a.value+""}}function ao(c){var b=c.loc,a=b&&b.start;var d=c.range;return new AST_Token({file:b&&b.source,line:a&&a.line,col:a&&a.column,pos:d?d[0]:c.start,endline:a&&a.line,endcol:a&&a.column,endpos:d?d[0]:c.start,raw:M(c)})}function ah(b){var a=b.loc,d=a&&a.end;var c=b.range;return new AST_Token({file:a&&a.source,line:d&&d.line,col:d&&d.column,pos:c?c[1]:b.end,endline:d&&d.line,endcol:d&&d.column,endpos:c?c[1]:b.end,raw:M(b)})}function P(d,a,c){var b="function From_Moz_"+d+"(M){\n";b+="return new U2."+a.name+"({\nstart: my_start_token(M),\nend: my_end_token(M)";var e="function To_Moz_"+d+"(M){\n";e+="return {\ntype: "+JSON.stringify(d);if(c){c.split(/\s*,\s*/).forEach(function(f){var j=/([a-z0-9$_]+)(=|@|>|%)([a-z0-9$_]+)/i.exec(f);if(!j){throw new Error("Can't understand property map: "+f)}var i=j[1],h=j[2],g=j[3];b+=",\n"+g+": ";e+=",\n"+i+": ";switch(h){case"@":b+="M."+i+".map(from_moz)";e+="M."+g+".map(to_moz)";break;case">":b+="from_moz(M."+i+")";e+="to_moz(M."+g+")";break;case"=":b+="M."+i;e+="M."+g;break;case"%":b+="from_moz(M."+i+").body";e+="to_moz_block(M)";break;default:throw new Error("Can't understand operator in propmap: "+f)}})}b+="\n})\n}";e+="\n}\n}";b=new Function("U2","my_start_token","my_end_token","from_moz","return("+b+")")(exports,ao,ah,an);e=new Function("to_moz","to_moz_block","to_moz_scope","return("+e+")")(X,N,L);af[d]=b;ai(a,e)}var T=null;function an(a){T.push(a);var b=a!=null?af[a.type](a):null;T.pop();return b}AST_Node.from_mozilla_ast=function(b){var a=T;T=[];var c=an(b);T=a;c.walk(new TreeWalker(function(f){if(f instanceof AST_LabelRef){for(var e=0,g;g=this.parent(e);e++){if(g instanceof AST_Scope){break}if(g instanceof AST_LabeledStatement&&g.label.name==f.name){f.thedef=g.label;break}}if(!f.thedef){var d=f.start;js_error("Undefined label "+f.name,d.file,d.line,d.col,d.pos)}}}));return c};function R(b,c,e){var a=b.start;var d=b.end;if(a.pos!=null&&d.endpos!=null){c.range=[a.pos,d.endpos]}if(a.line){c.loc={start:{line:a.line,column:a.col},end:d.endline?{line:d.endline,column:d.endcol}:null};if(a.file){c.loc.source=a.file}}return c}function ai(a,b){a.DEFMETHOD("to_mozilla_ast",function(){return R(this,b(this))})}function X(a){return a!=null?a.to_mozilla_ast():null}function N(a){return{type:"BlockStatement",body:a.body.map(X)}}function L(b,a){var c=a.body.map(X);if(a.body[0] instanceof AST_SimpleStatement&&a.body[0].body instanceof AST_String){c.unshift(X(new AST_EmptyStatement(a.body[0])))}return{type:b,body:c}}})();