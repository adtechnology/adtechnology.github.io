"use strict";function Compressor(p,l){if(!(this instanceof Compressor)){return new Compressor(p,l)}TreeTransformer.call(this,this.before,this.after);this.options=defaults(p,{arguments:!l,booleans:!l,collapse_vars:!l,comparisons:!l,conditionals:!l,dead_code:!l,drop_console:false,drop_debugger:!l,evaluate:!l,expression:false,global_defs:{},hoist_funs:false,hoist_props:!l,hoist_vars:false,ie8:false,if_return:!l,inline:!l,join_vars:!l,keep_fargs:true,keep_fnames:false,keep_infinity:false,loops:!l,negate_iife:!l,passes:1,properties:!l,pure_getters:!l&&"strict",pure_funcs:null,reduce_funcs:!l,reduce_vars:!l,sequences:!l,side_effects:!l,switches:!l,top_retain:null,toplevel:!!(p&&p.top_retain),typeofs:!l,unsafe:false,unsafe_comps:false,unsafe_Function:false,unsafe_math:false,unsafe_proto:false,unsafe_regexp:false,unsafe_undefined:false,unused:!l,warnings:false},true);var j=this.options.global_defs;if(typeof j=="object"){for(var o in j){if(/^@/.test(o)&&HOP(j,o)){j[o.slice(1)]=parse(j[o],{expression:true})}}}if(this.options.inline===true){this.options.inline=3}var m=this.options.pure_funcs;if(typeof m=="function"){this.pure_funcs=m}else{this.pure_funcs=m?function(a){return m.indexOf(a.expression.print_to_string())<0}:return_true}var i=this.options.top_retain;if(i instanceof RegExp){this.top_retain=function(a){return i.test(a.name)}}else{if(typeof i=="function"){this.top_retain=i}else{if(i){if(typeof i=="string"){i=i.split(/,/)}this.top_retain=function(a){return i.indexOf(a.name)>=0}}}}var n=this.options.toplevel;this.toplevel=typeof n=="string"?{funcs:/funcs/.test(n),vars:/vars/.test(n)}:{funcs:n,vars:n};var k=this.options.sequences;this.sequences_limit=k==1?800:k|0;this.warnings_produced={}}Compressor.prototype=new TreeTransformer;merge(Compressor.prototype,{option:function(b){return this.options[b]},exposed:function(f){if(f.global){for(var d=0,e=f.orig.length;d<e;d++){if(!this.toplevel[f.orig[d] instanceof AST_SymbolDefun?"funcs":"vars"]){return true}}}return false},compress:function(k){if(this.option("expression")){k.process_expression(true)}var l=+this.options.passes||1;var i=1/0;var j=false;var h={ie8:this.option("ie8")};for(var m=0;m<l;m++){k.figure_out_scope(h);if(m>0||this.option("reduce_vars")){k.reset_opt_flags(this)}k=k.transform(this);if(l>1){var n=0;k.walk(new TreeWalker(function(){n++}));this.info("pass "+m+": last_count: "+i+", count: "+n);if(n<i){i=n;j=false}else{if(j){break}else{j=true}}}}if(this.option("expression")){k.process_expression(false)}return k},info:function(){if(this.options.warnings=="verbose"){AST_Node.warn.apply(AST_Node,arguments)}},warn:function(f,e){if(this.options.warnings){var d=string_template(f,e);if(!(d in this.warnings_produced)){this.warnings_produced[d]=true;AST_Node.warn.apply(AST_Node,arguments)}}},clear_warnings:function(){this.warnings_produced={}},before:function(i,f,j){if(i._squeezed){return i}var h=false;if(i instanceof AST_Scope){i=i.hoist_properties(this);i=i.hoist_declarations(this);h=true}f(i,this);f(i,this);var g=i.optimize(this);if(h&&g instanceof AST_Scope){g.drop_unused(this);f(g,this)}if(g===i){g._squeezed=true}return g}});(function(){function X(a,b){a.DEFMETHOD("optimize",function(e){var d=this;if(d._optimized){return d}if(e.has_directive("use asm")){return d}var c=b(d,e);c._optimized=true;return c})}X(AST_Node,function(b,a){return b});AST_Node.DEFMETHOD("equivalent_to",function(a){return this.TYPE==a.TYPE&&this.print_to_string()==a.print_to_string()});AST_Scope.DEFMETHOD("process_expression",function(b,a){var d=this;var c=new TreeTransformer(function(f){if(b&&f instanceof AST_SimpleStatement){return aK(AST_Return,f,{value:f.body})}if(!b&&f instanceof AST_Return){if(a){var e=f.value&&f.value.drop_side_effect_free(a,true);return e?aK(AST_SimpleStatement,f,{body:e}):aK(AST_EmptyStatement,f)}return aK(AST_SimpleStatement,f,{body:f.value||aK(AST_UnaryPrefix,f,{operator:"void",expression:aK(AST_Number,f,{value:0})})})}if(f instanceof AST_Lambda&&f!==d){return f}if(f instanceof AST_Block){var g=f.body.length-1;if(g>=0){f.body[g]=f.body[g].transform(c)}}else{if(f instanceof AST_If){f.body=f.body.transform(c);if(f.alternative){f.alternative=f.alternative.transform(c)}}else{if(f instanceof AST_With){f.body=f.body.transform(c)}}}return f});d.transform(c)});function ae(f,c){c=V(c);if(c instanceof AST_Node){return}var g;if(f instanceof AST_Array){var a=f.elements;if(c=="length"){return ap(a.length,f)}if(typeof c=="number"&&c in a){g=a[c]}}else{if(f instanceof AST_Object){c=""+c;var b=f.properties;for(var d=b.length;--d>=0;){var e=b[d];if(!(e instanceof AST_ObjectKeyVal)){return}if(!g&&b[d].key===c){g=b[d].value}}}}return g instanceof AST_SymbolRef&&g.fixed_value()||g}function an(c,b,f,j,g,a){var i=b.parent(g);var e=aI(f,i);if(e){return e}if(!a&&i instanceof AST_Call&&i.expression===f&&!i.is_expr_pure(c)&&(!(j instanceof AST_Function)||!(i instanceof AST_New)&&j.contains_this())){return true}if(i instanceof AST_Array){return an(c,b,i,i,g+1)}if(i instanceof AST_ObjectKeyVal&&f===i.value){var d=b.parent(g+1);return an(c,b,d,d,g+2)}if(i instanceof AST_PropAccess&&i.expression===f){var h=ae(j,i.property);return !a&&an(c,b,i,h,g+1)}}(function(f){f(AST_Node,noop);function k(p,q,o){o.assignments=0;o.chained=false;o.direct_access=false;o.escaped=false;if(o.scope.pinned()){o.fixed=false}else{if(!q.exposed(o)){o.fixed=o.init}else{o.fixed=false}}if(o.fixed instanceof AST_Defun&&!all(o.references,function(r){var s=r.scope;do{if(o.scope===s){return true}}while(s instanceof AST_Function&&(s=s.parent_scope))})){p.defun_ids[o.id]=false}o.recursive_refs=0;o.references=[];o.should_replace=undefined;o.single_use=undefined}function n(p,q,o){o.variables.each(function(r){k(p,q,r);if(r.fixed===null){r.safe_ids=p.safe_ids;c(p,r,true)}else{if(r.fixed){p.loop_ids[r.id]=p.in_loop;c(p,r,true)}}});o.may_call_this=function(){o.may_call_this=noop;if(!o.contains_this()){return}o.functions.each(function(r){if(r.init instanceof AST_Defun&&!(r.id in p.defun_ids)){p.defun_ids[r.id]=false}})}}function g(r,q){if(q.id in r.defun_ids){var o=r.defun_ids[q.id];if(!o){return}var p=r.defun_visited[q.id];if(o===r.safe_ids){if(!p){return q.fixed}}else{if(p){q.init.enclosed.forEach(function(s){if(q.init.variables.get(s.name)===s){return}if(!m(r,s)){s.fixed=false}})}else{r.defun_ids[q.id]=false}}}else{if(!r.in_loop){r.defun_ids[q.id]=r.safe_ids;return q.fixed}r.defun_ids[q.id]=false}}function d(p,o){o.functions.each(function(q){if(q.init instanceof AST_Defun&&!p.defun_visited[q.id]){p.defun_ids[q.id]=p.safe_ids;q.init.walk(p)}})}function l(o){o.safe_ids=Object.create(o.safe_ids)}function i(o){o.safe_ids=Object.getPrototypeOf(o.safe_ids)}function c(p,q,o){p.safe_ids[q.id]=o}function m(p,o){if(p.safe_ids[o.id]){if(o.fixed==null){var q=o.orig[0];if(q instanceof AST_SymbolFunarg||q.name=="arguments"){return false}o.fixed=aK(AST_Undefined,q)}return true}return o.fixed instanceof AST_Defun}function a(p,q,o,r){if(q.fixed===undefined){return true}if(q.fixed===null&&q.safe_ids){q.safe_ids[q.id]=false;delete q.safe_ids;return true}if(!HOP(p.safe_ids,q.id)){return false}if(!m(p,q)){return false}if(q.fixed===false){return false}if(q.fixed!=null&&(!r||q.references.length>q.assignments)){return false}if(q.fixed instanceof AST_Defun){return r instanceof AST_Node&&q.fixed.parent_scope===o}return all(q.orig,function(s){return !(s instanceof AST_SymbolDefun||s instanceof AST_SymbolLambda)})}function b(p,q,o){return q.option("unused")&&!o.scope.pinned()&&o.references.length-o.recursive_refs==1&&p.loop_ids[o.id]===p.in_loop}function j(o){if(!o){return false}return o.is_constant()||o instanceof AST_Lambda||o instanceof AST_This}function e(s,r,o,v,q,w,t){var p=s.parent(w);if(q&&q.is_constant()){return}if(p instanceof AST_Assign&&p.operator=="="&&v===p.right||p instanceof AST_Call&&(v!==p.expression||p instanceof AST_New)||p instanceof AST_Exit&&v===p.value&&v.scope!==r.scope||p instanceof AST_VarDef&&v===p.value){if(t>1&&!(q&&q.is_constant_expression(o))){t=1}if(!r.escaped||r.escaped>t){r.escaped=t}return}else{if(p instanceof AST_Array||p instanceof AST_Binary&&aD[p.operator]||p instanceof AST_Conditional&&v!==p.condition||p instanceof AST_Sequence&&v===p.tail_node()){e(s,r,o,p,p,w+1,t)}else{if(p instanceof AST_ObjectKeyVal&&v===p.value){var u=s.parent(w+1);e(s,r,o,u,u,w+2,t)}else{if(p instanceof AST_PropAccess&&v===p.expression){q=ae(q,p.property);e(s,r,o,p,q,w+1,t+1);if(q){return}}}}}if(w>0){return}if(p instanceof AST_Sequence&&v!==p.tail_node()){return}if(p instanceof AST_SimpleStatement){return}r.direct_access=true}var h=new TreeWalker(function(p){if(!(p instanceof AST_Symbol)){return}var o=p.definition();if(!o){return}if(p instanceof AST_SymbolRef){o.references.push(p)}o.fixed=false});f(AST_Accessor,function(p,o,q){l(p);n(p,q,this);o();i(p);d(p,this);return true});f(AST_Assign,function(s,q,t){var v=this;var w=v.left;if(!(w instanceof AST_SymbolRef)){return}var r=w.definition();var u=r.fixed;if(!u&&v.operator!="="){return}if(!a(s,r,w.scope,v.right)){return}var o=v.operator=="=";var p=o?v.right:v;if(an(t,s,v,p,0)){return}r.references.push(w);r.assignments++;if(!o){r.chained=true}r.fixed=o?function(){return v.right}:function(){return aK(AST_Binary,v,{operator:v.operator.slice(0,-1),left:u instanceof AST_Node?u:u(),right:v.right})};c(s,r,false);v.right.walk(s);c(s,r,true);e(s,r,w.scope,v,p,0,1);return true});f(AST_Binary,function(o){if(!aD[this.operator]){return}this.left.walk(o);l(o);this.right.walk(o);i(o);return true});f(AST_Call,function(o,s){o.find_parent(AST_Scope).may_call_this();var q=this.expression;if(!(q instanceof AST_SymbolRef)){return}var r=q.definition();if(!(r.fixed instanceof AST_Defun)){return}var p=g(o,r);if(!p){return}s();p.walk(o);return true});f(AST_Case,function(o){l(o);this.expression.walk(o);i(o);l(o);walk_body(this,o);i(o);return true});f(AST_Conditional,function(o){this.condition.walk(o);l(o);this.consequent.walk(o);i(o);l(o);this.alternative.walk(o);i(o);return true});f(AST_Default,function(p,o){l(p);o();i(p);return true});f(AST_Defun,function(p,o,q){var r=this.name.definition().id;if(p.defun_visited[r]){return true}if(p.defun_ids[r]!==p.safe_ids){return true}p.defun_visited[r]=true;this.inlined=false;l(p);n(p,q,this);o();i(p);d(p,this);return true});f(AST_Do,function(p){var o=p.in_loop;p.in_loop=this;l(p);this.body.walk(p);if(ag(this)){i(p);l(p)}this.condition.walk(p);i(p);p.in_loop=o;return true});f(AST_For,function(p){if(this.init){this.init.walk(p)}var o=p.in_loop;p.in_loop=this;l(p);if(this.condition){this.condition.walk(p)}this.body.walk(p);if(this.step){if(ag(this)){i(p);l(p)}this.step.walk(p)}i(p);p.in_loop=o;return true});f(AST_ForIn,function(p){this.init.walk(h);this.object.walk(p);var o=p.in_loop;p.in_loop=this;l(p);this.body.walk(p);i(p);p.in_loop=o;return true});f(AST_Function,function(p,s,q){var r=this;r.inlined=false;l(p);n(p,q,r);var o;if(!r.name&&(o=p.parent()) instanceof AST_Call&&o.expression===r){r.argnames.forEach(function(v,u){var t=v.definition();if(!r.uses_arguments&&t.fixed===undefined){t.fixed=function(){return o.args[u]||aK(AST_Undefined,o)};p.loop_ids[t.id]=p.in_loop;c(p,t,true)}else{t.fixed=false}})}s();i(p);d(p,r);return true});f(AST_If,function(o){this.condition.walk(o);l(o);this.body.walk(o);i(o);if(this.alternative){l(o);this.alternative.walk(o);i(o)}return true});f(AST_LabeledStatement,function(o){l(o);this.body.walk(o);i(o);return true});f(AST_SymbolCatch,function(){this.definition().fixed=false});f(AST_SymbolRef,function(o,t,q){var r=this.definition();r.references.push(this);if(r.references.length==1&&!r.fixed&&r.orig[0] instanceof AST_SymbolDefun){o.loop_ids[r.id]=o.in_loop}var s;if(r.fixed===undefined||!m(o,r)||r.single_use=="m"){r.fixed=false}else{if(r.fixed){s=this.fixed_value();if(s instanceof AST_Lambda&&ai(o,r)){r.recursive_refs++}else{if(s&&b(o,q,r)){r.single_use=s instanceof AST_Lambda&&!s.pinned()||r.scope===this.scope&&s.is_constant_expression()}else{r.single_use=false}}if(an(q,o,this,s,0,j(s))){if(r.single_use){r.single_use="m"}else{r.fixed=false}}}}e(o,r,this.scope,this,s,0,1);var u;if(r.fixed instanceof AST_Defun&&!((u=o.parent()) instanceof AST_Call&&u.expression===this)){var p=g(o,r);if(p){p.walk(o)}}});f(AST_Toplevel,function(p,o,q){this.globals.each(function(r){k(p,q,r)});l(p);n(p,q,this);o();i(p);d(p,this);return true});f(AST_Try,function(o){l(o);walk_body(this,o);i(o);if(this.bcatch){l(o);this.bcatch.walk(o);i(o)}if(this.bfinally){this.bfinally.walk(o)}return true});f(AST_Unary,function(p,o){var s=this;if(s.operator!="++"&&s.operator!="--"){return}var q=s.expression;if(!(q instanceof AST_SymbolRef)){return}var r=q.definition();var t=r.fixed;if(!t){return}if(!a(p,r,q.scope,true)){return}r.references.push(q);r.assignments++;r.chained=true;r.fixed=function(){return aK(AST_Binary,s,{operator:s.operator.slice(0,-1),left:aK(AST_UnaryPrefix,s,{operator:"+",expression:t instanceof AST_Node?t:t()}),right:aK(AST_Number,s,{value:1})})};c(p,r,true);return true});f(AST_VarDef,function(p,o){var r=this;var q=r.name.definition();if(r.value){if(a(p,q,r.name.scope,r.value)){q.fixed=function(){return r.value};p.loop_ids[q.id]=p.in_loop;c(p,q,false);o();c(p,q,true);return true}else{q.fixed=false}}});f(AST_While,function(p,q){var o=p.in_loop;p.in_loop=this;l(p);q();i(p);p.in_loop=o;return true})})(function(a,b){a.DEFMETHOD("reduce_vars",b)});AST_Toplevel.DEFMETHOD("reset_opt_flags",function(a){var b=new TreeWalker(a.option("reduce_vars")?function(c,d){c._squeezed=false;c._optimized=false;return c.reduce_vars(b,d,a)}:function(c){c._squeezed=false;c._optimized=false});b.defun_ids=Object.create(null);b.defun_visited=Object.create(null);b.in_loop=null;b.loop_ids=Object.create(null);b.safe_ids=Object.create(null);this.walk(b)});AST_Symbol.DEFMETHOD("fixed_value",function(){var a=this.definition().fixed;if(!a||a instanceof AST_Node){return a}return a()});AST_SymbolRef.DEFMETHOD("is_immutable",function(){var a=this.definition().orig;return a.length==1&&a[0] instanceof AST_SymbolLambda});function Y(a){if(a instanceof AST_This){return true}if(a instanceof AST_SymbolRef){return a.definition().orig[0] instanceof AST_SymbolLambda}if(a instanceof AST_PropAccess){a=a.expression;if(a instanceof AST_SymbolRef){if(a.is_immutable()){return false}a=a.fixed_value()}if(!a){return true}if(a.is_constant()){return true}return Y(a)}return false}function aF(a,d){var b,c=0;while(b=a.parent(c++)){if(b instanceof AST_Scope){break}if(b instanceof AST_Catch){b=b.argname.definition().scope;break}}return b.find_variable(d)}function aK(b,a,c){if(!c){c={}}if(a){if(!c.start){c.start=a.start}if(!c.end){c.end=a.end}}return new b(c)}function ad(a,b){if(b.length==1){return b[0]}return aK(AST_Sequence,a,{expressions:b.reduce(aJ,[])})}function ap(b,a){switch(typeof b){case"string":return aK(AST_String,a,{value:b});case"number":if(isNaN(b)){return aK(AST_NaN,a)}if(isFinite(b)){return 1/b<0?aK(AST_UnaryPrefix,a,{operator:"-",expression:aK(AST_Number,a,{value:-b})}):aK(AST_Number,a,{value:b})}return b<0?aK(AST_UnaryPrefix,a,{operator:"-",expression:aK(AST_Infinity,a)}):aK(AST_Infinity,a);case"boolean":return aK(b?AST_True:AST_False,a);case"undefined":return aK(AST_Undefined,a);default:if(b===null){return aK(AST_Null,a,{value:null})}if(b instanceof RegExp){return aK(AST_RegExp,a,{value:b})}throw new Error(string_template("Can't handle constant of type: {type}",{type:typeof b}))}}function ax(a,b){return b instanceof AST_PropAccess||a.has_directive("use strict")&&ac(b)&&b.name=="eval"}function aH(a,d,b,c){if(d instanceof AST_UnaryPrefix&&d.operator=="delete"||d.TYPE=="Call"&&d.expression===b&&ax(a,c)){return ad(b,[aK(AST_Number,b,{value:0}),c])}return c}function aJ(a,b){if(b instanceof AST_Sequence){a.push.apply(a,b.expressions)}else{a.push(b)}return a}function aj(a){if(a===null){return[]}if(a instanceof AST_BlockStatement){return a.body}if(a instanceof AST_EmptyStatement){return[]}if(a instanceof AST_Statement){return[a]}throw new Error("Can't convert thing to statement array")}function ao(a){if(a===null){return true}if(a instanceof AST_EmptyStatement){return true}if(a instanceof AST_BlockStatement){return a.body.length==0}return false}function az(a){if(a instanceof AST_IterationStatement){return a.body instanceof AST_BlockStatement?a.body:a}return a}function aA(a){while(a instanceof AST_PropAccess){a=a.expression}return a}function W(a){if(a.TYPE!="Call"){return false}return a.expression instanceof AST_Function||W(a.expression)}function ac(a){return a instanceof AST_SymbolRef&&a.definition().undeclared}var ay=makePredicate("Array Boolean clearInterval clearTimeout console Date decodeURI decodeURIComponent encodeURI encodeURIComponent Error escape eval EvalError Function isFinite isNaN JSON Math Number parseFloat parseInt RangeError ReferenceError RegExp Object setInterval setTimeout String SyntaxError TypeError unescape URIError");AST_SymbolRef.DEFMETHOD("is_declared",function(a){return !this.definition().undeclared||a.option("unsafe")&&ay[this.name]});var at=makePredicate("Infinity NaN undefined");function au(a){return a instanceof AST_Infinity||a instanceof AST_NaN||a instanceof AST_Undefined}function am(k,p){var l,c,e;b();var j,a=10;do{j=false;m(k);if(p.option("dead_code")){h(k,p)}if(p.option("if_return")){r(k,p)}if(p.sequences_limit>0){q(k,p);s(k,p)}if(p.option("join_vars")){g(k)}if(p.option("collapse_vars")){f(k,p)}}while(j&&a-->0);function b(){var u=p.self(),t=0;do{if(u instanceof AST_Catch||u instanceof AST_Finally){t++}else{if(u instanceof AST_IterationStatement){l=true}else{if(u instanceof AST_Scope){e=u;break}else{if(u instanceof AST_Try){c=true}}}}}while(u=p.parent(t++))}function f(B,aW){if(e.pinned()){return B}var K;var L=[];var I=B.length;var C=new TreeTransformer(function(a3){if(aQ){return a3}if(!aO){if(a3!==aX[aP]){return a3}aP++;if(aP<aX.length){return be(a3)}aO=true;E=bf(a3,0);if(E===a3){aQ=true}return a3}var a4=C.parent();if(aN(a3,a4)){aQ=true;return a3}if(!aS&&aY(a3,a4)){aS=a4}var a0,a1;if(z&&!(a3 instanceof AST_SymbolDeclaration)&&(S&&(a0=aU.equivalent_to(a3))||G&&(a1=G(a3,this)))){if(aS&&(a1||!y||!F)){aQ=true;return a3}if(aI(a3,a4)){if(u){M++}return a3}else{M++;if(u&&H instanceof AST_VarDef){return a3}}j=aQ=true;aW.info("Collapsing {name} [{file}:{line},{col}]",{name:a3.print_to_string(),file:a3.start.file,line:a3.start.line,col:a3.start.col});if(H instanceof AST_UnaryPostfix){return aK(AST_UnaryPrefix,H,H)}if(H instanceof AST_VarDef){var a2=H.name.definition();if(a2.references.length-a2.replaced==1&&!aW.exposed(a2)){a2.replaced++;return aH(aW,a4,a3,H.value)}return aK(AST_Assign,H,{operator:"=",left:aK(AST_SymbolRef,H.name,H.name),right:H.value})}H.write_only=false;return H}var a5;if(bi(a3,a4)||Q(a3)){E=a3;if(a3 instanceof AST_Scope){aQ=true}}return be(a3)},function(a0){if(aQ){return}if(E===a0){aQ=true}if(aS===a0){aS=null}});var aZ=new TreeTransformer(function(a0){if(aQ){return a0}if(!aO){if(a0!==aX[aP]){return a0}aP++;if(aP<aX.length){return}aO=true;return a0}if(a0 instanceof AST_SymbolRef&&a0.name==aR.name){if(!--M){aQ=true}if(aI(a0,aZ.parent())){return a0}aR.replaced++;u.replaced--;return H.value.clone()}if(a0 instanceof AST_Default||a0 instanceof AST_Scope){return a0}});while(--I>=0){if(I==0&&aW.option("unused")){bn()}var aX=[];bg(B[I]);while(L.length>0){aX=L.pop();var aP=0;var H=aX[aX.length-1];var u=null;var E=null;var aS=null;var aU=bp(H);var P=t(H);var bo=aU&&aU.has_side_effects(aW);var S=aU&&!bo&&!Y(aU);var G=P&&J(P);if(!S&&!G){continue}var w=D(H);var y=N(aU);if(!bo){bo=aT(H)}var F=O();var Q=H.may_throw(aW)?c?function(a0){return a0.has_side_effects(aW)}:A:return_false;var v=H.name instanceof AST_SymbolFunarg;var aO=v;var aQ=false,M=0,z=!K||!aO;if(!z){for(var bk=aW.self().argnames.lastIndexOf(H.name)+1;!aQ&&bk<K.length;bk++){K[bk].transform(C)}z=true}for(var bj=I;!aQ&&bj<B.length;bj++){B[bj].transform(C)}if(u){var aR=H.name.definition();if(aQ&&aR.references.length-aR.replaced>M){M=false}else{aQ=false;aP=0;aO=v;for(var bj=I;!aQ&&bj<B.length;bj++){B[bj].transform(aZ)}u.single_use=false}}if(M&&!bm(H)){B.splice(I,1)}}}function be(a0){if(a0 instanceof AST_Scope){return a0}if(a0 instanceof AST_Switch){a0.expression=a0.expression.transform(C);for(var a2=0,a3=a0.body.length;!aQ&&a2<a3;a2++){var a1=a0.body[a2];if(a1 instanceof AST_Case){if(!aO){if(a1!==aX[aP]){continue}aP++}a1.expression=a1.expression.transform(C);if(!F){break}}}aQ=true;return a0}}function aN(a0,a1){if(a1 instanceof AST_For){return a0!==a1.init}if(a0 instanceof AST_Assign){return a0.operator!="="&&aU.equivalent_to(a0.left)}if(a0 instanceof AST_Call){return aU instanceof AST_PropAccess&&aU.equivalent_to(a0.expression)}if(a0 instanceof AST_Debugger){return true}if(a0 instanceof AST_IterationStatement){return !(a0 instanceof AST_For)}if(a0 instanceof AST_LoopControl){return true}if(a0 instanceof AST_Try){return true}if(a0 instanceof AST_With){return true}if(F){return false}return a0 instanceof AST_SymbolRef&&!a0.is_declared(aW)}function aY(a0,a1){if(a1 instanceof AST_Binary){return aD[a1.operator]&&a1.left!==a0}if(a1 instanceof AST_Conditional){return a1.condition!==a0}return a1 instanceof AST_If&&a1.condition!==a0}function bi(a0,a1){if(a0 instanceof AST_Call){return true}if(a0 instanceof AST_Exit){return bo||aU instanceof AST_PropAccess||bl(aU)}if(a0 instanceof AST_PropAccess){return bo||a0.expression.may_throw_on_access(aW)}if(a0 instanceof AST_SymbolRef){if(bh(a0,a1)){return !a1||a1.operator!="="||a1.left!==a0}return bo&&bl(a0)}if(a0 instanceof AST_This){return bh(a0,a1)}if(a0 instanceof AST_VarDef){if(!a0.value){return false}return a0.name.name in w||bo&&bl(a0.name)}var a2=aI(a0.left,a0);if(a2&&a2.name in w){return true}if(a2 instanceof AST_PropAccess){return true}}function bn(){var a1,a2=aW.self();if(a2 instanceof AST_Function&&!a2.name&&!a2.uses_arguments&&!a2.pinned()&&(a1=aW.parent()) instanceof AST_Call&&a1.expression===a2){var a3=aW.has_directive("use strict");if(a3&&!member(a3,a2.body)){a3=false}var a6=a2.argnames.length;K=a1.args.slice(a6);var a0=Object.create(null);for(var a4=a6;--a4>=0;){var a5=a2.argnames[a4];var a7=a1.args[a4];K.unshift(aK(AST_VarDef,a5,{name:a5,value:a7}));if(a5.name in a0){continue}a0[a5.name]=true;if(!a7){a7=aK(AST_Undefined,a5).transform(aW)}else{if(a7 instanceof AST_Lambda&&a7.pinned()){a7=null}else{a7.walk(new TreeWalker(function(a8){if(!a7){return true}if(a8 instanceof AST_SymbolRef&&a2.variables.has(a8.name)){var a9=a8.definition().scope;if(a9!==e){while(a9=a9.parent_scope){if(a9===e){return true}}}a7=null}if(a8 instanceof AST_This&&(a3||!this.find_parent(AST_Scope))){a7=null;return true}}))}}if(a7){L.unshift([aK(AST_VarDef,a5,{name:a5,value:a7})])}}}}function bg(a0){aX.push(a0);if(a0 instanceof AST_Assign){L.push(aX.slice());bg(a0.right)}else{if(a0 instanceof AST_Binary){bg(a0.left);bg(a0.right)}else{if(a0 instanceof AST_Call){bg(a0.expression);a0.args.forEach(bg)}else{if(a0 instanceof AST_Case){bg(a0.expression)}else{if(a0 instanceof AST_Conditional){bg(a0.condition);bg(a0.consequent);bg(a0.alternative)}else{if(a0 instanceof AST_Definitions){a0.definitions.forEach(bg)}else{if(a0 instanceof AST_DWLoop){bg(a0.condition);if(!(a0.body instanceof AST_Block)){bg(a0.body)}}else{if(a0 instanceof AST_Exit){if(a0.value){bg(a0.value)}}else{if(a0 instanceof AST_For){if(a0.init){bg(a0.init)}if(a0.condition){bg(a0.condition)}if(a0.step){bg(a0.step)}if(!(a0.body instanceof AST_Block)){bg(a0.body)}}else{if(a0 instanceof AST_ForIn){bg(a0.object);if(!(a0.body instanceof AST_Block)){bg(a0.body)}}else{if(a0 instanceof AST_If){bg(a0.condition);if(!(a0.body instanceof AST_Block)){bg(a0.body)}if(a0.alternative&&!(a0.alternative instanceof AST_Block)){bg(a0.alternative)}}else{if(a0 instanceof AST_Sequence){a0.expressions.forEach(bg)}else{if(a0 instanceof AST_SimpleStatement){bg(a0.body)}else{if(a0 instanceof AST_Switch){bg(a0.expression);a0.body.forEach(bg)}else{if(a0 instanceof AST_Unary){if(a0.operator=="++"||a0.operator=="--"){L.push(aX.slice())}else{bg(a0.expression)}}else{if(a0 instanceof AST_VarDef){if(a0.value){L.push(aX.slice());bg(a0.value)}}}}}}}}}}}}}}}}}aX.pop()}function bf(a1,a0,a3){var a2=C.parent(a0);if(a2 instanceof AST_Assign){if(a3&&!(a2.left instanceof AST_PropAccess||a2.left.name in w)){return bf(a2,a0+1,a3)}return a1}if(a2 instanceof AST_Binary){if(a3&&(!aD[a2.operator]||a2.left===a1)){return bf(a2,a0+1,a3)}return a1}if(a2 instanceof AST_Call){return a1}if(a2 instanceof AST_Case){return a1}if(a2 instanceof AST_Conditional){if(a3&&a2.condition===a1){return bf(a2,a0+1,a3)}return a1}if(a2 instanceof AST_Definitions){return bf(a2,a0+1,true)}if(a2 instanceof AST_Exit){return a3?bf(a2,a0+1,a3):a1}if(a2 instanceof AST_If){if(a3&&a2.condition===a1){return bf(a2,a0+1,a3)}return a1}if(a2 instanceof AST_IterationStatement){return a1}if(a2 instanceof AST_Sequence){return bf(a2,a0+1,a2.tail_node()!==a1)}if(a2 instanceof AST_SimpleStatement){return bf(a2,a0+1,true)}if(a2 instanceof AST_Switch){return a1}if(a2 instanceof AST_Unary){return a1}if(a2 instanceof AST_VarDef){return a1}return null}function R(a0){var a1=a0.value;if(!(a1 instanceof AST_SymbolRef)){return}if(a1.name=="arguments"){return}var a2=a1.definition();if(a2.undeclared){return}return u=a2}function bp(a1){if(a1 instanceof AST_VarDef){var a3=a1.name.definition();if(!member(a1.name,a3.orig)){return}var a2=a3.references.length-a3.replaced;if(!a2){return}var a0=a3.orig.length-a3.eliminated;if(a0>1&&!(a1.name instanceof AST_SymbolFunarg)||(a2>1?R(a1):!aW.exposed(a3))){return aK(AST_SymbolRef,a1.name,a1.name)}}else{return a1[a1 instanceof AST_Assign?"left":"expression"]}}function t(a0){if(!(H instanceof AST_Assign&&H.operator=="=")){return}return H.right}function aV(a0){return a0[a0 instanceof AST_Assign?"right":"value"]}function J(a0){if(a0 instanceof AST_SymbolRef){var a1=a0.evaluate(aW);if(a1===a0){return bd}return x(a1,bd)}if(a0 instanceof AST_This){return bd}if(a0.is_truthy()){return x(true,return_false)}if(a0.is_constant()){return x(a0.evaluate(aW),bd)}if(!(aU instanceof AST_SymbolRef)){return false}if(a0.has_side_effects(aW)){return false}var a3;var a2=aU.definition();a0.walk(new TreeWalker(function(a4){if(a3){return true}if(a4 instanceof AST_SymbolRef&&a4.definition()===a2){a3=true}}));return !a3&&bd}function bd(a0){return P.equivalent_to(a0)}function x(a1,a0){return function(a2,a3){if(a3.in_boolean_context()){if(a1&&a2.is_truthy()&&!a2.has_side_effects(aW)){return true}if(a2.is_constant()){return !a2.evaluate(aW)==!a1}}return a0(a2)}}function D(a0){var a2=Object.create(null);if(H instanceof AST_VarDef){a2[H.name.name]=aU}var a1=new TreeWalker(function(a3){var a4=aA(a3);if(a4 instanceof AST_SymbolRef||a4 instanceof AST_This){a2[a4.name]=a2[a4.name]||an(aW,a1,a3,a3,0)}});a0.walk(a1);return a2}function bm(a0){if(a0.name instanceof AST_SymbolFunarg){var a2=aW.self().argnames.indexOf(a0.name);var a3=aW.parent().args;if(a3[a2]){a3[a2]=aK(AST_Number,a3[a2],{value:0})}return true}var a1=false;return B[I].transform(new TreeTransformer(function(a4,a6,a5){if(a1){return a4}if(a4===a0||a4.body===a0){a1=true;if(a4 instanceof AST_VarDef){a4.value=null;return a4}return a5?MAP.skip:null}},function(a4){if(a4 instanceof AST_Sequence){switch(a4.expressions.length){case 0:return null;case 1:return a4.expressions[0]}}}))}function N(a1){var a0=aA(a1);return a0 instanceof AST_SymbolRef&&a0.definition().scope===e&&!(l&&(a0.name in w&&w[a0.name]!==a1||H instanceof AST_Unary||H instanceof AST_Assign&&H.operator!="="))}function aT(a0){if(a0 instanceof AST_Unary){return false}return aV(a0).has_side_effects(aW)}function O(){if(bo){return false}if(u){return true}if(aU instanceof AST_SymbolRef){var a0=aU.definition();if(a0.references.length-a0.replaced==(H instanceof AST_VarDef?1:2)){return true}}return false}function bh(a1,a0){var a2=w[a1.name];if(!a2){return}if(a2!==aU){return !(a0 instanceof AST_Call)}G=false}function bl(a1){var a0=a1.definition();if(a0.orig.length==1&&a0.orig[0] instanceof AST_SymbolDefun){return false}if(a0.scope!==e){return true}return !all(a0.references,function(a2){var a3=a2.scope;if(a3.TYPE=="Scope"){a3=a3.parent_scope}return a3===e})}function A(a0,a1){if(a0 instanceof AST_Assign){return A(a0.left,true)}if(a0 instanceof AST_Unary){return A(a0.expression,true)}if(a0 instanceof AST_VarDef){return a0.value&&A(a0.value)}if(a1){if(a0 instanceof AST_Dot){return A(a0.expression,true)}if(a0 instanceof AST_Sub){return A(a0.expression,true)}if(a0 instanceof AST_SymbolRef){return a0.definition().scope!==e}}return false}}function m(v){var w=[];for(var u=0;u<v.length;){var t=v[u];if(t instanceof AST_BlockStatement){j=true;m(t.body);[].splice.apply(v,[u,1].concat(t.body));u+=t.body.length}else{if(t instanceof AST_EmptyStatement){j=true;v.splice(u,1)}else{if(t instanceof AST_Directive){if(w.indexOf(t.value)<0){u++;w.push(t.value)}else{j=true;v.splice(u,1)}}else{u++}}}}}function r(E,C){var A=C.self();var M=x(E);var K=A instanceof AST_Lambda;for(var H=E.length;--H>=0;){var D=E[H];var I=G(H);var w=E[I];if(K&&!w&&D instanceof AST_Return){if(!D.value){j=true;E.splice(H,1);continue}if(D.value instanceof AST_UnaryPrefix&&D.value.operator=="void"){j=true;E[H]=aK(AST_SimpleStatement,D,{body:D.value.expression});continue}}if(D instanceof AST_If){var z=aq(D.body);if(t(z)){if(z.label){remove(z.label.thedef.references,z)}j=true;D=D.clone();D.condition=D.condition.negate(C);var F=L(D.body,z);D.body=aK(AST_BlockStatement,D,{body:aj(D.alternative).concat(J())});D.alternative=aK(AST_BlockStatement,D,{body:F});E[H]=D.transform(C);continue}var z=aq(D.alternative);if(t(z)){if(z.label){remove(z.label.thedef.references,z)}j=true;D=D.clone();D.body=aK(AST_BlockStatement,D.body,{body:aj(D.body).concat(J())});var F=L(D.alternative,z);D.alternative=aK(AST_BlockStatement,D.alternative,{body:F});E[H]=D.transform(C);continue}}if(D instanceof AST_If&&D.body instanceof AST_Return){var v=D.body.value;if(!v&&!D.alternative&&(K&&!w||w instanceof AST_Return&&!w.value)){j=true;E[H]=aK(AST_SimpleStatement,D.condition,{body:D.condition});continue}if(v&&!D.alternative&&w instanceof AST_Return&&w.value){j=true;D=D.clone();D.alternative=w;E.splice(H,1,D.transform(C));E.splice(I,1);continue}if(v&&!D.alternative&&(!w&&K&&M||w instanceof AST_Return)){j=true;D=D.clone();D.alternative=w||aK(AST_Return,D,{value:null});E.splice(H,1,D.transform(C));if(w){E.splice(I,1)}continue}var y=E[B(H)];if(C.option("sequences")&&K&&!D.alternative&&y instanceof AST_If&&y.body instanceof AST_Return&&G(I)==E.length&&w instanceof AST_SimpleStatement){j=true;D=D.clone();D.alternative=aK(AST_BlockStatement,w,{body:[w,aK(AST_Return,w,{value:null})]});E.splice(H,1,D.transform(C));E.splice(I,1);continue}}}function x(N){var O=0;for(var Q=N.length;--Q>=0;){var P=N[Q];if(P instanceof AST_If&&P.body instanceof AST_Return){if(++O>1){return true}}}return false}function u(N){return !N||N instanceof AST_UnaryPrefix&&N.operator=="void"}function t(O){if(!O){return false}var N=O instanceof AST_LoopControl?C.loopcontrol_target(O):null;return O instanceof AST_Return&&K&&u(O.value)||O instanceof AST_Continue&&A===az(N)||O instanceof AST_Break&&N instanceof AST_BlockStatement&&A===N}function J(){var N=E.slice(H+1);E.length=H+1;return N.filter(function(O){if(O instanceof AST_Defun){E.push(O);return false}return true})}function L(P,O){var N=aj(P).slice(0,-1);if(O.value){N.push(aK(AST_SimpleStatement,O.value,{body:O.value.expression}))}return N}function G(P){for(var Q=P+1,N=E.length;Q<N;Q++){var O=E[Q];if(!(O instanceof AST_Var&&o(O))){break}}return Q}function B(P){for(var N=P;--N>=0;){var O=E[N];if(!(O instanceof AST_Var&&o(O))){break}}return N}}function h(w,A){var x;var u=A.self();for(var y=0,B=0,v=w.length;y<v;y++){var z=w[y];if(z instanceof AST_LoopControl){var t=A.loopcontrol_target(z);if(z instanceof AST_Break&&!(t instanceof AST_IterationStatement)&&az(t)===u||z instanceof AST_Continue&&az(t)===u){if(z.label){remove(z.label.thedef.references,z)}}else{w[B++]=z}}else{w[B++]=z}if(aq(z)){x=w.slice(y+1);break}}w.length=B;j=B!=v;if(x){x.forEach(function(C){af(A,C,w)})}}function o(t){return all(t.definitions,function(u){return !u.value})}function q(w,A){if(w.length<2){return}var t=[],B=0;function u(){if(!t.length){return}var C=ad(t[0],t);w[B++]=aK(AST_SimpleStatement,C,{body:C});t=[]}for(var y=0,v=w.length;y<v;y++){var z=w[y];if(z instanceof AST_SimpleStatement){if(t.length>=A.sequences_limit){u()}var x=z.body;if(t.length>0){x=x.drop_side_effect_free(A)}if(x){aJ(t,x)}}else{if(z instanceof AST_Definitions&&o(z)||z instanceof AST_Defun){w[B++]=z}else{u();w[B++]=z}}}u();w.length=B;if(B!=v){j=true}}function d(t,w){if(!(t instanceof AST_BlockStatement)){return t}var u=null;for(var v=0,y=t.body.length;v<y;v++){var x=t.body[v];if(x instanceof AST_Var&&o(x)){w.push(x)}else{if(u){return false}else{u=x}}}return u}function s(t,A){function B(F){D--;j=true;var G=C.body;return ad(G,[G,F]).transform(A)}var D=0,C;for(var x=0;x<t.length;x++){var y=t[x];if(C){if(y instanceof AST_Exit){y.value=B(y.value||aK(AST_Undefined,y).transform(A))}else{if(y instanceof AST_For){if(!(y.init instanceof AST_Definitions)){var z=false;C.body.walk(new TreeWalker(function(F){if(z||F instanceof AST_Scope){return true}if(F instanceof AST_Binary&&F.operator=="in"){z=true;return true}}));if(!z){if(y.init){y.init=B(y.init)}else{y.init=C.body;D--;j=true}}}}else{if(y instanceof AST_ForIn){y.object=B(y.object)}else{if(y instanceof AST_If){y.condition=B(y.condition)}else{if(y instanceof AST_Switch){y.expression=B(y.expression)}else{if(y instanceof AST_With){y.expression=B(y.expression)}}}}}}}if(A.option("conditionals")&&y instanceof AST_If){var E=[];var v=d(y.body,E);var w=d(y.alternative,E);if(v!==false&&w!==false&&E.length>0){var u=E.length;E.push(aK(AST_If,y,{condition:y.condition,body:v||aK(AST_EmptyStatement,y.body),alternative:w}));E.unshift(D,1);[].splice.apply(t,E);x+=u;D+=u+1;C=null;j=true;continue}}t[D++]=y;C=y instanceof AST_SimpleStatement?y:null}t.length=D}function n(w,z){var t;if(z instanceof AST_Assign){t=[z]}else{if(z instanceof AST_Sequence){t=z.expressions.slice()}}if(!t){return}if(w instanceof AST_Definitions){var v=w.definitions[w.definitions.length-1];if(i(v.name,v.value,t)){return t}}for(var x=t.length-1;--x>=0;){var u=t[x];if(!(u instanceof AST_Assign)){continue}if(u.operator!="="){continue}if(!(u.left instanceof AST_SymbolRef)){continue}var y=t.slice(x+1);if(!i(u.left,u.right,y)){continue}return t.slice(0,x+1).concat(y)}}function i(y,w,t){if(!(w instanceof AST_Object)){return}var u=false;do{var x=t[0];if(!(x instanceof AST_Assign)){break}if(x.operator!="="){break}if(!(x.left instanceof AST_PropAccess)){break}var z=x.left.expression;if(!(z instanceof AST_SymbolRef)){break}if(y.name!=z.name){break}if(!x.right.is_constant_expression(e)){break}var A=x.left.property;if(A instanceof AST_Node){A=A.evaluate(p)}if(A instanceof AST_Node){break}A=""+A;var v=p.has_directive("use strict")?function(B){return B.key!=A&&B.key.name!=A}:function(B){return B.key.name!=A};if(!all(w.properties,v)){break}w.properties.push(aK(AST_ObjectKeyVal,x,{key:A,value:x.right}));t.shift();u=true}while(t.length);return u}function g(w){var z;for(var x=0,A=-1,v=w.length;x<v;x++){var y=w[x];var B=w[A];if(y instanceof AST_Definitions){if(B&&B.TYPE==y.TYPE){B.definitions=B.definitions.concat(y.definitions);j=true}else{if(z&&z.TYPE==y.TYPE&&o(y)){z.definitions=z.definitions.concat(y.definitions);j=true}else{w[++A]=y;z=y}}}else{if(y instanceof AST_Exit){y.value=t(y.value)}else{if(y instanceof AST_For){var u=n(B,y.init);if(u){j=true;y.init=u.length?ad(y.init,u):null;w[++A]=y}else{if(B instanceof AST_Var&&(!y.init||y.init.TYPE==B.TYPE)){if(y.init){B.definitions=B.definitions.concat(y.init.definitions)}y.init=B;w[A]=y;j=true}else{if(z&&y.init&&z.TYPE==y.init.TYPE&&o(y.init)){z.definitions=z.definitions.concat(y.init.definitions);y.init=null;w[++A]=y;j=true}else{w[++A]=y}}}}else{if(y instanceof AST_ForIn){y.object=t(y.object)}else{if(y instanceof AST_If){y.condition=t(y.condition)}else{if(y instanceof AST_SimpleStatement){var u=n(B,y.body);if(u){j=true;if(!u.length){continue}y.body=ad(y.body,u)}w[++A]=y}else{if(y instanceof AST_Switch){y.expression=t(y.expression)}else{if(y instanceof AST_With){y.expression=t(y.expression)}else{w[++A]=y}}}}}}}}}w.length=A+1;function t(D){w[++A]=y;var C=n(B,D);if(C){j=true;if(C.length){return ad(D,C)}else{if(D instanceof AST_Sequence){return D.tail_node().left}else{return D.left}}}return D}}}function af(a,c,b){if(!(c instanceof AST_Defun)){a.warn("Dropping unreachable code [{file}:{line},{col}]",c.start)}c.walk(new TreeWalker(function(d){if(d instanceof AST_Definitions){a.warn("Declarations in unreachable code! [{file}:{line},{col}]",d.start);d.remove_initializers();b.push(d);return true}if(d instanceof AST_Defun){b.push(d);return true}if(d instanceof AST_Scope){return true}}))}function V(a){if(a instanceof AST_Constant){return a.getValue()}if(a instanceof AST_UnaryPrefix&&a.operator=="void"&&a.expression instanceof AST_Constant){return}return a}function ab(b,a){return b.is_undefined||b instanceof AST_Undefined||b instanceof AST_UnaryPrefix&&b.operator=="void"&&!b.expression.has_side_effects(a)}(function(a){a(AST_Node,return_false);a(AST_Array,return_true);a(AST_Assign,function(){return this.operator=="="&&this.right.is_truthy()});a(AST_Lambda,return_true);a(AST_Object,return_true);a(AST_RegExp,return_true);a(AST_Sequence,function(){return this.tail_node().is_truthy()});a(AST_SymbolRef,function(){var b=this.fixed_value();return b&&b.is_truthy()})})(function(a,b){a.DEFMETHOD("is_truthy",b)});(function(a){AST_Node.DEFMETHOD("may_throw_on_access",function(c){return !c.option("pure_getters")||this._dot_throw(c)});function b(c){return/strict/.test(c.option("pure_getters"))}a(AST_Node,b);a(AST_Null,return_true);a(AST_Undefined,return_true);a(AST_Constant,return_false);a(AST_Array,return_false);a(AST_Object,function(c){if(!b(c)){return false}for(var d=this.properties.length;--d>=0;){if(this.properties[d].value instanceof AST_Accessor){return true}}return false});a(AST_Lambda,return_false);a(AST_UnaryPostfix,return_false);a(AST_UnaryPrefix,function(){return this.operator=="void"});a(AST_Binary,function(c){return(this.operator=="&&"||this.operator=="||")&&(this.left._dot_throw(c)||this.right._dot_throw(c))});a(AST_Assign,function(c){return this.operator=="="&&this.right._dot_throw(c)});a(AST_Conditional,function(c){return this.consequent._dot_throw(c)||this.alternative._dot_throw(c)});a(AST_Dot,function(c){if(!b(c)){return false}var d=this.expression;if(d instanceof AST_SymbolRef){d=d.fixed_value()}return !(d instanceof AST_Lambda&&this.property=="prototype")});a(AST_Sequence,function(c){return this.tail_node()._dot_throw(c)});a(AST_SymbolRef,function(c){if(this.is_undefined){return true}if(!b(c)){return false}if(ac(this)&&this.is_declared(c)){return false}if(this.is_immutable()){return false}var d=this.fixed_value();return !d||d._dot_throw(c)})})(function(a,b){a.DEFMETHOD("_dot_throw",b)});(function(b){var c=makePredicate("! delete");var a=makePredicate("in instanceof == != === !== < <= >= >");b(AST_Node,return_false);b(AST_UnaryPrefix,function(){return c[this.operator]});b(AST_Binary,function(){return a[this.operator]||aD[this.operator]&&this.left.is_boolean()&&this.right.is_boolean()});b(AST_Conditional,function(){return this.consequent.is_boolean()&&this.alternative.is_boolean()});b(AST_Assign,function(){return this.operator=="="&&this.right.is_boolean()});b(AST_Sequence,function(){return this.tail_node().is_boolean()});b(AST_True,return_true);b(AST_False,return_true)})(function(a,b){a.DEFMETHOD("is_boolean",b)});(function(b){b(AST_Node,return_false);b(AST_Number,return_true);var c=makePredicate("+ - ~ ++ --");b(AST_Unary,function(){return c[this.operator]});var a=makePredicate("- * / % & | ^ << >> >>>");b(AST_Binary,function(d){return a[this.operator]||this.operator=="+"&&this.left.is_number(d)&&this.right.is_number(d)});b(AST_Assign,function(d){return a[this.operator.slice(0,-1)]||this.operator=="="&&this.right.is_number(d)});b(AST_Sequence,function(d){return this.tail_node().is_number(d)});b(AST_Conditional,function(d){return this.consequent.is_number(d)&&this.alternative.is_number(d)})})(function(a,b){a.DEFMETHOD("is_number",b)});(function(a){a(AST_Node,return_false);a(AST_String,return_true);a(AST_UnaryPrefix,function(){return this.operator=="typeof"});a(AST_Binary,function(b){return this.operator=="+"&&(this.left.is_string(b)||this.right.is_string(b))});a(AST_Assign,function(b){return(this.operator=="="||this.operator=="+=")&&this.right.is_string(b)});a(AST_Sequence,function(b){return this.tail_node().is_string(b)});a(AST_Conditional,function(b){return this.consequent.is_string(b)&&this.alternative.is_string(b)})})(function(a,b){a.DEFMETHOD("is_string",b)});var aD=makePredicate("&& ||");var ak=makePredicate("delete ++ --");function aI(a,b){if(b instanceof AST_Unary&&ak[b.operator]){return b.expression}if(b instanceof AST_Assign&&b.left===a){return a}}(function(a){AST_Node.DEFMETHOD("resolve_defines",function(e){if(!e.option("global_defs")){return}var g=this._find_defs(e,"");if(g){var c,d=this,f=0;do{c=d;d=e.parent(f++)}while(d instanceof AST_PropAccess&&d.expression===c);if(aI(c,d)){e.warn("global_defs "+this.print_to_string()+" redefined [{file}:{line},{col}]",this.start)}else{return g}}});function b(f,e){if(f instanceof AST_Node){return aK(f.CTOR,e,f)}if(Array.isArray(f)){return aK(AST_Array,e,{elements:f.map(function(g){return b(g,e)})})}if(f&&typeof f=="object"){var c=[];for(var d in f){if(HOP(f,d)){c.push(aK(AST_ObjectKeyVal,e,{key:d,value:b(f[d],e)}))}}return aK(AST_Object,e,{properties:c})}return ap(f,e)}a(AST_Node,noop);a(AST_Dot,function(c,d){return this.expression._find_defs(c,"."+this.property+d)});a(AST_SymbolRef,function(f,e){if(!this.global()){return}var d;var c=f.option("global_defs");if(c&&HOP(c,(d=this.name+e))){var h=b(c[d],this);var g=f.find_parent(AST_Toplevel);h.walk(new TreeWalker(function(i){if(i instanceof AST_SymbolRef){i.scope=g;i.thedef=g.def_global(i)}}));return h}})})(function(a,b){a.DEFMETHOD("_find_defs",b)});function aM(a,b){return a.print_to_string().length>b.print_to_string().length?b:a}function av(a,b){return aM(aK(AST_SimpleStatement,a,{body:a}),aK(AST_SimpleStatement,b,{body:b})).body}function aB(a,b,c){return(first_in_statement(a)?av:aM)(b,c)}function aE(a){for(var b in a){a[b]=makePredicate(a[b])}}var aa=["constructor","toString","valueOf"];var Z={Array:["indexOf","join","lastIndexOf","slice"].concat(aa),Boolean:aa,Function:aa,Number:["toExponential","toFixed","toPrecision"].concat(aa),Object:aa,RegExp:["test"].concat(aa),String:["charAt","charCodeAt","concat","indexOf","italics","lastIndexOf","match","replace","search","slice","split","substr","substring","toLowerCase","toUpperCase","trim"].concat(aa)};aE(Z);var aw={Array:["isArray"],Math:["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","atan2","pow","max","min"],Number:["isFinite","isNaN"],Object:["create","getOwnPropertyDescriptor","getOwnPropertyNames","getPrototypeOf","isExtensible","isFrozen","isSealed","keys"],String:["fromCharCode"]};aE(aw);(function(b){AST_Node.DEFMETHOD("evaluate",function(g){if(!g.option("evaluate")){return this}var i=[];var h=this._eval(g,i,1);i.forEach(function(j){delete j._eval});if(!h||h instanceof RegExp){return h}if(typeof h=="function"||typeof h=="object"){return this}return h});var d=makePredicate("! ~ - + void");AST_Node.DEFMETHOD("is_constant",function(){if(this instanceof AST_Constant){return !(this instanceof AST_RegExp)}else{return this instanceof AST_UnaryPrefix&&this.expression instanceof AST_Constant&&d[this.operator]}});b(AST_Statement,function(){throw new Error(string_template("Cannot evaluate a statement [{file}:{line},{col}]",this.start))});b(AST_Lambda,return_this);b(AST_Node,return_this);b(AST_Constant,function(){return this.getValue()});b(AST_Function,function(h){if(h.option("unsafe")){var g=function(){};g.node=this;g.toString=function(){return"function(){}"};return g}return this});b(AST_Array,function(g,k,h){if(g.option("unsafe")){var i=[];for(var l=0,n=this.elements.length;l<n;l++){var m=this.elements[l];var j=m._eval(g,k,h);if(m===j){return this}i.push(j)}return i}return this});b(AST_Object,function(g,k,i){if(g.option("unsafe")){var j={};for(var l=0,n=this.properties.length;l<n;l++){var h=this.properties[l];var m=h.key;if(m instanceof AST_Symbol){m=m.name}else{if(m instanceof AST_Node){m=m._eval(g,k,i);if(m===h.key){return this}}}if(typeof Object.prototype[m]==="function"){return this}if(h.value instanceof AST_Function){continue}j[m]=h.value._eval(g,k,i);if(j[m]===h.value){return this}}return j}return this});var a=makePredicate("! typeof void");b(AST_UnaryPrefix,function(g,j,h){var i=this.expression;if(g.option("typeofs")&&this.operator=="typeof"&&(i instanceof AST_Lambda||i instanceof AST_SymbolRef&&i.fixed_value() instanceof AST_Lambda)){return typeof function(){}}if(!a[this.operator]){h++}i=i._eval(g,j,h);if(i===this.expression){return this}switch(this.operator){case"!":return !i;case"typeof":if(i instanceof RegExp){return this}return typeof i;case"void":return void i;case"~":return ~i;case"-":return -i;case"+":return +i}return this});var e=makePredicate("&& || === !==");b(AST_Binary,function(g,j,h){if(!e[this.operator]){h++}var i=this.left._eval(g,j,h);if(i===this.left){return this}var l=this.right._eval(g,j,h);if(l===this.right){return this}var k;switch(this.operator){case"&&":k=i&&l;break;case"||":k=i||l;break;case"|":k=i|l;break;case"&":k=i&l;break;case"^":k=i^l;break;case"+":k=i+l;break;case"*":k=i*l;break;case"/":k=i/l;break;case"%":k=i%l;break;case"-":k=i-l;break;case"<<":k=i<<l;break;case">>":k=i>>l;break;case">>>":k=i>>>l;break;case"==":k=i==l;break;case"===":k=i===l;break;case"!=":k=i!=l;break;case"!==":k=i!==l;break;case"<":k=i<l;break;case"<=":k=i<=l;break;case">":k=i>l;break;case">=":k=i>=l;break;default:return this}if(isNaN(k)&&g.find_parent(AST_With)){return this}return k});b(AST_Conditional,function(g,l,i){var h=this.condition._eval(g,l,i);if(h===this.condition){return this}var k=h?this.consequent:this.alternative;var j=k._eval(g,l,i);return j===k?this:j});b(AST_SymbolRef,function(g,l,h){var k=this.fixed_value();if(!k){return this}var j;if(l.indexOf(k)>=0){j=k._eval()}else{this._eval=return_this;j=k._eval(g,l,h);delete this._eval;if(j===k){return this}k._eval=function(){return j};l.push(k)}if(j&&typeof j=="object"){var i=this.definition().escaped;if(i&&h>i){return this}}return j});var f={Array:Array,Math:Math,Number:Number,Object:Object,String:String};var c={Math:["E","LN10","LN2","LOG2E","LOG10E","PI","SQRT1_2","SQRT2"],Number:["MAX_VALUE","MIN_VALUE","NaN","NEGATIVE_INFINITY","POSITIVE_INFINITY"]};aE(c);b(AST_PropAccess,function(g,k,h){if(g.option("unsafe")){var m=this.property;if(m instanceof AST_Node){m=m._eval(g,k,h);if(m===this.property){return this}}var i=this.expression;var j;if(ac(i)){var l=c[i.name];if(!l||!l[m]){return this}j=f[i.name]}else{j=i._eval(g,k,h+1);if(!j||j===i||!HOP(j,m)){return this}if(typeof j=="function"){switch(m){case"name":return j.node.name?j.node.name.name:"";case"length":return j.node.argnames.length;default:return this}}}return j[m]}return this});b(AST_Call,function(r,u,q){var t=this.expression;if(r.option("unsafe")&&t instanceof AST_PropAccess){var j=t.property;if(j instanceof AST_Node){j=j._eval(r,u,q);if(j===t.property){return this}}var g;var o=t.expression;if(ac(o)){var l=aw[o.name];if(!l||!l[j]){return this}g=f[o.name]}else{g=o._eval(r,u,q+1);if(g===o||!g){return this}var h=Z[g.constructor.name];if(!h||!h[j]){return this}}var m=[];for(var s=0,p=this.args.length;s<p;s++){var i=this.args[s];var k=i._eval(r,u,q);if(i===k){return this}m.push(k)}try{return g[j].apply(g,m)}catch(n){r.warn("Error evaluating {code} [{file}:{line},{col}]",{code:this.print_to_string(),file:this.start.file,line:this.start.line,col:this.start.col})}}return this});b(AST_New,return_this)})(function(a,b){a.DEFMETHOD("_eval",b)});(function(b){function c(d){return aK(AST_UnaryPrefix,d,{operator:"!",expression:d})}function a(f,g,h){var e=c(f);if(h){var d=aK(AST_SimpleStatement,g,{body:g});return aM(e,d)===d?g:e}return aM(e,g)}b(AST_Node,function(){return c(this)});b(AST_Statement,function(){throw new Error("Cannot negate a statement")});b(AST_Function,function(){return c(this)});b(AST_UnaryPrefix,function(){if(this.operator=="!"){return this.expression}return c(this)});b(AST_Sequence,function(e){var d=this.expressions.slice();d.push(d.pop().negate(e));return ad(this,d)});b(AST_Conditional,function(e,f){var d=this.clone();d.consequent=d.consequent.negate(e);d.alternative=d.alternative.negate(e);return a(this,d,f)});b(AST_Binary,function(e,g){var d=this.clone(),f=this.operator;if(e.option("unsafe_comps")){switch(f){case"<=":d.operator=">";return d;case"<":d.operator=">=";return d;case">=":d.operator="<";return d;case">":d.operator="<=";return d}}switch(f){case"==":d.operator="!=";return d;case"!=":d.operator="==";return d;case"===":d.operator="!==";return d;case"!==":d.operator="===";return d;case"&&":d.operator="||";d.left=d.left.negate(e,g);d.right=d.right.negate(e);return a(this,d,g);case"||":d.operator="&&";d.left=d.left.negate(e,g);d.right=d.right.negate(e);return a(this,d,g)}return c(this)})})(function(a,b){a.DEFMETHOD("negate",function(c,d){return b.call(this,c,d)})});var T=makePredicate("Boolean decodeURI decodeURIComponent Date encodeURI encodeURIComponent Error escape EvalError isFinite isNaN Number Object parseFloat parseInt RangeError ReferenceError String SyntaxError TypeError unescape URIError");AST_Call.DEFMETHOD("is_expr_pure",function(a){if(a.option("unsafe")){var b=this.expression;if(ac(b)&&T[b.name]){return true}if(b instanceof AST_Dot&&ac(b.expression)){var c=aw[b.expression.name];return c&&c[b.property]}}return this.pure||!a.pure_funcs(this)});AST_Node.DEFMETHOD("is_call_pure",return_false);AST_Dot.DEFMETHOD("is_call_pure",function(a){if(!a.option("unsafe")){return}var b=this.expression;var c;if(b instanceof AST_Array){c=Z.Array}else{if(b.is_boolean()){c=Z.Boolean}else{if(b.is_number(a)){c=Z.Number}else{if(b instanceof AST_RegExp){c=Z.RegExp}else{if(b.is_string(a)){c=Z.String}else{if(!this.may_throw_on_access(a)){c=Z.Object}}}}}}return c&&c[this.property]});(function(a){a(AST_Node,return_true);a(AST_EmptyStatement,return_false);a(AST_Constant,return_false);a(AST_This,return_false);function b(c,e){for(var d=c.length;--d>=0;){if(c[d].has_side_effects(e)){return true}}return false}a(AST_Block,function(c){return b(this.body,c)});a(AST_Call,function(c){if(!this.is_expr_pure(c)&&(!this.expression.is_call_pure(c)||this.expression.has_side_effects(c))){return true}return b(this.args,c)});a(AST_Switch,function(c){return this.expression.has_side_effects(c)||b(this.body,c)});a(AST_Case,function(c){return this.expression.has_side_effects(c)||b(this.body,c)});a(AST_Try,function(c){return b(this.body,c)||this.bcatch&&this.bcatch.has_side_effects(c)||this.bfinally&&this.bfinally.has_side_effects(c)});a(AST_If,function(c){return this.condition.has_side_effects(c)||this.body&&this.body.has_side_effects(c)||this.alternative&&this.alternative.has_side_effects(c)});a(AST_LabeledStatement,function(c){return this.body.has_side_effects(c)});a(AST_SimpleStatement,function(c){return this.body.has_side_effects(c)});a(AST_Lambda,return_false);a(AST_Binary,function(c){return this.left.has_side_effects(c)||this.right.has_side_effects(c)});a(AST_Assign,return_true);a(AST_Conditional,function(c){return this.condition.has_side_effects(c)||this.consequent.has_side_effects(c)||this.alternative.has_side_effects(c)});a(AST_Unary,function(c){return ak[this.operator]||this.expression.has_side_effects(c)});a(AST_SymbolRef,function(c){return !this.is_declared(c)});a(AST_SymbolDeclaration,return_false);a(AST_Object,function(c){return b(this.properties,c)});a(AST_ObjectProperty,function(c){return this.value.has_side_effects(c)});a(AST_Array,function(c){return b(this.elements,c)});a(AST_Dot,function(c){return this.expression.may_throw_on_access(c)||this.expression.has_side_effects(c)});a(AST_Sub,function(c){return this.expression.may_throw_on_access(c)||this.expression.has_side_effects(c)||this.property.has_side_effects(c)});a(AST_Sequence,function(c){return b(this.expressions,c)});a(AST_Definitions,function(c){return b(this.definitions,c)});a(AST_VarDef,function(c){return this.value})})(function(a,b){a.DEFMETHOD("has_side_effects",b)});(function(a){a(AST_Node,return_true);a(AST_Constant,return_false);a(AST_EmptyStatement,return_false);a(AST_Lambda,return_false);a(AST_SymbolDeclaration,return_false);a(AST_This,return_false);function b(c,e){for(var d=c.length;--d>=0;){if(c[d].may_throw(e)){return true}}return false}a(AST_Array,function(c){return b(this.elements,c)});a(AST_Assign,function(c){if(this.right.may_throw(c)){return true}if(!c.has_directive("use strict")&&this.operator=="="&&this.left instanceof AST_SymbolRef){return false}return this.left.may_throw(c)});a(AST_Binary,function(c){return this.left.may_throw(c)||this.right.may_throw(c)});a(AST_Block,function(c){return b(this.body,c)});a(AST_Call,function(c){if(b(this.args,c)){return true}if(this.is_expr_pure(c)){return false}if(this.expression.may_throw(c)){return true}return !(this.expression instanceof AST_Lambda)||b(this.expression.body,c)});a(AST_Case,function(c){return this.expression.may_throw(c)||b(this.body,c)});a(AST_Conditional,function(c){return this.condition.may_throw(c)||this.consequent.may_throw(c)||this.alternative.may_throw(c)});a(AST_Definitions,function(c){return b(this.definitions,c)});a(AST_Dot,function(c){return this.expression.may_throw_on_access(c)||this.expression.may_throw(c)});a(AST_If,function(c){return this.condition.may_throw(c)||this.body&&this.body.may_throw(c)||this.alternative&&this.alternative.may_throw(c)});a(AST_LabeledStatement,function(c){return this.body.may_throw(c)});a(AST_Object,function(c){return b(this.properties,c)});a(AST_ObjectProperty,function(c){return this.value.may_throw(c)});a(AST_Return,function(c){return this.value&&this.value.may_throw(c)});a(AST_Sequence,function(c){return b(this.expressions,c)});a(AST_SimpleStatement,function(c){return this.body.may_throw(c)});a(AST_Sub,function(c){return this.expression.may_throw_on_access(c)||this.expression.may_throw(c)||this.property.may_throw(c)});a(AST_Switch,function(c){return this.expression.may_throw(c)||b(this.body,c)});a(AST_SymbolRef,function(c){return !this.is_declared(c)});a(AST_Try,function(c){return this.bcatch?this.bcatch.may_throw(c):b(this.body,c)||this.bfinally&&this.bfinally.may_throw(c)});a(AST_Unary,function(c){if(this.operator=="typeof"&&this.expression instanceof AST_SymbolRef){return false}return this.expression.may_throw(c)});a(AST_VarDef,function(c){if(!this.value){return false}return this.value.may_throw(c)})})(function(a,b){a.DEFMETHOD("may_throw",b)});(function(a){function b(c){for(var d=c.length;--d>=0;){if(!c[d].is_constant_expression()){return false}}return true}a(AST_Node,return_false);a(AST_Constant,return_true);a(AST_Lambda,function(e){var c=this;var d=true;c.walk(new TreeWalker(function(h){if(!d){return true}if(h instanceof AST_SymbolRef){if(c.inlined){d=false;return true}var g=h.definition();if(member(g,c.enclosed)&&!c.variables.has(g.name)){if(e){var f=e.find_variable(h);if(g.undeclared?!f:f===g){d="f";return true}}d=false}return true}}));return d});a(AST_Unary,function(){return this.expression.is_constant_expression()});a(AST_Binary,function(){return this.left.is_constant_expression()&&this.right.is_constant_expression()});a(AST_Array,function(){return b(this.elements)});a(AST_Object,function(){return b(this.properties)});a(AST_ObjectProperty,function(){return this.value.is_constant_expression()})})(function(a,b){a.DEFMETHOD("is_constant_expression",b)});function aq(a){return a&&a.aborts()}(function(b){b(AST_Statement,return_null);b(AST_Jump,return_this);function a(){var c=this.body.length;return c>0&&aq(this.body[c-1])}b(AST_BlockStatement,a);b(AST_SwitchBranch,a);b(AST_If,function(){return this.alternative&&aq(this.body)&&aq(this.alternative)&&this})})(function(a,b){a.DEFMETHOD("aborts",b)});X(AST_Directive,function(b,a){if(a.has_directive(b.value)!==b){return aK(AST_EmptyStatement,b)}return b});X(AST_Debugger,function(b,a){if(a.option("drop_debugger")){return aK(AST_EmptyStatement,b)}return b});X(AST_LabeledStatement,function(b,a){if(b.body instanceof AST_Break&&a.loopcontrol_target(b.body)===b.body){return aK(AST_EmptyStatement,b)}return b.label.references.length==0?b.body:b});X(AST_Block,function(b,a){am(b.body,a);return b});X(AST_BlockStatement,function(b,a){am(b.body,a);switch(b.body.length){case 1:return b.body[0];case 0:return aK(AST_EmptyStatement,b)}return b});X(AST_Lambda,function(b,a){am(b.body,a);if(a.option("side_effects")&&b.body.length==1&&b.body[0]===a.has_directive("use strict")){b.body.length=0}return b});AST_Scope.DEFMETHOD("drop_unused",function(a){if(!a.option("unused")){return}if(a.has_directive("use asm")){return}var t=this;if(t.pinned()){return}var h=!(t instanceof AST_Toplevel)||a.toplevel.funcs;var l=!(t instanceof AST_Toplevel)||a.toplevel.vars;var j=/keep_assign/.test(a.option("unused"))?return_false:function(u,v){var w;if(u instanceof AST_Assign&&(u.write_only||u.operator=="=")){w=u.left}else{if(u instanceof AST_Unary&&u.write_only){w=u.expression}}if(/strict/.test(a.option("pure_getters"))){while(w instanceof AST_PropAccess&&!w.expression.may_throw_on_access(a)){if(w instanceof AST_Sub){v.unshift(w.property)}w=w.expression}}return w};var s=[];var f=Object.create(null);var r=Object.create(null);var e=Object.create(null);var q=Object.create(null);if(t instanceof AST_Toplevel&&a.top_retain){t.variables.each(function(u){if(a.top_retain(u)&&!(u.id in f)){f[u.id]=true;s.push(u)}})}var c=new Dictionary();var p=new Dictionary();var d=this;var i=new TreeWalker(function(v,w){if(v===t){return}if(v instanceof AST_Defun){var u=v.name.definition();if(!h&&d===t){if(!(u.id in f)){f[u.id]=true;s.push(u)}}p.add(u.id,v);return true}if(v instanceof AST_SymbolFunarg&&d===t){c.add(v.definition().id,v)}if(v instanceof AST_Definitions&&d===t){v.definitions.forEach(function(x){var y=x.name.definition();if(x.name instanceof AST_SymbolVar){c.add(y.id,x)}if(!l){if(!(y.id in f)){f[y.id]=true;s.push(y)}}if(x.value){p.add(y.id,x.value);if(x.value.has_side_effects(a)){x.value.walk(i)}if(!y.chained&&x.name.fixed_value()===x.value){r[y.id]=x}}});return true}return m(v,w)});t.walk(i);i=new TreeWalker(m);for(var n=0;n<s.length;n++){var o=p.get(s[n].id);if(o){o.forEach(function(u){u.walk(i)})}}var g=new TreeTransformer(function b(J,K,H){var D=g.parent();if(l){var M=[],z=j(J,M);if(z instanceof AST_SymbolRef){var x=z.definition();var v=x.id in f;var u=null;if(J instanceof AST_Assign){if(!v||J.left===z&&x.id in r&&r[x.id]!==J){u=J.right}}else{if(!v){u=aK(AST_Number,J,{value:0})}}if(u){M.push(u);return aH(a,D,J,ad(J,M.map(function(N){return N.transform(g)})))}}}if(d!==t){return}if(J instanceof AST_Function&&J.name&&!a.option("keep_fnames")){var x=J.name.definition();if(!(x.id in f)||x.orig.length>1){J.name=null}}if(J instanceof AST_Lambda&&!(J instanceof AST_Accessor)){var E=!a.option("keep_fargs");for(var A=J.argnames,F=A.length;--F>=0;){var z=A[F];if(!(z.definition().id in f)){z.__unused=true;if(E){A.pop();a[z.unreferenced()?"warn":"info"]("Dropping unused function argument {name} [{file}:{line},{col}]",y(z))}}else{E=false}}}if(h&&J instanceof AST_Defun&&J!==t){var x=J.name.definition();if(!(x.id in f)){a[J.name.unreferenced()?"warn":"info"]("Dropping unused function {name} [{file}:{line},{col}]",y(J.name));x.eliminated++;return aK(AST_EmptyStatement,J)}}if(J instanceof AST_Definitions&&!(D instanceof AST_ForIn&&D.init===J)){var B=[],L=[],I=[];var w=[];J.definitions.forEach(function(O){if(O.value){O.value=O.value.transform(g)}var S=O.name.definition();if(!l||S.id in f){if(O.value&&S.id in r&&r[S.id]!==O){O.value=O.value.drop_side_effect_free(a)}if(O.name instanceof AST_SymbolVar){var Q=c.get(S.id);if(Q.length>1&&(!O.value||S.orig.indexOf(O.name)>S.eliminated)){a.warn("Dropping duplicated definition of variable {name} [{file}:{line},{col}]",y(O.name));if(O.value){var R=aK(AST_SymbolRef,O.name,O.name);S.references.push(R);var N=aK(AST_Assign,O,{operator:"=",left:R,right:O.value});if(r[S.id]===O){r[S.id]=N}w.push(N.transform(g))}remove(Q,O);S.eliminated++;return}}if(O.value){if(w.length>0){if(I.length>0){w.push(O.value);O.value=ad(O.value,w)}else{B.push(aK(AST_SimpleStatement,J,{body:ad(J,w)}))}w=[]}I.push(O)}else{L.push(O)}}else{if(S.orig[0] instanceof AST_SymbolCatch){var P=O.value&&O.value.drop_side_effect_free(a);if(P){w.push(P)}O.value=null;L.push(O)}else{var P=O.value&&O.value.drop_side_effect_free(a);if(P){a.warn("Side effects in initialization of unused variable {name} [{file}:{line},{col}]",y(O.name));w.push(P)}else{a[O.name.unreferenced()?"warn":"info"]("Dropping unused variable {name} [{file}:{line},{col}]",y(O.name))}S.eliminated++}}});if(L.length>0||I.length>0){J.definitions=L.concat(I);B.push(J)}if(w.length>0){B.push(aK(AST_SimpleStatement,J,{body:ad(J,w)}))}switch(B.length){case 0:return H?MAP.skip:aK(AST_EmptyStatement,J);case 1:return B[0];default:return H?MAP.splice(B):aK(AST_BlockStatement,J,{body:B})}}if(J instanceof AST_For){K(J,this);var G;if(J.init instanceof AST_BlockStatement){G=J.init;J.init=G.body.pop();G.body.push(J)}if(J.init instanceof AST_SimpleStatement){J.init=J.init.body}else{if(ao(J.init)){J.init=null}}return !G?J:H?MAP.splice(G.body):G}if(J instanceof AST_LabeledStatement&&J.body instanceof AST_For){K(J,this);if(J.body instanceof AST_BlockStatement){var G=J.body;J.body=G.body.pop();G.body.push(J);return H?MAP.splice(G.body):G}return J}if(J instanceof AST_Scope){var C=d;d=J;K(J,this);d=C;return J}function y(N){return{name:N.name,file:N.start.file,line:N.start.line,col:N.start.col}}});t.transform(g);function k(u,v,w){if(u.id in f){return}if(v&&w){f[u.id]=true;s.push(u)}else{e[u.id]=v;q[u.id]=w}}function m(u,w){var A,x=[],z=j(u,x);if(z instanceof AST_SymbolRef&&t.variables.get(z.name)===(A=z.definition())){x.forEach(function(B){B.walk(i)});if(u instanceof AST_Assign){u.right.walk(i);if(u.left===z){if(!A.chained&&z.fixed_value()===u.right){r[A.id]=u}if(!u.write_only){k(A,true,q[A.id])}}else{var v=z.fixed_value();if(!v||!v.is_constant()){k(A,e[A.id],true)}}}return true}if(u instanceof AST_SymbolRef){A=u.definition();if(!(A.id in f)){f[A.id]=true;s.push(A)}return true}if(u instanceof AST_Scope){var y=d;d=u;w();d=y;return true}}});AST_Scope.DEFMETHOD("hoist_declarations",function(q){var n=this;if(q.has_directive("use asm")){return n}var k=q.option("hoist_funs");var c=q.option("hoist_vars");if(k||c){var d=[];var j=[];var m=new Dictionary(),o=0,b=0;n.walk(new TreeWalker(function(s){if(s instanceof AST_Scope&&s!==n){return true}if(s instanceof AST_Var){++b;return true}}));c=c&&b>1;var g=new TreeTransformer(function r(u){if(u!==n){if(u instanceof AST_Directive){d.push(u);return aK(AST_EmptyStatement,u)}if(k&&u instanceof AST_Defun&&(g.parent()===n||!q.has_directive("use strict"))){j.push(u);return aK(AST_EmptyStatement,u)}if(c&&u instanceof AST_Var){u.definitions.forEach(function(w){m.set(w.name.name,w);++o});var v=u.to_assignments(q);var s=g.parent();if(s instanceof AST_ForIn&&s.init===u){if(v==null){var t=u.definitions[0].name;return aK(AST_SymbolRef,t,t)}return v}if(s instanceof AST_For&&s.init===u){return v}if(!v){return aK(AST_EmptyStatement,u)}return aK(AST_SimpleStatement,u,{body:v})}if(u instanceof AST_Scope){return u}}});n=n.transform(g);if(o>0){var f=[];m.each(function(s,t){if(n instanceof AST_Lambda&&!all(n.argnames,function(u){return u.name!=t})){m.del(t)}else{s=s.clone();s.value=null;f.push(s);m.set(t,s)}});if(f.length>0){for(var i=0;i<n.body.length;){if(n.body[i] instanceof AST_SimpleStatement){var e=n.body[i].body,a,l;if(e instanceof AST_Assign&&e.operator=="="&&(a=e.left) instanceof AST_Symbol&&m.has(a.name)){var p=m.get(a.name);if(p.value){break}p.value=e.right;remove(f,p);f.push(p);n.body.splice(i,1);continue}if(e instanceof AST_Sequence&&(l=e.expressions[0]) instanceof AST_Assign&&l.operator=="="&&(a=l.left) instanceof AST_Symbol&&m.has(a.name)){var p=m.get(a.name);if(p.value){break}p.value=l.right;remove(f,p);f.push(p);n.body[i].body=ad(e,e.expressions.slice(1));continue}}if(n.body[i] instanceof AST_EmptyStatement){n.body.splice(i,1);continue}if(n.body[i] instanceof AST_BlockStatement){var h=[i,1].concat(n.body[i].body);n.body.splice.apply(n.body,h);continue}break}f=aK(AST_Var,n,{definitions:f});j.push(f)}}n.body=d.concat(j,n.body)}return n});AST_Scope.DEFMETHOD("var_names",function(){var a=this._var_names;if(!a){this._var_names=a=Object.create(null);this.enclosed.forEach(function(b){a[b.name]=true});this.variables.each(function(b,c){a[c]=true})}return a});AST_Scope.DEFMETHOD("make_var_name",function(b){var a=this.var_names();b=b.replace(/(?:^[^a-z_$]|[^a-z0-9_$])/ig,"_");var d=b;for(var c=0;a[d];c++){d=b+"$"+c}a[d]=true;return d});AST_Scope.DEFMETHOD("hoist_properties",function(a){var d=this;if(!a.option("hoist_props")||a.has_directive("use asm")){return d}var c=d instanceof AST_Toplevel&&a.top_retain||return_false;var b=Object.create(null);return d.transform(new TreeTransformer(function(n,j){if(n instanceof AST_Assign&&n.operator=="="&&n.write_only&&g(n.left,n.right,1)){j(n,this);var m=new Dictionary();var h=[];var i=[];n.right.properties.forEach(function(q){var p=k(n.left,q.key);i.push(aK(AST_VarDef,n,{name:p,value:null}));var o=aK(AST_SymbolRef,n,{name:p.name,scope:d,thedef:p.definition()});o.reference({});h.push(aK(AST_Assign,n,{operator:"=",left:o,right:q.value}))});b[n.left.definition().id]=m;d.body.splice(d.body.indexOf(this.stack[1])+1,0,aK(AST_Var,n,{definitions:i}));return ad(n,h)}if(n instanceof AST_VarDef&&g(n.name,n.value,0)){j(n,this);var m=new Dictionary();var l=[];n.value.properties.forEach(function(o){l.push(aK(AST_VarDef,n,{name:k(n.name,o.key),value:o.value}))});b[n.name.definition().id]=m;return MAP.splice(l)}if(n instanceof AST_PropAccess&&n.expression instanceof AST_SymbolRef){var m=b[n.expression.definition().id];if(m){var f=m.get(V(n.property));var e=aK(AST_SymbolRef,n,{name:f.name,scope:n.expression.scope,thedef:f});e.reference({});return e}}function g(p,o,r){if(p.scope!==d){return}var q=p.definition();if(q.assignments!=r){return}if(q.direct_access){return}if(q.escaped==1){return}if(q.single_use){return}if(c(q)){return}if(p.fixed_value()!==o){return}return o instanceof AST_Object}function k(p,o){var r=aK(AST_SymbolVar,p,{name:d.make_var_name(p.name+"_"+o),scope:d});var q=d.def_variable(r);m.set(o,q);d.enclosed.push(q);return r}}))});(function(a){function b(c,e,h){var d=c.length;if(!d){return null}var j=[],f=false;for(var i=0;i<d;i++){var g=c[i].drop_side_effect_free(e,h);f|=g!==c[i];if(g){j.push(g);h=false}}return f?j.length?j:null:c}a(AST_Node,return_this);a(AST_Constant,return_null);a(AST_This,return_null);a(AST_Call,function(f,h){if(!this.is_expr_pure(f)){if(this.expression.is_call_pure(f)){var e=this.args.slice();e.unshift(this.expression.expression);e=b(e,f,h);return e&&ad(this,e)}if(this.expression instanceof AST_Function&&(!this.expression.name||!this.expression.name.definition().references.length)){var c=this.clone();var g=c.expression;g.process_expression(false,f);g.walk(new TreeWalker(function(i){if(i instanceof AST_Return&&i.value){i.value=i.value.drop_side_effect_free(f);return true}if(i instanceof AST_Scope&&i!==g){return true}}));return c}return this}if(this.pure){f.warn("Dropping __PURE__ call [{file}:{line},{col}]",this.start)}var d=b(this.args,f,h);return d&&ad(this,d)});a(AST_Accessor,return_null);a(AST_Function,return_null);a(AST_Binary,function(e,g){var d=this.right.drop_side_effect_free(e);if(!d){return this.left.drop_side_effect_free(e,g)}if(aD[this.operator]){if(d===this.right){return this}var c=this.clone();c.right=d;return c}else{var f=this.left.drop_side_effect_free(e,g);if(!f){return this.right.drop_side_effect_free(e,g)}return ad(this,[f,d])}});a(AST_Assign,function(c){var d=this.left;if(d.has_side_effects(c)||c.has_directive("use strict")&&d instanceof AST_PropAccess&&d.expression.is_constant()){return this}this.write_only=true;if(aA(d).is_constant_expression(c.find_parent(AST_Scope))){return this.right.drop_side_effect_free(c)}return this});a(AST_Conditional,function(e){var f=this.consequent.drop_side_effect_free(e);var d=this.alternative.drop_side_effect_free(e);if(f===this.consequent&&d===this.alternative){return this}if(!f){return d?aK(AST_Binary,this,{operator:"||",left:this.condition,right:d}):this.condition.drop_side_effect_free(e)}if(!d){return aK(AST_Binary,this,{operator:"&&",left:this.condition,right:f})}var c=this.clone();c.consequent=f;c.alternative=d;return c});a(AST_Unary,function(e,d){if(ak[this.operator]){this.write_only=!this.expression.has_side_effects(e);return this}if(this.operator=="typeof"&&this.expression instanceof AST_SymbolRef){return null}var c=this.expression.drop_side_effect_free(e,d);if(d&&c&&W(c)){if(c===this.expression&&this.operator=="!"){return this}return c.negate(e,d)}return c});a(AST_SymbolRef,function(c){return this.is_declared(c)?null:this});a(AST_Object,function(e,c){var d=b(this.properties,e,c);return d&&ad(this,d)});a(AST_ObjectProperty,function(c,d){return this.value.drop_side_effect_free(c,d)});a(AST_Array,function(e,c){var d=b(this.elements,e,c);return d&&ad(this,d)});a(AST_Dot,function(c,d){if(this.expression.may_throw_on_access(c)){return this}return this.expression.drop_side_effect_free(c,d)});a(AST_Sub,function(e,c){if(this.expression.may_throw_on_access(e)){return this}var f=this.expression.drop_side_effect_free(e,c);if(!f){return this.property.drop_side_effect_free(e,c)}var d=this.property.drop_side_effect_free(e);if(!d){return f}return ad(this,[f,d])});a(AST_Sequence,function(e){var c=this.tail_node();var f=c.drop_side_effect_free(e);if(f===c){return this}var d=this.expressions.slice(0,-1);if(f){d.push(f)}return ad(this,d)})})(function(a,b){a.DEFMETHOD("drop_side_effect_free",b)});X(AST_SimpleStatement,function(c,a){if(a.option("side_effects")){var d=c.body;var b=d.drop_side_effect_free(a,true);if(!b){a.warn("Dropping side-effect-free statement [{file}:{line},{col}]",c.start);return aK(AST_EmptyStatement,c)}if(b!==d){return aK(AST_SimpleStatement,c,{body:b})}}return c});X(AST_While,function(b,a){return a.option("loops")?aK(AST_For,b,b).optimize(a):b});function ag(d,b){var a=false;var c=new TreeWalker(function(e){if(a||e instanceof AST_Scope){return true}if(e instanceof AST_LoopControl&&c.loopcontrol_target(e)===d){return a=true}});if(b instanceof AST_LabeledStatement){c.push(b)}c.push(d);d.body.walk(c);return a}X(AST_Do,function(c,a){if(!a.option("loops")){return c}var b=c.condition.is_truthy()||c.condition.tail_node().evaluate(a);if(!(b instanceof AST_Node)){if(b){return aK(AST_For,c,{body:aK(AST_BlockStatement,c.body,{body:[c.body,aK(AST_SimpleStatement,c.condition,{body:c.condition})]})}).optimize(a)}if(!ag(c,a.parent())){return aK(AST_BlockStatement,c.body,{body:[c.body,aK(AST_SimpleStatement,c.condition,{body:c.condition})]}).optimize(a)}}if(c.body instanceof AST_SimpleStatement){return aK(AST_For,c,{condition:ad(c.condition,[c.body.body,c.condition]),body:aK(AST_EmptyStatement,c)}).optimize(a)}return c});function aG(b,e){var f=b.body instanceof AST_BlockStatement?b.body.body[0]:b.body;if(e.option("dead_code")&&d(f)){var c=[];if(b.init instanceof AST_Statement){c.push(b.init)}else{if(b.init){c.push(aK(AST_SimpleStatement,b.init,{body:b.init}))}}if(b.condition){c.push(aK(AST_SimpleStatement,b.condition,{body:b.condition}))}af(e,b.body,c);return aK(AST_BlockStatement,b,{body:c})}if(f instanceof AST_If){if(d(f.body)){if(b.condition){b.condition=aK(AST_Binary,b.condition,{left:b.condition,operator:"&&",right:f.condition.negate(e)})}else{b.condition=f.condition.negate(e)}a(f.alternative)}else{if(d(f.alternative)){if(b.condition){b.condition=aK(AST_Binary,b.condition,{left:b.condition,operator:"&&",right:f.condition})}else{b.condition=f.condition}a(f.body)}}}return b;function d(g){return g instanceof AST_Break&&e.loopcontrol_target(g)===e.self()}function a(g){g=aj(g);if(b.body instanceof AST_BlockStatement){b.body=b.body.clone();b.body.body=g.concat(b.body.body.slice(1));b.body=b.body.transform(e)}else{b.body=aK(AST_BlockStatement,b.body,{body:g}).transform(e)}b=aG(b,e)}}X(AST_For,function(c,e){if(!e.option("loops")){return c}if(e.option("side_effects")&&c.init){c.init=c.init.drop_side_effect_free(e)}if(c.condition){var b=c.condition.evaluate(e);if(!(b instanceof AST_Node)){if(b){c.condition=null}else{if(!e.option("dead_code")){var a=c.condition;c.condition=ap(b,c.condition);c.condition=aM(c.condition.transform(e),a)}}}if(b instanceof AST_Node){b=c.condition.is_truthy()||c.condition.tail_node().evaluate(e)}if(!b){if(e.option("dead_code")){var d=[];af(e,c.body,d);if(c.init instanceof AST_Statement){d.push(c.init)}else{if(c.init){d.push(aK(AST_SimpleStatement,c.init,{body:c.init}))}}d.push(aK(AST_SimpleStatement,c.condition,{body:c.condition}));return aK(AST_BlockStatement,c,{body:d}).optimize(e)}}else{if(c.condition&&!(b instanceof AST_Node)){c.body=aK(AST_BlockStatement,c.body,{body:[aK(AST_SimpleStatement,c.condition,{body:c.condition}),c.body]});c.condition=null}}}return aG(c,e)});X(AST_If,function(i,d){if(ao(i.alternative)){i.alternative=null}if(!d.option("conditionals")){return i}var a=i.condition.evaluate(d);if(!d.option("dead_code")&&!(a instanceof AST_Node)){var k=i.condition;i.condition=ap(a,k);i.condition=aM(i.condition.transform(d),k)}if(d.option("dead_code")){if(a instanceof AST_Node){a=i.condition.is_truthy()||i.condition.tail_node().evaluate(d)}if(!a){d.warn("Condition always false [{file}:{line},{col}]",i.condition.start);var b=[];af(d,i.body,b);b.push(aK(AST_SimpleStatement,i.condition,{body:i.condition}));if(i.alternative){b.push(i.alternative)}return aK(AST_BlockStatement,i,{body:b}).optimize(d)}else{if(!(a instanceof AST_Node)){d.warn("Condition always true [{file}:{line},{col}]",i.condition.start);var b=[];if(i.alternative){af(d,i.alternative,b)}b.push(aK(AST_SimpleStatement,i.condition,{body:i.condition}));b.push(i.body);return aK(AST_BlockStatement,i,{body:b}).optimize(d)}}}var h=i.condition.negate(d);var g=i.condition.print_to_string().length;var j=h.print_to_string().length;var f=j<g;if(i.alternative&&f){f=false;i.condition=h;var e=i.body;i.body=i.alternative||aK(AST_EmptyStatement,i);i.alternative=e}if(ao(i.body)&&ao(i.alternative)){return aK(AST_SimpleStatement,i.condition,{body:i.condition.clone()}).optimize(d)}if(i.body instanceof AST_SimpleStatement&&i.alternative instanceof AST_SimpleStatement){return aK(AST_SimpleStatement,i,{body:aK(AST_Conditional,i,{condition:i.condition,consequent:i.body.body,alternative:i.alternative.body})}).optimize(d)}if(ao(i.alternative)&&i.body instanceof AST_SimpleStatement){if(g===j&&!f&&i.condition instanceof AST_Binary&&i.condition.operator=="||"){f=true}if(f){return aK(AST_SimpleStatement,i,{body:aK(AST_Binary,i,{operator:"||",left:h,right:i.body.body})}).optimize(d)}return aK(AST_SimpleStatement,i,{body:aK(AST_Binary,i,{operator:"&&",left:i.condition,right:i.body.body})}).optimize(d)}if(i.body instanceof AST_EmptyStatement&&i.alternative instanceof AST_SimpleStatement){return aK(AST_SimpleStatement,i,{body:aK(AST_Binary,i,{operator:"||",left:i.condition,right:i.alternative.body})}).optimize(d)}if(i.body instanceof AST_Exit&&i.alternative instanceof AST_Exit&&i.body.TYPE==i.alternative.TYPE){return aK(i.body.CTOR,i,{value:aK(AST_Conditional,i,{condition:i.condition,consequent:i.body.value||aK(AST_Undefined,i.body),alternative:i.alternative.value||aK(AST_Undefined,i.alternative)}).transform(d)}).optimize(d)}if(i.body instanceof AST_If&&!i.body.alternative&&!i.alternative){i=aK(AST_If,i,{condition:aK(AST_Binary,i.condition,{operator:"&&",left:i.condition,right:i.body.condition}),body:i.body.body,alternative:null})}if(aq(i.body)){if(i.alternative){var c=i.alternative;i.alternative=null;return aK(AST_BlockStatement,i,{body:[i,c]}).optimize(d)}}if(aq(i.alternative)){var b=i.body;i.body=i.alternative;i.condition=f?h:i.condition.negate(d);i.alternative=null;return aK(AST_BlockStatement,i,{body:[i,b]}).optimize(d)}return i});X(AST_Switch,function(q,s){if(!s.option("switches")){return q}var g;var m=q.expression.evaluate(s);if(!(m instanceof AST_Node)){var e=q.expression;q.expression=ap(m,e);q.expression=aM(q.expression.transform(s),e)}if(!s.option("dead_code")){return q}if(m instanceof AST_Node){m=q.expression.tail_node().evaluate(s)}var d=[];var a=[];var p;var f;for(var l=0,k=q.body.length;l<k&&!f;l++){g=q.body[l];if(g instanceof AST_Default){if(!p){p=g}else{c(g,a[a.length-1])}}else{if(!(m instanceof AST_Node)){var b=g.expression.evaluate(s);if(!(b instanceof AST_Node)&&b!==m){c(g,a[a.length-1]);continue}if(b instanceof AST_Node){b=g.expression.tail_node().evaluate(s)}if(b===m){f=g;if(p){var r=a.indexOf(p);a.splice(r,1);c(p,a[r-1]);p=null}}}}if(aq(g)){var o=a[a.length-1];if(aq(o)&&o.body.length==g.body.length&&aK(AST_BlockStatement,o,o).equivalent_to(aK(AST_BlockStatement,g,g))){o.body=[]}}a.push(g)}while(l<k){c(q.body[l++],a[a.length-1])}if(a.length>0){a[0].body=d.concat(a[0].body)}q.body=a;while(g=a[a.length-1]){var i=g.body[g.body.length-1];if(i instanceof AST_Break&&s.loopcontrol_target(i)===q){g.body.pop()}if(g.body.length||g instanceof AST_Case&&(p||g.expression.has_side_effects(s))){break}if(a.pop()===p){p=null}}if(a.length==0){return aK(AST_BlockStatement,q,{body:d.concat(aK(AST_SimpleStatement,q.expression,{body:q.expression}))}).optimize(s)}if(a.length==1&&(a[0]===f||a[0]===p)){var n=false;var h=new TreeWalker(function(t){if(n||t instanceof AST_Lambda||t instanceof AST_SimpleStatement){return true}if(t instanceof AST_Break&&h.loopcontrol_target(t)===q){n=true}});q.walk(h);if(!n){var j=a[0].body.slice();var b=a[0].expression;if(b){j.unshift(aK(AST_SimpleStatement,b,{body:b}))}j.unshift(aK(AST_SimpleStatement,q.expression,{body:q.expression}));return aK(AST_BlockStatement,q,{body:j}).optimize(s)}}return q;function c(u,t){if(t&&!aq(t)){t.body=t.body.concat(u.body)}else{af(s,u,d)}}});X(AST_Try,function(b,a){am(b.body,a);if(b.bcatch&&b.bfinally&&all(b.bfinally.body,ao)){b.bfinally=null}if(a.option("dead_code")&&all(b.body,ao)){var c=[];if(b.bcatch){af(a,b.bcatch,c);c.forEach(function(d){if(!(d instanceof AST_Definitions)){return}d.definitions.forEach(function(e){var f=e.name.definition().redefined();if(!f){return}e.name=e.name.clone();e.name.thedef=f})})}if(b.bfinally){c=c.concat(b.bfinally.body)}return aK(AST_BlockStatement,b,{body:c}).optimize(a)}return b});AST_Definitions.DEFMETHOD("remove_initializers",function(){this.definitions.forEach(function(a){a.value=null})});AST_Definitions.DEFMETHOD("to_assignments",function(a){var b=a.option("reduce_vars");var c=this.definitions.reduce(function(d,e){if(e.value){var f=aK(AST_SymbolRef,e.name,e.name);d.push(aK(AST_Assign,e,{operator:"=",left:f,right:e.value}));if(b){f.definition().fixed=false}}e=e.name.definition();e.eliminated++;e.replaced--;return d},[]);if(c.length==0){return null}return ad(this,c)});X(AST_Definitions,function(b,a){if(b.definitions.length==0){return aK(AST_EmptyStatement,b)}return b});AST_Call.DEFMETHOD("lift_sequences",function(e){if(!e.option("sequences")){return this}var a=this.expression;if(!(a instanceof AST_Sequence)){return this}var d=a.tail_node();if(ax(e,d)&&!(this instanceof AST_New)){return this}var b=a.expressions.slice(0,-1);var c=this.clone();c.expression=d;b.push(c);return ad(this,b).optimize(e)});X(AST_Call,function(C,x){var p=C.lift_sequences(x);if(p!==C){return p}var I=C.expression;var n=I;if(x.option("reduce_vars")&&n instanceof AST_SymbolRef){n=n.fixed_value()}var H=n instanceof AST_Lambda;if(x.option("unused")&&H&&!n.uses_arguments&&!n.pinned()){var i=0,w=0;for(var K=0,v=C.args.length;K<v;K++){var m=K>=n.argnames.length;if(m||n.argnames[K].__unused){var f=C.args[K].drop_side_effect_free(x);if(f){C.args[i++]=f}else{if(!m){C.args[i++]=aK(AST_Number,C.args[K],{value:0});continue}}}else{C.args[i++]=C.args[K]}w=i}C.args.length=w}if(x.option("unsafe")){if(ac(I)){switch(I.name){case"Array":if(C.args.length!=1){return aK(AST_Array,C,{elements:C.args}).optimize(x)}break;case"Object":if(C.args.length==0){return aK(AST_Object,C,{properties:[]})}break;case"String":if(C.args.length==0){return aK(AST_String,C,{value:""})}if(C.args.length<=1){return aK(AST_Binary,C,{left:C.args[0],operator:"+",right:aK(AST_String,C,{value:""})}).optimize(x)}break;case"Number":if(C.args.length==0){return aK(AST_Number,C,{value:0})}if(C.args.length==1){return aK(AST_UnaryPrefix,C,{expression:C.args[0],operator:"+"}).optimize(x)}case"Boolean":if(C.args.length==0){return aK(AST_False,C)}if(C.args.length==1){return aK(AST_UnaryPrefix,C,{expression:aK(AST_UnaryPrefix,C,{expression:C.args[0],operator:"!"}),operator:"!"}).optimize(x)}break;case"RegExp":var g=[];if(all(C.args,function(aQ){var aP=aQ.evaluate(x);g.unshift(aP);return aQ!==aP})){try{return aB(x,C,aK(AST_RegExp,C,{value:RegExp.apply(RegExp,g)}))}catch(Q){x.warn("Error converting {expr} [{file}:{line},{col}]",{expr:C.print_to_string(),file:C.start.file,line:C.start.line,col:C.start.col})}}break}}else{if(I instanceof AST_Dot){switch(I.property){case"toString":if(C.args.length==0&&!I.expression.may_throw_on_access(x)){return aK(AST_Binary,C,{left:aK(AST_String,C,{value:""}),operator:"+",right:I.expression}).optimize(x)}break;case"join":if(I.expression instanceof AST_Array){EXIT:{var G;if(C.args.length>0){G=C.args[0].evaluate(x);if(G===C.args[0]){break EXIT}}var E=[];var q=[];I.expression.elements.forEach(function(aQ){var aP=aQ.evaluate(x);if(aP!==aQ){q.push(aP)}else{if(q.length>0){E.push(aK(AST_String,C,{value:q.join(G)}));q.length=0}E.push(aQ)}});if(q.length>0){E.push(aK(AST_String,C,{value:q.join(G)}))}if(E.length==0){return aK(AST_String,C,{value:""})}if(E.length==1){if(E[0].is_string(x)){return E[0]}return aK(AST_Binary,E[0],{operator:"+",left:aK(AST_String,C,{value:""}),right:E[0]})}if(G==""){var B;if(E[0].is_string(x)||E[1].is_string(x)){B=E.shift()}else{B=aK(AST_String,C,{value:""})}return E.reduce(function(aP,aQ){return aK(AST_Binary,aQ,{operator:"+",left:aP,right:aQ})},B).optimize(x)}var f=C.clone();f.expression=f.expression.clone();f.expression.expression=f.expression.expression.clone();f.expression.expression.elements=E;return aB(x,C,f)}}break;case"charAt":if(I.expression.is_string(x)){var r=C.args[0];var d=r?r.evaluate(x):0;if(d!==r){return aK(AST_Sub,I,{expression:I.expression,property:ap(d|0,r||I)}).optimize(x)}}break;case"apply":if(C.args.length==2&&C.args[1] instanceof AST_Array){var M=C.args[1].elements.slice();M.unshift(C.args[0]);return aK(AST_Call,C,{expression:aK(AST_Dot,I,{expression:I.expression,property:"call"}),args:M}).optimize(x)}break;case"call":var t=I.expression;if(t instanceof AST_SymbolRef){t=t.fixed_value()}if(t instanceof AST_Lambda&&!t.contains_this()){return(C.args.length?ad(this,[C.args[0],aK(AST_Call,C,{expression:I.expression,args:C.args.slice(1)})]):aK(AST_Call,C,{expression:I.expression,args:[]})).optimize(x)}break}}}}if(x.option("unsafe_Function")&&ac(I)&&I.name=="Function"){if(C.args.length==0){return aK(AST_Function,C,{argnames:[],body:[]})}if(all(C.args,function(aO){return aO instanceof AST_String})){try{var a="n(function("+C.args.slice(0,-1).map(function(aO){return aO.value}).join(",")+"){"+C.args[C.args.length-1].value+"})";var k=parse(a);var b={ie8:x.option("ie8")};k.figure_out_scope(b);var e=new Compressor(x.options);k=k.transform(e);k.figure_out_scope(b);k.compute_char_frequency(b);k.mangle_names(b);var L;k.walk(new TreeWalker(function(aO){if(L){return true}if(aO instanceof AST_Lambda){L=aO;return true}}));var a=OutputStream();AST_BlockStatement.prototype._codegen.call(L,L,a);C.args=[aK(AST_String,C,{value:L.argnames.map(function(aO){return aO.print_to_string()}).join(",")}),aK(AST_String,C.args[C.args.length-1],{value:a.get().replace(/^\{|\}$/g,"")})];return C}catch(Q){if(Q instanceof JS_Parse_Error){x.warn("Error parsing code passed to new Function [{file}:{line},{col}]",C.args[C.args.length-1].start);x.warn(Q.toString())}else{throw Q}}}}var J=H&&n.body[0];var c=x.option("inline")&&!C.is_expr_pure(x);if(c&&J instanceof AST_Return){var P=J.value;if(!P||P.is_constant_expression()){if(P){P=P.clone(true)}else{P=aK(AST_Undefined,C)}var M=C.args.concat(P);return ad(C,M).optimize(x)}}if(H){var u,P,S,F,D=-1;if(c&&!n.uses_arguments&&!n.pinned()&&!(n.name&&n instanceof AST_Function)&&(P=o(J))&&(I===n||x.option("unused")&&(u=I.definition()).references.length==1&&!ai(x,u)&&n.is_constant_expression(I.scope))&&!C.pure&&!n.contains_this()&&O()){n._squeezed=true;return ad(C,h()).optimize(x)}if(x.option("side_effects")&&all(n.body,ao)){var M=C.args.concat(aK(AST_Undefined,C));return ad(C,M).optimize(x)}}if(x.option("drop_console")){if(I instanceof AST_PropAccess){var y=I.expression;while(y.expression){y=y.expression}if(ac(y)&&y.name=="console"){return aK(AST_Undefined,C).optimize(x)}}}if(x.option("negate_iife")&&x.parent() instanceof AST_SimpleStatement&&W(C)){return C.negate(x,true)}var N=C.evaluate(x);if(N!==C){N=ap(N,C).optimize(x);return aB(x,N,C)}return C;function s(aO){if(!aO){return aK(AST_Undefined,C)}if(aO instanceof AST_Return){if(!aO.value){return aK(AST_Undefined,C)}return aO.value.clone(true)}if(aO instanceof AST_SimpleStatement){return aK(AST_UnaryPrefix,aO,{operator:"void",expression:aO.body.clone(true)})}}function o(aR){var aU=n.body.length;if(x.option("inline")<3){return aU==1&&s(aR)}aR=null;for(var aS=0;aS<aU;aS++){var aT=n.body[aS];if(aT instanceof AST_Var){if(aR&&!all(aT.definitions,function(aN){return !aN.value})){return false}}else{if(aT instanceof AST_EmptyStatement){continue}else{if(aR){return false}else{aR=aT}}}}return s(aR)}function z(aU,aS){for(var aT=0,aV=n.argnames.length;aT<aV;aT++){var aW=n.argnames[aT];if(aW.__unused){continue}if(!aS||aU[aW.name]||at[aW.name]||S.var_names()[aW.name]){return false}if(F){F.push(aW.definition())}}return true}function A(aY,a0){var aZ=n.body.length;for(var aV=0;aV<aZ;aV++){var aU=n.body[aV];if(!(aU instanceof AST_Var)){continue}if(!a0){return false}for(var aW=aU.definitions.length;--aW>=0;){var aX=aU.definitions[aW].name;if(aY[aX.name]||at[aX.name]||S.var_names()[aX.name]){return false}if(F){F.push(aX.definition())}}}return true}function O(){var aS=Object.create(null);do{S=x.parent(++D);if(S instanceof AST_Catch){aS[S.argname.name]=true}else{if(S instanceof AST_IterationStatement){F=[]}else{if(S instanceof AST_SymbolRef){if(S.fixed_value() instanceof AST_Scope){return false}}}}}while(!(S instanceof AST_Scope));var aQ=!(S instanceof AST_Toplevel)||x.toplevel.vars;var aR=x.option("inline");if(!A(aS,aR>=3&&aQ)){return false}if(!z(aS,aR>=2&&aQ)){return false}return !F||F.length==0||!aL(n,F)}function R(aY,aV,aW,aT){var aU=aW.definition();S.variables.set(aW.name,aU);S.enclosed.push(aU);if(!S.var_names()[aW.name]){S.var_names()[aW.name]=true;aY.push(aK(AST_VarDef,aW,{name:aW,value:null}))}var aX=aK(AST_SymbolRef,aW,aW);aU.references.push(aX);if(aT){aV.push(aK(AST_Assign,C,{operator:"=",left:aX,right:aT}))}}function j(aY,aV){var aZ=n.argnames.length;for(var aW=C.args.length;--aW>=aZ;){aV.push(C.args[aW])}for(aW=aZ;--aW>=0;){var aX=n.argnames[aW];var a0=C.args[aW];if(aX.__unused||S.var_names()[aX.name]){if(a0){aV.push(a0)}}else{var aU=aK(AST_SymbolVar,aX,aX);aX.definition().orig.push(aU);if(!a0&&F){a0=aK(AST_Undefined,C)}R(aY,aV,aU,a0)}}aY.reverse();aV.reverse()}function l(a1,a4){var a3=a4.length;for(var a5=0,a0=n.body.length;a5<a0;a5++){var a6=n.body[a5];if(!(a6 instanceof AST_Var)){continue}for(var a8=0,a7=a6.definitions.length;a8<a7;a8++){var a9=a6.definitions[a8];var bc=a9.name;var a2=bc.definition().redefined();if(a2){bc=bc.clone();bc.thedef=a2}R(a1,a4,bc,a9.value);if(F&&all(n.argnames,function(aN){return aN.name!=bc.name})){var ba=n.variables.get(bc.name);var bb=aK(AST_SymbolRef,bc,bc);ba.references.push(bb);a4.splice(a3++,0,aK(AST_Assign,a9,{operator:"=",left:bb,right:aK(AST_Undefined,bc)}))}}}}function h(){var aQ=[];var aP=[];j(aQ,aP);l(aQ,aP);aP.push(P);if(aQ.length){K=S.body.indexOf(x.parent(D-1))+1;S.body.splice(K,0,aK(AST_Var,n,{definitions:aQ}))}return aP}});X(AST_New,function(c,a){var d=c.lift_sequences(a);if(d!==c){return d}if(a.option("unsafe")){var b=c.expression;if(ac(b)){switch(b.name){case"Object":case"RegExp":case"Function":case"Error":case"Array":return aK(AST_Call,c,c).transform(a)}}}return c});X(AST_Sequence,function(c,e){if(!e.option("side_effects")){return c}var f=[];b();var d=f.length-1;a();if(d==0){c=aH(e,e.parent(),e.self(),f[0]);if(!(c instanceof AST_Sequence)){c=c.optimize(e)}return c}c.expressions=f;return c;function b(){var h=first_in_statement(e);var g=c.expressions.length-1;c.expressions.forEach(function(i,j){if(j<g){i=i.drop_side_effect_free(e,h)}if(i){aJ(f,i);h=false}})}function a(){while(d>0&&ab(f[d],e)){d--}if(d<f.length-1){f[d]=aK(AST_UnaryPrefix,c,{operator:"void",expression:f[d]});f.length=d+1}}});AST_Unary.DEFMETHOD("lift_sequences",function(a){if(a.option("sequences")&&this.expression instanceof AST_Sequence){var c=this.expression.expressions.slice();var b=this.clone();b.expression=c.pop();c.push(b);return ad(this,c).optimize(a)}return this});X(AST_UnaryPostfix,function(b,a){return b.lift_sequences(a)});X(AST_UnaryPrefix,function(c,e){var a=c.expression;if(c.operator=="delete"&&!(a instanceof AST_SymbolRef||a instanceof AST_PropAccess||au(a))){if(a instanceof AST_Sequence){a=a.expressions.slice();a.push(aK(AST_True,c));return ad(c,a).optimize(e)}return ad(c,[a,aK(AST_True,c)]).optimize(e)}var d=c.lift_sequences(e);if(d!==c){return d}if(e.option("side_effects")&&c.operator=="void"){a=a.drop_side_effect_free(e);if(a){c.expression=a;return c}else{return aK(AST_Undefined,c).optimize(e)}}if(e.option("booleans")){if(c.operator=="!"&&a.is_truthy()){return ad(c,[a,aK(AST_False,c)]).optimize(e)}else{if(e.in_boolean_context()){switch(c.operator){case"!":if(a instanceof AST_UnaryPrefix&&a.operator=="!"){return a.expression}if(a instanceof AST_Binary){c=aB(e,c,a.negate(e,first_in_statement(e)))}break;case"typeof":e.warn("Boolean expression always true [{file}:{line},{col}]",c.start);return(a instanceof AST_SymbolRef?aK(AST_True,c):ad(c,[a,aK(AST_True,c)])).optimize(e)}}}}if(c.operator=="-"&&a instanceof AST_Infinity){a=a.transform(e)}if(a instanceof AST_Binary&&(c.operator=="+"||c.operator=="-")&&(a.operator=="*"||a.operator=="/"||a.operator=="%")){return aK(AST_Binary,c,{operator:a.operator,left:aK(AST_UnaryPrefix,a.left,{operator:c.operator,expression:a.left}),right:a.right})}if(c.operator!="-"||!(a instanceof AST_Number||a instanceof AST_Infinity)){var b=c.evaluate(e);if(b!==c){b=ap(b,c).optimize(e);return aB(e,b,c)}}return c});AST_Binary.DEFMETHOD("lift_sequences",function(e){if(e.option("sequences")){if(this.left instanceof AST_Sequence){var d=this.left.expressions.slice();var f=this.clone();f.left=d.pop();d.push(f);return ad(this,d).optimize(e)}if(this.right instanceof AST_Sequence&&!this.left.has_side_effects(e)){var c=this.operator=="="&&this.left instanceof AST_SymbolRef;var d=this.right.expressions;var a=d.length-1;for(var b=0;b<a;b++){if(!c&&d[b].has_side_effects(e)){break}}if(b==a){d=d.slice();var f=this.clone();f.right=d.pop();d.push(f);return ad(this,d).optimize(e)}else{if(b>0){var f=this.clone();f.right=ad(this.right,d.slice(b));d=d.slice(0,b);d.push(f);return ad(this,d).optimize(e)}}}}return this});var ar=makePredicate("== === != !== * & | ^");function ah(a){return a instanceof AST_Array||a instanceof AST_Lambda||a instanceof AST_Object}X(AST_Binary,function(i,a){function g(){return i.left.is_constant()||i.right.is_constant()||!i.left.has_side_effects(a)&&!i.right.has_side_effects(a)}function o(r){if(g()){if(r){i.operator=r}var s=i.left;i.left=i.right;i.right=s}}if(ar[i.operator]){if(i.right.is_constant()&&!i.left.is_constant()){if(!(i.left instanceof AST_Binary&&PRECEDENCE[i.left.operator]>=PRECEDENCE[i.operator])){o()}}}i=i.lift_sequences(a);if(a.option("comparisons")){switch(i.operator){case"===":case"!==":var j=true;if((i.left.is_string(a)&&i.right.is_string(a))||(i.left.is_number(a)&&i.right.is_number(a))||(i.left.is_boolean()&&i.right.is_boolean())||i.left.equivalent_to(i.right)){i.operator=i.operator.substr(0,2)}case"==":case"!=":if(!j&&ab(i.left,a)){i.left=aK(AST_Null,i.left)}else{if(a.option("typeofs")&&i.left instanceof AST_String&&i.left.value=="undefined"&&i.right instanceof AST_UnaryPrefix&&i.right.operator=="typeof"){var k=i.right.expression;if(k instanceof AST_SymbolRef?k.is_declared(a):!(k instanceof AST_PropAccess&&a.option("ie8"))){i.right=k;i.left=aK(AST_Undefined,i.left).optimize(a);if(i.operator.length==2){i.operator+="="}}}else{if(i.left instanceof AST_SymbolRef&&i.right instanceof AST_SymbolRef&&i.left.definition()===i.right.definition()&&ah(i.left.fixed_value())){return aK(i.operator[0]=="="?AST_True:AST_False,i)}}}break;case"&&":case"||":var e=i.left;if(e.operator==i.operator){e=e.right}if(e instanceof AST_Binary&&e.operator==(i.operator=="&&"?"!==":"===")&&i.right instanceof AST_Binary&&e.operator==i.right.operator&&(ab(e.left,a)&&i.right.left instanceof AST_Null||e.left instanceof AST_Null&&ab(i.right.left,a))&&!e.right.has_side_effects(a)&&e.right.equivalent_to(i.right.right)){var d=aK(AST_Binary,i,{operator:e.operator.slice(0,-1),left:aK(AST_Null,i),right:e.right});if(e!==i.left){d=aK(AST_Binary,i,{operator:i.operator,left:i.left.left,right:d})}return d}break}}if(a.option("booleans")&&i.operator=="+"&&a.in_boolean_context()){var m=i.left.evaluate(a);var c=i.right.evaluate(a);if(m&&typeof m=="string"){a.warn("+ in boolean context always true [{file}:{line},{col}]",i.start);return ad(i,[i.right,aK(AST_True,i)]).optimize(a)}if(c&&typeof c=="string"){a.warn("+ in boolean context always true [{file}:{line},{col}]",i.start);return ad(i,[i.left,aK(AST_True,i)]).optimize(a)}}if(a.option("comparisons")&&i.is_boolean()){if(!(a.parent() instanceof AST_Binary)||a.parent() instanceof AST_Assign){var h=aK(AST_UnaryPrefix,i,{operator:"!",expression:i.negate(a,first_in_statement(a))});i=aB(a,i,h)}switch(i.operator){case">":o("<");break;case">=":o("<=");break}}if(i.operator=="+"){if(i.right instanceof AST_String&&i.right.getValue()==""&&i.left.is_string(a)){return i.left}if(i.left instanceof AST_String&&i.left.getValue()==""&&i.right.is_string(a)){return i.right}if(i.left instanceof AST_Binary&&i.left.operator=="+"&&i.left.left instanceof AST_String&&i.left.left.getValue()==""&&i.right.is_string(a)){i.left=i.left.right;return i.transform(a)}}if(a.option("evaluate")){switch(i.operator){case"&&":var m=p(i.left);if(!m){a.warn("Condition left of && always false [{file}:{line},{col}]",i.start);return aH(a,a.parent(),a.self(),i.left).optimize(a)}else{if(!(m instanceof AST_Node)){a.warn("Condition left of && always true [{file}:{line},{col}]",i.start);return ad(i,[i.left,i.right]).optimize(a)}}var c=i.right.evaluate(a);if(!c){if(a.option("booleans")&&a.in_boolean_context()){a.warn("Boolean && always false [{file}:{line},{col}]",i.start);return ad(i,[i.left,aK(AST_False,i)]).optimize(a)}else{i.falsy=true}}else{if(!(c instanceof AST_Node)){var l=a.parent();if(l.operator=="&&"&&l.left===a.self()||a.option("booleans")&&a.in_boolean_context()){a.warn("Dropping side-effect-free && [{file}:{line},{col}]",i.start);return i.left.optimize(a)}}}if(i.left.operator=="||"){var q=i.left.right.evaluate(a);if(!q){return aK(AST_Conditional,i,{condition:i.left.left,consequent:i.right,alternative:i.left.right}).optimize(a)}}break;case"||":var m=p(i.left);if(!m){a.warn("Condition left of || always false [{file}:{line},{col}]",i.start);return ad(i,[i.left,i.right]).optimize(a)}else{if(!(m instanceof AST_Node)){a.warn("Condition left of || always true [{file}:{line},{col}]",i.start);return aH(a,a.parent(),a.self(),i.left).optimize(a)}}var c=i.right.evaluate(a);if(!c){var l=a.parent();if(l.operator=="||"&&l.left===a.self()||a.option("booleans")&&a.in_boolean_context()){a.warn("Dropping side-effect-free || [{file}:{line},{col}]",i.start);return i.left.optimize(a)}}else{if(!(c instanceof AST_Node)){if(a.option("booleans")&&a.in_boolean_context()){a.warn("Boolean || always true [{file}:{line},{col}]",i.start);return ad(i,[i.left,aK(AST_True,i)]).optimize(a)}else{i.truthy=true}}}if(i.left.operator=="&&"){var q=i.left.right.evaluate(a);if(q&&!(q instanceof AST_Node)){return aK(AST_Conditional,i,{condition:i.left.left,consequent:i.left.right,alternative:i.right}).optimize(a)}}break}var f=true;switch(i.operator){case"+":if(i.left instanceof AST_Constant&&i.right instanceof AST_Binary&&i.right.operator=="+"&&i.right.left instanceof AST_Constant&&i.right.is_string(a)){i=aK(AST_Binary,i,{operator:"+",left:aK(AST_String,i.left,{value:""+i.left.getValue()+i.right.left.getValue(),start:i.left.start,end:i.right.left.end}),right:i.right.right})}if(i.right instanceof AST_Constant&&i.left instanceof AST_Binary&&i.left.operator=="+"&&i.left.right instanceof AST_Constant&&i.left.is_string(a)){i=aK(AST_Binary,i,{operator:"+",left:i.left.left,right:aK(AST_String,i.right,{value:""+i.left.right.getValue()+i.right.getValue(),start:i.left.right.start,end:i.right.end})})}if(i.left instanceof AST_Binary&&i.left.operator=="+"&&i.left.is_string(a)&&i.left.right instanceof AST_Constant&&i.right instanceof AST_Binary&&i.right.operator=="+"&&i.right.left instanceof AST_Constant&&i.right.is_string(a)){i=aK(AST_Binary,i,{operator:"+",left:aK(AST_Binary,i.left,{operator:"+",left:i.left.left,right:aK(AST_String,i.left.right,{value:""+i.left.right.getValue()+i.right.left.getValue(),start:i.left.right.start,end:i.right.left.end})}),right:i.right.right})}if(i.right instanceof AST_UnaryPrefix&&i.right.operator=="-"&&i.left.is_number(a)){i=aK(AST_Binary,i,{operator:"-",left:i.left,right:i.right.expression});break}if(i.left instanceof AST_UnaryPrefix&&i.left.operator=="-"&&g()&&i.right.is_number(a)){i=aK(AST_Binary,i,{operator:"-",left:i.right,right:i.left.expression});break}case"*":f=a.option("unsafe_math");case"&":case"|":case"^":if(i.left.is_number(a)&&i.right.is_number(a)&&g()&&!(i.left instanceof AST_Binary&&i.left.operator!=i.operator&&PRECEDENCE[i.left.operator]>=PRECEDENCE[i.operator])){var b=aK(AST_Binary,i,{operator:i.operator,left:i.right,right:i.left});if(i.right instanceof AST_Constant&&!(i.left instanceof AST_Constant)){i=aB(a,b,i)}else{i=aB(a,i,b)}}if(f&&i.is_number(a)){if(i.right instanceof AST_Binary&&i.right.operator==i.operator){i=aK(AST_Binary,i,{operator:i.operator,left:aK(AST_Binary,i.left,{operator:i.operator,left:i.left,right:i.right.left,start:i.left.start,end:i.right.left.end}),right:i.right.right})}if(i.right instanceof AST_Constant&&i.left instanceof AST_Binary&&i.left.operator==i.operator){if(i.left.left instanceof AST_Constant){i=aK(AST_Binary,i,{operator:i.operator,left:aK(AST_Binary,i.left,{operator:i.operator,left:i.left.left,right:i.right,start:i.left.left.start,end:i.right.end}),right:i.left.right})}else{if(i.left.right instanceof AST_Constant){i=aK(AST_Binary,i,{operator:i.operator,left:aK(AST_Binary,i.left,{operator:i.operator,left:i.left.right,right:i.right,start:i.left.right.start,end:i.right.end}),right:i.left.left})}}}if(i.left instanceof AST_Binary&&i.left.operator==i.operator&&i.left.right instanceof AST_Constant&&i.right instanceof AST_Binary&&i.right.operator==i.operator&&i.right.left instanceof AST_Constant){i=aK(AST_Binary,i,{operator:i.operator,left:aK(AST_Binary,i.left,{operator:i.operator,left:aK(AST_Binary,i.left.left,{operator:i.operator,left:i.left.right,right:i.right.left,start:i.left.right.start,end:i.right.left.end}),right:i.left.left}),right:i.right.right})}}}}if(i.right instanceof AST_Binary&&i.right.operator==i.operator&&(aD[i.operator]||(i.operator=="+"&&(i.right.left.is_string(a)||(i.left.is_string(a)&&i.right.right.is_string(a)))))){i.left=aK(AST_Binary,i.left,{operator:i.operator,left:i.left,right:i.right.left});i.right=i.right.right;return i.transform(a)}var n=i.evaluate(a);if(n!==i){n=ap(n,i).optimize(a);return aB(a,n,i)}return i;function p(r){if(r.truthy){return true}if(r.falsy){return false}if(r.is_truthy()){return true}return r.evaluate(a)}});function ai(e,a){var b;for(var c=0;b=e.parent(c);c++){if(b instanceof AST_Lambda){var d=b.name;if(d&&d.definition()===a){break}}}return b}X(AST_SymbolRef,function(n,p){var o=n.resolve_defines(p);if(o){return o.optimize(p)}if(!p.option("ie8")&&ac(n)&&(!n.scope.uses_with||!p.find_parent(AST_With))){switch(n.name){case"undefined":return aK(AST_Undefined,n).optimize(p);case"NaN":return aK(AST_NaN,n).optimize(p);case"Infinity":return aK(AST_Infinity,n).optimize(p)}}var r=p.parent();if(p.option("reduce_vars")&&aI(n,r)!==n){var i=n.definition();var d=n.fixed_value();var c=i.single_use&&!(r instanceof AST_Call&&r.is_expr_pure(p));if(c&&d instanceof AST_Lambda){if(i.scope!==n.scope&&(!p.option("reduce_funcs")||i.escaped==1||d.inlined)){c=false}else{if(ai(p,i)){c=false}else{if(i.scope!==n.scope||i.orig[0] instanceof AST_SymbolFunarg){c=d.is_constant_expression(n.scope);if(c=="f"){var g=n.scope;do{if(g instanceof AST_Defun||g instanceof AST_Function){g.inlined=true}}while(g=g.parent_scope)}}}}}if(c&&d){if(d instanceof AST_Defun){d._squeezed=true;d=aK(AST_Function,d,d)}var m;if(i.recursive_refs>0&&d.name instanceof AST_SymbolDefun){m=d.clone(true);var s=m.name.definition();var e=m.variables.get(m.name.name);var h=e&&e.orig[0];if(!(h instanceof AST_SymbolLambda)){h=aK(AST_SymbolLambda,m.name,m.name);h.scope=m;m.name=h;e=m.def_function(h)}m.walk(new TreeWalker(function(t){if(t instanceof AST_SymbolRef&&t.definition()===s){t.thedef=e;e.references.push(t)}}))}else{m=d.optimize(p);if(m===d){m=d.clone(true)}}return m}if(d&&i.should_replace===undefined){var k;if(d instanceof AST_This){if(!(i.orig[0] instanceof AST_SymbolFunarg)&&all(i.references,function(t){return i.scope===t.scope})){k=d}}else{var j=d.evaluate(p);if(j!==d&&(p.option("unsafe_regexp")||!(j instanceof RegExp))){k=ap(j,d)}}if(k){var a=k.optimize(p).print_to_string().length;var b;if(q(d)){b=function(){var t=k.optimize(p);return t===k?t.clone(true):t}}else{a=Math.min(a,d.print_to_string().length);b=function(){var t=aM(k.optimize(p),d);return t===k||t===d?t.clone(true):t}}var f=i.name.length;var l=0;if(p.option("unused")&&!p.exposed(i)){l=(f+2+a)/(i.references.length-i.assignments)}i.should_replace=a<=f+l?b:false}else{i.should_replace=false}}if(i.should_replace){return i.should_replace()}}return n;function q(t){var u;t.walk(new TreeWalker(function(v){if(v instanceof AST_SymbolRef){u=true}if(u){return true}}));return u}});function U(b,a){return b instanceof AST_SymbolRef||b.TYPE===a.TYPE}X(AST_Undefined,function(c,e){if(e.option("unsafe_undefined")){var b=aF(e,"undefined");if(b){var a=aK(AST_SymbolRef,c,{name:"undefined",scope:b.scope,thedef:b});a.is_undefined=true;return a}}var d=aI(e.self(),e.parent());if(d&&U(d,c)){return c}return aK(AST_UnaryPrefix,c,{operator:"void",expression:aK(AST_Number,c,{value:0})})});X(AST_Infinity,function(b,a){var c=aI(a.self(),a.parent());if(c&&U(c,b)){return b}if(a.option("keep_infinity")&&!(c&&!U(c,b))&&!aF(a,"Infinity")){return b}return aK(AST_Binary,b,{operator:"/",left:aK(AST_Number,b,{value:1}),right:aK(AST_Number,b,{value:0})})});X(AST_NaN,function(b,a){var c=aI(a.self(),a.parent());if(c&&!U(c,b)||aF(a,"NaN")){return aK(AST_Binary,b,{operator:"/",left:aK(AST_Number,b,{value:0}),right:aK(AST_Number,b,{value:0})})}return b});function aL(c,d){var a=false;var e=new TreeWalker(function(f){if(a){return true}if(f instanceof AST_SymbolRef&&member(f.definition(),d)){return a=true}});var b=new TreeWalker(function(f){if(a){return true}if(f instanceof AST_Scope&&f!==c){var g=b.parent();if(g instanceof AST_Call&&g.expression===f){return}f.walk(e);return true}});c.walk(b);return a}var al=makePredicate("+ - / * % >> << >>> | ^ &");var aC=makePredicate("* | ^ &");X(AST_Assign,function(c,e){var g;if(e.option("dead_code")&&c.left instanceof AST_SymbolRef&&(g=c.left.definition()).scope===e.find_parent(AST_Lambda)){var f=0,a,b=c;do{a=b;b=e.parent(f++);if(b instanceof AST_Exit){if(d(f,b)){break}if(aL(g.scope,[g])){break}if(c.operator=="="){return c.right}g.fixed=false;return aK(AST_Binary,c,{operator:c.operator.slice(0,-1),left:c.left,right:c.right}).optimize(e)}}while(b instanceof AST_Binary&&b.right===a||b instanceof AST_Sequence&&b.tail_node()===a)}c=c.lift_sequences(e);if(c.operator=="="&&c.left instanceof AST_SymbolRef&&c.right instanceof AST_Binary){if(c.right.left instanceof AST_SymbolRef&&c.right.left.name==c.left.name&&al[c.right.operator]){c.operator=c.right.operator+"=";c.right=c.right.right}else{if(c.right.right instanceof AST_SymbolRef&&c.right.right.name==c.left.name&&aC[c.right.operator]&&!c.right.left.has_side_effects(e)){c.operator=c.right.operator+"=";c.right=c.right.left}}}return c;function d(h,i){var l=c.right;c.right=aK(AST_Null,l);var m=i.may_throw(e);c.right=l;var j=c.left.definition().scope;var k;while((k=e.parent(h++))!==j){if(k instanceof AST_Try){if(k.bfinally){return true}if(m&&k.bcatch){return true}}}}});X(AST_Conditional,function(j,b){if(!b.option("conditionals")){return j}if(j.condition instanceof AST_Sequence){var p=j.condition.expressions.slice();j.condition=p.pop();p.push(j);return ad(j,p)}var l=j.condition.is_truthy()||j.condition.tail_node().evaluate(b);if(!l){b.warn("Condition always false [{file}:{line},{col}]",j.start);return ad(j,[j.condition,j.alternative]).optimize(b)}else{if(!(l instanceof AST_Node)){b.warn("Condition always true [{file}:{line},{col}]",j.start);return ad(j,[j.condition,j.consequent]).optimize(b)}}var h=l.negate(b,first_in_statement(b));if(aB(b,l,h)===h){j=aK(AST_Conditional,j,{condition:h,consequent:j.alternative,alternative:j.consequent})}var d=j.condition;var o=j.consequent;var f=j.alternative;if(d instanceof AST_SymbolRef&&o instanceof AST_SymbolRef&&d.definition()===o.definition()){return aK(AST_Binary,j,{operator:"||",left:d,right:f})}if(o instanceof AST_Assign&&f instanceof AST_Assign&&o.operator==f.operator&&o.left.equivalent_to(f.left)&&(!j.condition.has_side_effects(b)||o.operator=="="&&!o.left.has_side_effects(b))){return aK(AST_Assign,j,{operator:o.operator,left:o.left,right:aK(AST_Conditional,j,{condition:j.condition,consequent:o.right,alternative:f.right})})}var i;if(o instanceof AST_Call&&f.TYPE===o.TYPE&&o.args.length>0&&o.args.length==f.args.length&&o.expression.equivalent_to(f.expression)&&!j.condition.has_side_effects(b)&&!o.expression.has_side_effects(b)&&typeof(i=a())=="number"){var e=o.clone();e.args[i]=aK(AST_Conditional,j,{condition:j.condition,consequent:o.args[i],alternative:f.args[i]});return e}if(o instanceof AST_Conditional&&o.alternative.equivalent_to(f)){return aK(AST_Conditional,j,{condition:aK(AST_Binary,j,{left:j.condition,operator:"&&",right:o.condition}),consequent:o.consequent,alternative:f})}if(o.equivalent_to(f)){return ad(j,[j.condition,o]).optimize(b)}if((o instanceof AST_Sequence||f instanceof AST_Sequence)&&o.tail_node().equivalent_to(f.tail_node())){return ad(j,[aK(AST_Conditional,j,{condition:j.condition,consequent:g(o),alternative:g(f)}),o.tail_node()]).optimize(b)}if(o instanceof AST_Binary&&o.operator=="||"&&o.right.equivalent_to(f)){return aK(AST_Binary,j,{operator:"||",left:aK(AST_Binary,j,{operator:"&&",left:j.condition,right:o.left}),right:f}).optimize(b)}var n=b.option("booleans")&&b.in_boolean_context();if(c(j.consequent)){if(m(j.alternative)){return k(j.condition)}return aK(AST_Binary,j,{operator:"||",left:k(j.condition),right:j.alternative})}if(m(j.consequent)){if(c(j.alternative)){return k(j.condition.negate(b))}return aK(AST_Binary,j,{operator:"&&",left:k(j.condition.negate(b)),right:j.alternative})}if(c(j.alternative)){return aK(AST_Binary,j,{operator:"||",left:k(j.condition.negate(b)),right:j.consequent})}if(m(j.alternative)){return aK(AST_Binary,j,{operator:"&&",left:k(j.condition),right:j.consequent})}return j;function k(q){if(q.is_boolean()){return q}return aK(AST_UnaryPrefix,q,{operator:"!",expression:q.negate(b)})}function c(q){return q instanceof AST_True||n&&q instanceof AST_Constant&&q.getValue()||(q instanceof AST_UnaryPrefix&&q.operator=="!"&&q.expression instanceof AST_Constant&&!q.expression.getValue())}function m(q){return q instanceof AST_False||n&&q instanceof AST_Constant&&!q.getValue()||(q instanceof AST_UnaryPrefix&&q.operator=="!"&&q.expression instanceof AST_Constant&&q.expression.getValue())}function a(){var s=o.args;var t=f.args;for(var q=0,u=s.length;q<u;q++){if(!s[q].equivalent_to(t[q])){for(var r=q+1;r<u;r++){if(!s[r].equivalent_to(t[r])){return}}return q}}}function g(q){if(!(q instanceof AST_Sequence)){return aK(AST_Number,q,{value:0})}return ad(q,q.expressions.slice(0,-1))}});X(AST_Boolean,function(c,a){if(!a.option("booleans")){return c}if(a.in_boolean_context()){return aK(AST_Number,c,{value:+c.value})}var b=a.parent();if(b instanceof AST_Binary&&(b.operator=="=="||b.operator=="!=")){a.warn("Non-strict equality against boolean: {operator} {value} [{file}:{line},{col}]",{operator:b.operator,value:c.value,file:b.start.file,line:b.start.line,col:b.start.col});return aK(AST_Number,c,{value:+c.value})}return aK(AST_UnaryPrefix,c,{operator:"!",expression:aK(AST_Number,c,{value:1-c.value})})});X(AST_Sub,function(n,p){var f=n.expression;var e=n.property;if(p.option("properties")){var i=e.evaluate(p);if(i!==e){if(typeof i=="string"){if(i=="undefined"){i=undefined}else{var l=parseFloat(i);if(l.toString()==i){i=l}}}e=n.property=aM(e,ap(i,e).transform(p));var c=""+i;if(is_identifier_string(c)&&c.length<=e.print_to_string().length+1){return aK(AST_Dot,n,{expression:f,property:c}).optimize(p)}}}if(aI(n,p.parent())){return n}if(i!==e){var a=n.flatten_object(c,p);if(a){f=n.expression=a.expression;e=n.property=a.property}}if(p.option("properties")&&p.option("side_effects")&&e instanceof AST_Number&&f instanceof AST_Array){var b=e.getValue();var o=f.elements;if(b in o){var h=true;var g=[];for(var k=o.length;--k>b;){var l=o[k].drop_side_effect_free(p);if(l){g.unshift(l);if(h&&l.has_side_effects(p)){h=false}}}var m=o[b];m=m instanceof AST_Hole?aK(AST_Undefined,m):m;if(!h){g.unshift(m)}while(--k>=0){var l=o[k].drop_side_effect_free(p);if(l){g.unshift(l)}else{b--}}if(h){g.push(m);return ad(n,g).optimize(p)}else{return aK(AST_Sub,n,{expression:aK(AST_Array,f,{elements:g}),property:aK(AST_Number,e,{value:b})})}}}var r;if(p.option("arguments")&&f instanceof AST_SymbolRef&&f.name=="arguments"&&f.definition().orig.length==1&&(r=f.scope) instanceof AST_Lambda&&e instanceof AST_Number){var b=e.getValue();var d=r.argnames[b];if(!d&&!p.option("keep_fargs")){while(b>=r.argnames.length){d=aK(AST_SymbolFunarg,r,{name:r.make_var_name("argument_"+r.argnames.length),scope:r});r.argnames.push(d);r.enclosed.push(r.def_variable(d))}}if(d){var q=aK(AST_SymbolRef,n,d);q.reference({});return q}}var j=n.evaluate(p);if(j!==n){j=ap(j,n).optimize(p);return aB(p,j,n)}return n});AST_Scope.DEFMETHOD("contains_this",function(){var b;var a=this;a.walk(new TreeWalker(function(c){if(b){return true}if(c instanceof AST_This){return b=true}if(c!==a&&c instanceof AST_Scope){return true}}));return b});AST_PropAccess.DEFMETHOD("flatten_object",function(c,e){if(!e.option("properties")){return}var g=this.expression;if(g instanceof AST_Object){var b=g.properties;for(var d=b.length;--d>=0;){var f=b[d];if(""+f.key==c){if(!all(b,function(h){return h instanceof AST_ObjectKeyVal})){break}var a=f.value;if(a instanceof AST_Function&&!(e.parent() instanceof AST_New)&&a.contains_this()){break}return aK(AST_Sub,this,{expression:aK(AST_Array,g,{elements:b.map(function(h){return h.value})}),property:aK(AST_Number,this,{value:d})})}}}});X(AST_Dot,function(d,e){if(d.property=="arguments"||d.property=="caller"){e.warn("Function.protoype.{prop} not supported [{file}:{line},{col}]",{prop:d.property,file:d.start.file,line:d.start.line,col:d.start.col})}var a=d.resolve_defines(e);if(a){return a.optimize(e)}if(aI(d,e.parent())){return d}if(e.option("unsafe_proto")&&d.expression instanceof AST_Dot&&d.expression.property=="prototype"){var f=d.expression.expression;if(ac(f)){switch(f.name){case"Array":d.expression=aK(AST_Array,d.expression,{elements:[]});break;case"Function":d.expression=aK(AST_Function,d.expression,{argnames:[],body:[]});break;case"Number":d.expression=aK(AST_Number,d.expression,{value:0});break;case"Object":d.expression=aK(AST_Object,d.expression,{properties:[]});break;case"RegExp":d.expression=aK(AST_RegExp,d.expression,{value:/t/});break;case"String":d.expression=aK(AST_String,d.expression,{value:""});break}}}var c=d.flatten_object(d.property,e);if(c){return c.optimize(e)}var b=d.evaluate(e);if(b!==d){b=ap(b,d).optimize(e);return aB(e,b,d)}return d});X(AST_Return,function(b,a){if(b.value&&ab(b.value,a)){b.value=null}return b});X(AST_VarDef,function(c,a){var b=a.option("global_defs");if(b&&HOP(b,c.name.name)){a.warn("global_defs "+c.name.name+" redefined [{file}:{line},{col}]",c.start)}return c})})();