var Stream=require("stream");var tap=require("tap");var MS=require("../mute.js");var END={};var PAUSE={};var RESUME={};function PassThrough(){Stream.call(this);this.readable=this.writable=true}PassThrough.prototype=Object.create(Stream.prototype,{constructor:{value:PassThrough},write:{value:function(a){this.emit("data",a);return true}},end:{value:function(a){if(a){this.write(a)}this.emit("end")}},pause:{value:function(){this.emit("pause")}},resume:{value:function(){this.emit("resume")}}});tap.test("incoming",function(b){var a=new MS;var d=new PassThrough;d.pipe(a);var c=["foo","boo",END];a.on("data",function(e){b.equal(e,c.shift())});a.on("end",function(){b.equal(END,c.shift());b.end()});d.write("foo");a.mute();d.write("bar");a.unmute();d.write("boo");a.mute();d.write("blaz");d.end("grelb")});tap.test("outgoing",function(b){var a=new MS;var d=new PassThrough;a.pipe(d);var c=["foo","boo",END];d.on("data",function(e){b.equal(e,c.shift())});d.on("end",function(){b.equal(END,c.shift());b.end()});a.write("foo");a.mute();a.write("bar");a.unmute();a.write("boo");a.mute();a.write("blaz");a.end("grelb")});tap.test("isTTY",function(b){var c=new PassThrough;c.isTTY=true;c.columns=80;c.rows=24;var a=new MS;b.equal(a.isTTY,false);b.equal(a.columns,undefined);b.equal(a.rows,undefined);a.pipe(c);b.equal(a.isTTY,true);b.equal(a.columns,80);b.equal(a.rows,24);c.isTTY=false;b.equal(a.isTTY,false);b.equal(a.columns,80);b.equal(a.rows,24);c.isTTY=true;b.equal(a.isTTY,true);b.equal(a.columns,80);b.equal(a.rows,24);a.isTTY=false;b.equal(a.isTTY,false);b.equal(a.columns,80);b.equal(a.rows,24);a=new MS;b.equal(a.isTTY,false);c.pipe(a);b.equal(a.isTTY,true);c.isTTY=false;b.equal(a.isTTY,false);c.isTTY=true;b.equal(a.isTTY,true);a.isTTY=false;b.equal(a.isTTY,false);b.end()});tap.test("pause/resume incoming",function(b){var d=new PassThrough;var a=new MS;d.on("pause",function(){b.equal(PAUSE,c.shift())});d.on("resume",function(){b.equal(RESUME,c.shift())});var c=[PAUSE,RESUME,PAUSE,RESUME];d.pipe(a);a.pause();a.resume();a.pause();a.resume();b.equal(c.length,0,"saw all events");b.end()});tap.test("replace with *",function(b){var d=new PassThrough;var a=new MS({replace:"*"});d.pipe(a);var c=["foo","*****","bar","***","baz","boo","**","****"];a.on("data",function(e){b.equal(e,c.shift())});d.write("foo");a.mute();d.write("12345");a.unmute();d.write("bar");a.mute();d.write("baz");a.unmute();d.write("baz");d.write("boo");a.mute();d.write("xy");d.write("xyzΩ");b.equal(c.length,0);b.end()});tap.test("replace with ~YARG~",function(b){var d=new PassThrough;var a=new MS({replace:"~YARG~"});d.pipe(a);var c=["foo","~YARG~~YARG~~YARG~~YARG~~YARG~","bar","~YARG~~YARG~~YARG~","baz","boo","~YARG~~YARG~","~YARG~~YARG~~YARG~~YARG~"];a.on("data",function(e){b.equal(e,c.shift())});d.write("foo");a.mute();d.write("ΩΩ");a.unmute();d.write("bar");a.mute();d.write("Ω");a.unmute();d.write("baz");d.write("boo");a.mute();d.write("Ω");d.write("ΩΩ");b.equal(c.length,0);b.end()});