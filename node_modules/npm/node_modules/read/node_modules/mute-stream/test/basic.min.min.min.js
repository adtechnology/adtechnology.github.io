var Stream=require("stream");var tap=require("tap");var MS=require("../mute.js");var END={};var PAUSE={};var RESUME={};function PassThrough(){Stream.call(this);this.readable=this.writable=true}PassThrough.prototype=Object.create(Stream.prototype,{constructor:{value:PassThrough},write:{value:function(a){this.emit("data",a);return true}},end:{value:function(a){if(a){this.write(a)}this.emit("end")}},pause:{value:function(){this.emit("pause")}},resume:{value:function(){this.emit("resume")}}});tap.test("incoming",function(d){var c=new MS;var b=new PassThrough;b.pipe(c);var a=["foo","boo",END];c.on("data",function(e){d.equal(e,a.shift())});c.on("end",function(){d.equal(END,a.shift());d.end()});b.write("foo");c.mute();b.write("bar");c.unmute();b.write("boo");c.mute();b.write("blaz");b.end("grelb")});tap.test("outgoing",function(d){var c=new MS;var b=new PassThrough;c.pipe(b);var a=["foo","boo",END];b.on("data",function(e){d.equal(e,a.shift())});b.on("end",function(){d.equal(END,a.shift());d.end()});c.write("foo");c.mute();c.write("bar");c.unmute();c.write("boo");c.mute();c.write("blaz");c.end("grelb")});tap.test("isTTY",function(c){var a=new PassThrough;a.isTTY=true;a.columns=80;a.rows=24;var b=new MS;c.equal(b.isTTY,false);c.equal(b.columns,undefined);c.equal(b.rows,undefined);b.pipe(a);c.equal(b.isTTY,true);c.equal(b.columns,80);c.equal(b.rows,24);a.isTTY=false;c.equal(b.isTTY,false);c.equal(b.columns,80);c.equal(b.rows,24);a.isTTY=true;c.equal(b.isTTY,true);c.equal(b.columns,80);c.equal(b.rows,24);b.isTTY=false;c.equal(b.isTTY,false);c.equal(b.columns,80);c.equal(b.rows,24);b=new MS;c.equal(b.isTTY,false);a.pipe(b);c.equal(b.isTTY,true);a.isTTY=false;c.equal(b.isTTY,false);a.isTTY=true;c.equal(b.isTTY,true);b.isTTY=false;c.equal(b.isTTY,false);c.end()});tap.test("pause/resume incoming",function(d){var b=new PassThrough;var c=new MS;b.on("pause",function(){d.equal(PAUSE,a.shift())});b.on("resume",function(){d.equal(RESUME,a.shift())});var a=[PAUSE,RESUME,PAUSE,RESUME];b.pipe(c);c.pause();c.resume();c.pause();c.resume();d.equal(a.length,0,"saw all events");d.end()});tap.test("replace with *",function(d){var b=new PassThrough;var c=new MS({replace:"*"});b.pipe(c);var a=["foo","*****","bar","***","baz","boo","**","****"];c.on("data",function(e){d.equal(e,a.shift())});b.write("foo");c.mute();b.write("12345");c.unmute();b.write("bar");c.mute();b.write("baz");c.unmute();b.write("baz");b.write("boo");c.mute();b.write("xy");b.write("xyzΩ");d.equal(a.length,0);d.end()});tap.test("replace with ~YARG~",function(d){var b=new PassThrough;var c=new MS({replace:"~YARG~"});b.pipe(c);var a=["foo","~YARG~~YARG~~YARG~~YARG~~YARG~","bar","~YARG~~YARG~~YARG~","baz","boo","~YARG~~YARG~","~YARG~~YARG~~YARG~~YARG~"];c.on("data",function(e){d.equal(e,a.shift())});b.write("foo");c.mute();b.write("ΩΩ");c.unmute();b.write("bar");c.mute();b.write("Ω");c.unmute();b.write("baz");b.write("boo");c.mute();b.write("Ω");b.write("ΩΩ");d.equal(a.length,0);d.end()});