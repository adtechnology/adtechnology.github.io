var Stream=require("stream");var tap=require("tap");var MS=require("../mute.js");var END={};var PAUSE={};var RESUME={};function PassThrough(){Stream.call(this);this.readable=this.writable=true}PassThrough.prototype=Object.create(Stream.prototype,{constructor:{value:PassThrough},write:{value:function(b){this.emit("data",b);return true}},end:{value:function(b){if(b){this.write(b)}this.emit("end")}},pause:{value:function(){this.emit("pause")}},resume:{value:function(){this.emit("resume")}}});tap.test("incoming",function(g){var h=new MS;var e=new PassThrough;e.pipe(h);var f=["foo","boo",END];h.on("data",function(a){g.equal(a,f.shift())});h.on("end",function(){g.equal(END,f.shift());g.end()});e.write("foo");h.mute();e.write("bar");h.unmute();e.write("boo");h.mute();e.write("blaz");e.end("grelb")});tap.test("outgoing",function(g){var h=new MS;var e=new PassThrough;h.pipe(e);var f=["foo","boo",END];e.on("data",function(a){g.equal(a,f.shift())});e.on("end",function(){g.equal(END,f.shift());g.end()});h.write("foo");h.mute();h.write("bar");h.unmute();h.write("boo");h.mute();h.write("blaz");h.end("grelb")});tap.test("isTTY",function(f){var e=new PassThrough;e.isTTY=true;e.columns=80;e.rows=24;var d=new MS;f.equal(d.isTTY,false);f.equal(d.columns,undefined);f.equal(d.rows,undefined);d.pipe(e);f.equal(d.isTTY,true);f.equal(d.columns,80);f.equal(d.rows,24);e.isTTY=false;f.equal(d.isTTY,false);f.equal(d.columns,80);f.equal(d.rows,24);e.isTTY=true;f.equal(d.isTTY,true);f.equal(d.columns,80);f.equal(d.rows,24);d.isTTY=false;f.equal(d.isTTY,false);f.equal(d.columns,80);f.equal(d.rows,24);d=new MS;f.equal(d.isTTY,false);e.pipe(d);f.equal(d.isTTY,true);e.isTTY=false;f.equal(d.isTTY,false);e.isTTY=true;f.equal(d.isTTY,true);d.isTTY=false;f.equal(d.isTTY,false);f.end()});tap.test("pause/resume incoming",function(g){var e=new PassThrough;var h=new MS;e.on("pause",function(){g.equal(PAUSE,f.shift())});e.on("resume",function(){g.equal(RESUME,f.shift())});var f=[PAUSE,RESUME,PAUSE,RESUME];e.pipe(h);h.pause();h.resume();h.pause();h.resume();g.equal(f.length,0,"saw all events");g.end()});tap.test("replace with *",function(g){var e=new PassThrough;var h=new MS({replace:"*"});e.pipe(h);var f=["foo","*****","bar","***","baz","boo","**","****"];h.on("data",function(a){g.equal(a,f.shift())});e.write("foo");h.mute();e.write("12345");h.unmute();e.write("bar");h.mute();e.write("baz");h.unmute();e.write("baz");e.write("boo");h.mute();e.write("xy");e.write("xyzΩ");g.equal(f.length,0);g.end()});tap.test("replace with ~YARG~",function(g){var e=new PassThrough;var h=new MS({replace:"~YARG~"});e.pipe(h);var f=["foo","~YARG~~YARG~~YARG~~YARG~~YARG~","bar","~YARG~~YARG~~YARG~","baz","boo","~YARG~~YARG~","~YARG~~YARG~~YARG~~YARG~"];h.on("data",function(a){g.equal(a,f.shift())});e.write("foo");h.mute();e.write("ΩΩ");h.unmute();e.write("bar");h.mute();e.write("Ω");h.unmute();e.write("baz");e.write("boo");h.mute();e.write("Ω");e.write("ΩΩ");g.equal(f.length,0);g.end()});