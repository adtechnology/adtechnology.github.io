var Stream=require("stream");var tap=require("tap");var MS=require("../mute.js");var END={};var PAUSE={};var RESUME={};function PassThrough(){Stream.call(this);this.readable=this.writable=true}PassThrough.prototype=Object.create(Stream.prototype,{constructor:{value:PassThrough},write:{value:function(b){this.emit("data",b);return true}},end:{value:function(b){if(b){this.write(b)}this.emit("end")}},pause:{value:function(){this.emit("pause")}},resume:{value:function(){this.emit("resume")}}});tap.test("incoming",function(e){var f=new MS;var g=new PassThrough;g.pipe(f);var h=["foo","boo",END];f.on("data",function(a){e.equal(a,h.shift())});f.on("end",function(){e.equal(END,h.shift());e.end()});g.write("foo");f.mute();g.write("bar");f.unmute();g.write("boo");f.mute();g.write("blaz");g.end("grelb")});tap.test("outgoing",function(e){var f=new MS;var g=new PassThrough;f.pipe(g);var h=["foo","boo",END];g.on("data",function(a){e.equal(a,h.shift())});g.on("end",function(){e.equal(END,h.shift());e.end()});f.write("foo");f.mute();f.write("bar");f.unmute();f.write("boo");f.mute();f.write("blaz");f.end("grelb")});tap.test("isTTY",function(d){var f=new PassThrough;f.isTTY=true;f.columns=80;f.rows=24;var e=new MS;d.equal(e.isTTY,false);d.equal(e.columns,undefined);d.equal(e.rows,undefined);e.pipe(f);d.equal(e.isTTY,true);d.equal(e.columns,80);d.equal(e.rows,24);f.isTTY=false;d.equal(e.isTTY,false);d.equal(e.columns,80);d.equal(e.rows,24);f.isTTY=true;d.equal(e.isTTY,true);d.equal(e.columns,80);d.equal(e.rows,24);e.isTTY=false;d.equal(e.isTTY,false);d.equal(e.columns,80);d.equal(e.rows,24);e=new MS;d.equal(e.isTTY,false);f.pipe(e);d.equal(e.isTTY,true);f.isTTY=false;d.equal(e.isTTY,false);f.isTTY=true;d.equal(e.isTTY,true);e.isTTY=false;d.equal(e.isTTY,false);d.end()});tap.test("pause/resume incoming",function(e){var g=new PassThrough;var f=new MS;g.on("pause",function(){e.equal(PAUSE,h.shift())});g.on("resume",function(){e.equal(RESUME,h.shift())});var h=[PAUSE,RESUME,PAUSE,RESUME];g.pipe(f);f.pause();f.resume();f.pause();f.resume();e.equal(h.length,0,"saw all events");e.end()});tap.test("replace with *",function(e){var g=new PassThrough;var f=new MS({replace:"*"});g.pipe(f);var h=["foo","*****","bar","***","baz","boo","**","****"];f.on("data",function(a){e.equal(a,h.shift())});g.write("foo");f.mute();g.write("12345");f.unmute();g.write("bar");f.mute();g.write("baz");f.unmute();g.write("baz");g.write("boo");f.mute();g.write("xy");g.write("xyzΩ");e.equal(h.length,0);e.end()});tap.test("replace with ~YARG~",function(e){var g=new PassThrough;var f=new MS({replace:"~YARG~"});g.pipe(f);var h=["foo","~YARG~~YARG~~YARG~~YARG~~YARG~","bar","~YARG~~YARG~~YARG~","baz","boo","~YARG~~YARG~","~YARG~~YARG~~YARG~~YARG~"];f.on("data",function(a){e.equal(a,h.shift())});g.write("foo");f.mute();g.write("ΩΩ");f.unmute();g.write("bar");f.mute();g.write("Ω");f.unmute();g.write("baz");g.write("boo");f.mute();g.write("Ω");g.write("ΩΩ");e.equal(h.length,0);e.end()});