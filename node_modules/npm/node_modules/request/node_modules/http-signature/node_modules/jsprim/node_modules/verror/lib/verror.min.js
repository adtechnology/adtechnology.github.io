var mod_assertplus=require("assert-plus");var mod_util=require("util");var mod_extsprintf=require("extsprintf");var mod_isError=require("core-util-is").isError;var sprintf=mod_extsprintf.sprintf;module.exports=VError;VError.VError=VError;VError.SError=SError;VError.WError=WError;VError.MultiError=MultiError;function parseConstructorArguments(f){var b,e,a,d,c;mod_assertplus.object(f,"args");mod_assertplus.bool(f.strict,"args.strict");mod_assertplus.array(f.argv,"args.argv");b=f.argv;if(b.length===0){e={};a=[]}else{if(mod_isError(b[0])){e={cause:b[0]};a=b.slice(1)}else{if(typeof(b[0])==="object"){e={};for(c in b[0]){e[c]=b[0][c]}a=b.slice(1)}else{mod_assertplus.string(b[0],"first argument to VError, SError, or WError constructor must be a string, object, or Error");e={};a=b}}}mod_assertplus.object(e);if(!e.strict&&!f.strict){a=a.map(function(g){return(g===null?"null":g===undefined?"undefined":g)})}if(a.length===0){d=""}else{d=sprintf.apply(null,a)}return({options:e,shortmessage:d})}function VError(){var c,g,b,f,e,d,a;c=Array.prototype.slice.call(arguments,0);if(!(this instanceof VError)){g=Object.create(VError.prototype);VError.apply(g,arguments);return(g)}b=parseConstructorArguments({argv:c,strict:false});if(b.options.name){mod_assertplus.string(b.options.name,'error\'s "name" must be a string');this.name=b.options.name}this.jse_shortmsg=b.shortmessage;d=b.shortmessage;f=b.options.cause;if(f){mod_assertplus.ok(mod_isError(f),"cause is not an Error");this.jse_cause=f;if(!b.options.skipCauseMessage){d+=": "+f.message}}this.jse_info={};if(b.options.info){for(a in b.options.info){this.jse_info[a]=b.options.info[a]}}this.message=d;Error.call(this,d);if(Error.captureStackTrace){e=b.options.constructorOpt||this.constructor;Error.captureStackTrace(this,e)}return(this)}mod_util.inherits(VError,Error);VError.prototype.name="VError";VError.prototype.toString=function ve_toString(){var a=(this.hasOwnProperty("name")&&this.name||this.constructor.name||this.constructor.prototype.name);if(this.message){a+=": "+this.message}return(a)};VError.prototype.cause=function ve_cause(){var a=VError.cause(this);return(a===null?undefined:a)};VError.cause=function(a){mod_assertplus.ok(mod_isError(a),"err must be an Error");return(mod_isError(a.jse_cause)?a.jse_cause:null)};VError.info=function(b){var d,c,a;mod_assertplus.ok(mod_isError(b),"err must be an Error");c=VError.cause(b);if(c!==null){d=VError.info(c)}else{d={}}if(typeof(b.jse_info)=="object"&&b.jse_info!==null){for(a in b.jse_info){d[a]=b.jse_info[a]}}return(d)};VError.findCauseByName=function(b,a){var c;mod_assertplus.ok(mod_isError(b),"err must be an Error");mod_assertplus.string(a,"name");mod_assertplus.ok(a.length>0,"name cannot be empty");for(c=b;c!==null;c=VError.cause(c)){mod_assertplus.ok(mod_isError(c));if(c.name==a){return(c)}}return(null)};VError.hasCauseWithName=function(b,a){return(VError.findCauseByName(b,a)!==null)};VError.fullStack=function(a){mod_assertplus.ok(mod_isError(a),"err must be an Error");var b=VError.cause(a);if(b){return(a.stack+"\ncaused by: "+VError.fullStack(b))}return(a.stack)};VError.errorFromList=function(a){mod_assertplus.arrayOfObject(a,"errors");if(a.length===0){return(null)}a.forEach(function(b){mod_assertplus.ok(mod_isError(b))});if(a.length==1){return(a[0])}return(new MultiError(a))};VError.errorForEach=function(c,b){mod_assertplus.ok(mod_isError(c),"err must be an Error");mod_assertplus.func(b,"func");if(c instanceof MultiError){c.errors().forEach(function a(d){b(d)})}else{b(c)}};function SError(){var c,d,a,b;c=Array.prototype.slice.call(arguments,0);if(!(this instanceof SError)){d=Object.create(SError.prototype);SError.apply(d,arguments);return(d)}a=parseConstructorArguments({argv:c,strict:true});b=a.options;VError.call(this,b,"%s",a.shortmessage);return(this)}mod_util.inherits(SError,VError);function MultiError(a){mod_assertplus.array(a,"list of errors");mod_assertplus.ok(a.length>0,"must be at least one error");this.ase_errors=a;VError.call(this,{cause:a[0]},"first of %d error%s",a.length,a.length==1?"":"s")}mod_util.inherits(MultiError,VError);MultiError.prototype.name="MultiError";MultiError.prototype.errors=function me_errors(){return(this.ase_errors.slice(0))};function WError(){var c,d,a,b;c=Array.prototype.slice.call(arguments,0);if(!(this instanceof WError)){d=Object.create(WError.prototype);WError.apply(d,c);return(d)}a=parseConstructorArguments({argv:c,strict:false});b=a.options;b.skipCauseMessage=true;VError.call(this,b,"%s",a.shortmessage);return(this)}mod_util.inherits(WError,VError);WError.prototype.name="WError";WError.prototype.toString=function we_toString(){var a=(this.hasOwnProperty("name")&&this.name||this.constructor.name||this.constructor.prototype.name);if(this.message){a+=": "+this.message}if(this.jse_cause&&this.jse_cause.message){a+="; caused by "+this.jse_cause.toString()}return(a)};WError.prototype.cause=function we_cause(a){if(mod_isError(a)){this.jse_cause=a}return(this.jse_cause)};