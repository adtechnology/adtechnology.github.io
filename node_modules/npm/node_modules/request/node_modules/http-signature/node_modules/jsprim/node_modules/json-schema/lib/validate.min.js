(function(a,b){if(typeof define==="function"&&define.amd){define([],function(){return b()})}else{if(typeof module==="object"&&module.exports){module.exports=b()}else{a.jsonSchema=b()}}}(this,function(){var a=c;a.Integer={type:"integer"};var b={String:String,Boolean:Boolean,Number:Number,Object:Object,Array:Array,Date:Date};a.validate=c;function c(d,e){return c(d,e,{changing:false})}a.checkPropertyChange=function(f,d,e){return c(f,d,{changing:e||"property"})};var c=a._validate=function(e,i,f){if(!f){f={}}var d=f.changing;function j(l){return l.type||(b[l.name]==l&&l.name.toLowerCase())}var k=[];function h(s,o,w,q){var n;w+=w?typeof q=="number"?"["+q+"]":typeof q=="undefined"?"":"."+q:q;function x(l){k.push({property:w,message:l})}if((typeof o!="object"||o instanceof Array)&&(w||typeof o!="function")&&!(o&&j(o))){if(typeof o=="function"){if(!(s instanceof o)){x("is not an instance of the class/constructor "+o.name)}}else{if(o){x("Invalid schema/property definition "+o)}}return null}if(d&&o.readonly){x("is a readonly field, it can not be changed")}if(o["extends"]){h(s,o["extends"],w,q)}function m(B,C){if(B){if(typeof B=="string"&&B!="any"&&(B=="null"?C!==null:typeof C!=B)&&!(C instanceof Array&&B=="array")&&!(C instanceof Date&&B=="date")&&!(B=="integer"&&C%1===0)){return[{property:w,message:(typeof C)+" value found, but a "+B+" is required"}]}if(B instanceof Array){var A=[];for(var z=0;z<B.length;z++){if(!(A=m(B[z],C)).length){break}}if(A.length){return A}}else{if(typeof B=="object"){var l=k;k=[];h(C,B,w);var y=k;k=l;return y}}}return[]}if(s===undefined){if(o.required){x("is missing and it is required")}}else{k=k.concat(m(j(o),s));if(o.disallow&&!m(o.disallow,s).length){x(" disallowed value was matched")}if(s!==null){if(s instanceof Array){if(o.items){var t=o.items instanceof Array;var v=o.items;for(q=0,n=s.length;q<n;q+=1){if(t){v=o.items[q]}if(f.coerce){s[q]=f.coerce(s[q],v)}k.concat(h(s[q],v,w,q))}}if(o.minItems&&s.length<o.minItems){x("There must be a minimum of "+o.minItems+" in the array")}if(o.maxItems&&s.length>o.maxItems){x("There must be a maximum of "+o.maxItems+" in the array")}}else{if(o.properties||o.additionalProperties){k.concat(g(s,o.properties,w,o.additionalProperties))}}if(o.pattern&&typeof s=="string"&&!s.match(o.pattern)){x("does not match the regex pattern "+o.pattern)}if(o.maxLength&&typeof s=="string"&&s.length>o.maxLength){x("may only be "+o.maxLength+" characters long")}if(o.minLength&&typeof s=="string"&&s.length<o.minLength){x("must be at least "+o.minLength+" characters long")}if(typeof o.minimum!==undefined&&typeof s==typeof o.minimum&&o.minimum>s){x("must have a minimum value of "+o.minimum)}if(typeof o.maximum!==undefined&&typeof s==typeof o.maximum&&o.maximum<s){x("must have a maximum value of "+o.maximum)}if(o["enum"]){var r=o["enum"];n=r.length;var u;for(var p=0;p<n;p++){if(r[p]===s){u=1;break}}if(!u){x("does not have a value in the enumeration "+r.join(", "))}}if(typeof o.maxDecimal=="number"&&(s.toString().match(new RegExp("\\.[0-9]{"+(o.maxDecimal+1)+",}")))){x("may only have "+o.maxDecimal+" digits of decimal places")}}}return null}function g(l,m,r,q){if(typeof m=="object"){if(typeof l!="object"||l instanceof Array){k.push({property:r,message:"an object is required"})}for(var n in m){if(m.hasOwnProperty(n)){var p=l[n];if(p===undefined&&f.existingOnly){continue}var s=m[n];if(p===undefined&&s["default"]){p=l[n]=s["default"]}if(f.coerce&&n in l){p=l[n]=f.coerce(p,s)}h(p,s,r,n)}}}for(n in l){if(l.hasOwnProperty(n)&&!(n.charAt(0)=="_"&&n.charAt(1)=="_")&&m&&!m[n]&&q===false){if(f.filter){delete l[n];continue}else{k.push({property:r,message:(typeof p)+"The property "+n+" is not defined in the schema and the schema does not allow additional properties"})}}var o=m&&m[n]&&m[n].requires;if(o&&!(o in l)){k.push({property:r,message:"the presence of the property "+n+" requires that "+o+" also be present"})}p=l[n];if(q&&(!(m&&typeof m=="object")||!(n in m))){if(f.coerce){p=l[n]=f.coerce(p,q)}h(p,q,r,n)}if(!d&&p&&p.$schema){k=k.concat(h(p,p.$schema,r,n))}}return k}if(i){h(e,i,"",d||"")}if(!d&&e&&e.$schema){h(e,e.$schema,"","")}return{valid:!k.length,errors:k}};a.mustBeValid=function(d){if(!d.valid){throw new TypeError(d.errors.map(function(e){return"for property "+e.property+": "+e.message}).join(", \n"))}};return a}));