var x509=require("./x509");module.exports={read:read,verify:x509.verify,sign:x509.sign,write:write};var assert=require("assert-plus");var asn1=require("asn1");var algs=require("../algs");var utils=require("../utils");var Key=require("../key");var PrivateKey=require("../private-key");var pem=require("./pem");var Identity=require("../identity");var Signature=require("../signature");var Certificate=require("../certificate");function read(l,g){if(typeof(l)!=="string"){assert.buffer(l,"buf");l=l.toString("ascii")}var i=l.trim().split(/[\r\n]+/g);var j=i[0].match(/[-]+[ ]*BEGIN CERTIFICATE[ ]*[-]+/);assert.ok(j,"invalid PEM header");var h=i[i.length-1].match(/[-]+[ ]*END CERTIFICATE[ ]*[-]+/);assert.ok(h,"invalid PEM footer");var k={};while(true){i=i.slice(1);j=i[0].match(/^([A-Za-z0-9-]+): (.+)$/);if(!j){break}k[j[1].toLowerCase()]=j[2]}i=i.slice(0,-1).join("");l=new Buffer(i,"base64");return(x509.read(l,g))}function write(q,m){var l=x509.write(q,m);var o="CERTIFICATE";var p=l.toString("base64");var n=p.length+(p.length/64)+18+16+o.length*2+10;var t=new Buffer(n);var i=0;i+=t.write("-----BEGIN "+o+"-----\n",i);for(var r=0;r<p.length;){var s=r+64;if(s>p.length){s=p.length}i+=t.write(p.slice(r,s),i);t[i++]=10;r=s}i+=t.write("-----END "+o+"-----\n",i);return(t.slice(0,i))};