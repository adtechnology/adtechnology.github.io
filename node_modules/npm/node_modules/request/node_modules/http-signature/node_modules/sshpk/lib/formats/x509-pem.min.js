var x509=require("./x509");module.exports={read:read,verify:x509.verify,sign:x509.sign,write:write};var assert=require("assert-plus");var asn1=require("asn1");var algs=require("../algs");var utils=require("../utils");var Key=require("../key");var PrivateKey=require("../private-key");var pem=require("./pem");var Identity=require("../identity");var Signature=require("../signature");var Certificate=require("../certificate");function read(e,d){if(typeof(e)!=="string"){assert.buffer(e,"buf");e=e.toString("ascii")}var b=e.trim().split(/[\r\n]+/g);var a=b[0].match(/[-]+[ ]*BEGIN CERTIFICATE[ ]*[-]+/);assert.ok(a,"invalid PEM header");var c=b[b.length-1].match(/[-]+[ ]*END CERTIFICATE[ ]*[-]+/);assert.ok(c,"invalid PEM footer");var f={};while(true){b=b.slice(1);a=b[0].match(/^([A-Za-z0-9-]+): (.+)$/);if(!a){break}f[a[1].toLowerCase()]=a[2]}b=b.slice(0,-1).join("");e=new Buffer(b,"base64");return(x509.read(e,d))}function write(f,k){var a=x509.write(f,k);var h="CERTIFICATE";var g=a.toString("base64");var j=g.length+(g.length/64)+18+16+h.length*2+10;var c=new Buffer(j);var b=0;b+=c.write("-----BEGIN "+h+"-----\n",b);for(var e=0;e<g.length;){var d=e+64;if(d>g.length){d=g.length}b+=c.write(g.slice(e,d),b);c[b++]=10;e=d}b+=c.write("-----END "+h+"-----\n",b);return(c.slice(0,b))};