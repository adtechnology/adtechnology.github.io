module.exports={read:read,write:write};var assert=require("assert-plus");var utils=require("../utils");var Key=require("../key");var PrivateKey=require("../private-key");var pem=require("./pem");var ssh=require("./ssh");var rfc4253=require("./rfc4253");var dnssec=require("./dnssec");var DNSSEC_PRIVKEY_HEADER_PREFIX="Private-key-format: v1";function read(b,a){if(typeof(b)==="string"){if(b.trim().match(/^[-]+[ ]*BEGIN/)){return(pem.read(b,a))}if(b.match(/^\s*ssh-[a-z]/)){return(ssh.read(b,a))}if(b.match(/^\s*ecdsa-/)){return(ssh.read(b,a))}if(findDNSSECHeader(b)){return(dnssec.read(b,a))}b=new Buffer(b,"binary")}else{assert.buffer(b);if(findPEMHeader(b)){return(pem.read(b,a))}if(findSSHHeader(b)){return(ssh.read(b,a))}if(findDNSSECHeader(b)){return(dnssec.read(b,a))}}if(b.readUInt32BE(0)<b.length){return(rfc4253.read(b,a))}throw (new Error("Failed to auto-detect format of key"))}function findSSHHeader(a){var b=0;while(b<a.length&&(a[b]===32||a[b]===10||a[b]===9)){++b}if(b+4<=a.length&&a.slice(b,b+4).toString("ascii")==="ssh-"){return(true)}if(b+6<=a.length&&a.slice(b,b+6).toString("ascii")==="ecdsa-"){return(true)}return(false)}function findPEMHeader(a){var b=0;while(b<a.length&&(a[b]===32||a[b]===10)){++b}if(a[b]!==45){return(false)}while(b<a.length&&(a[b]===45)){++b}while(b<a.length&&(a[b]===32)){++b}if(b+5>a.length||a.slice(b,b+5).toString("ascii")!=="BEGIN"){return(false)}return(true)}function findDNSSECHeader(a){if(a.length<=DNSSEC_PRIVKEY_HEADER_PREFIX.length){return(false)}var b=a.slice(0,DNSSEC_PRIVKEY_HEADER_PREFIX.length);if(b.toString("ascii")===DNSSEC_PRIVKEY_HEADER_PREFIX){return(true)}if(typeof(a)!=="string"){a=a.toString("ascii")}var d=a.split("\n");var c=0;while(d[c].match(/^\;/)){c++}if(d[c].toString("ascii").match(/\. IN KEY /)){return(true)}if(d[c].toString("ascii").match(/\. IN DNSKEY /)){return(true)}return(false)}function write(b,a){throw (new Error('"auto" format cannot be used for writing'))};