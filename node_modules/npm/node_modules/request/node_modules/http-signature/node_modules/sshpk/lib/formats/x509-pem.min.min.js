var x509=require("./x509");module.exports={read:read,verify:x509.verify,sign:x509.sign,write:write};var assert=require("assert-plus");var asn1=require("asn1");var algs=require("../algs");var utils=require("../utils");var Key=require("../key");var PrivateKey=require("../private-key");var pem=require("./pem");var Identity=require("../identity");var Signature=require("../signature");var Certificate=require("../certificate");function read(j,k){if(typeof(j)!=="string"){assert.buffer(j,"buf");j=j.toString("ascii")}var g=j.trim().split(/[\r\n]+/g);var h=g[0].match(/[-]+[ ]*BEGIN CERTIFICATE[ ]*[-]+/);assert.ok(h,"invalid PEM header");var l=g[g.length-1].match(/[-]+[ ]*END CERTIFICATE[ ]*[-]+/);assert.ok(l,"invalid PEM footer");var i={};while(true){g=g.slice(1);h=g[0].match(/^([A-Za-z0-9-]+): (.+)$/);if(!h){break}i[h[1].toLowerCase()]=h[2]}g=g.slice(0,-1).join("");j=new Buffer(g,"base64");return(x509.read(j,k))}function write(o,i){var t=x509.write(o,i);var m="CERTIFICATE";var n=t.toString("base64");var l=n.length+(n.length/64)+18+16+m.length*2+10;var r=new Buffer(l);var s=0;s+=r.write("-----BEGIN "+m+"-----\n",s);for(var p=0;p<n.length;){var q=p+64;if(q>n.length){q=n.length}s+=r.write(n.slice(p,q),s);r[s++]=10;p=q}s+=r.write("-----END "+m+"-----\n",s);return(r.slice(0,s))};