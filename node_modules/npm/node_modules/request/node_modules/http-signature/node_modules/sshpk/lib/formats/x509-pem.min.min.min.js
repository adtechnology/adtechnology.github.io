var x509=require("./x509");module.exports={read:read,verify:x509.verify,sign:x509.sign,write:write};var assert=require("assert-plus");var asn1=require("asn1");var algs=require("../algs");var utils=require("../utils");var Key=require("../key");var PrivateKey=require("../private-key");var pem=require("./pem");var Identity=require("../identity");var Signature=require("../signature");var Certificate=require("../certificate");function read(c,b){if(typeof(c)!=="string"){assert.buffer(c,"buf");c=c.toString("ascii")}var f=c.trim().split(/[\r\n]+/g);var e=f[0].match(/[-]+[ ]*BEGIN CERTIFICATE[ ]*[-]+/);assert.ok(e,"invalid PEM header");var a=f[f.length-1].match(/[-]+[ ]*END CERTIFICATE[ ]*[-]+/);assert.ok(a,"invalid PEM footer");var d={};while(true){f=f.slice(1);e=f[0].match(/^([A-Za-z0-9-]+): (.+)$/);if(!e){break}d[e[1].toLowerCase()]=e[2]}f=f.slice(0,-1).join("");c=new Buffer(f,"base64");return(x509.read(c,b))}function write(d,h){var j=x509.write(d,h);var f="CERTIFICATE";var e=j.toString("base64");var g=e.length+(e.length/64)+18+16+f.length*2+10;var a=new Buffer(g);var k=0;k+=a.write("-----BEGIN "+f+"-----\n",k);for(var c=0;c<e.length;){var b=c+64;if(b>e.length){b=e.length}k+=a.write(e.slice(c,b),k);a[k++]=10;c=b}k+=a.write("-----END "+f+"-----\n",k);return(a.slice(0,k))};