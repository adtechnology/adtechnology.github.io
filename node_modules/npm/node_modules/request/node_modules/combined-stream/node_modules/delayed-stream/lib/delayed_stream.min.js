var Stream=require("stream").Stream;var util=require("util");module.exports=DelayedStream;function DelayedStream(){this.source=null;this.dataSize=0;this.maxDataSize=1024*1024;this.pauseStream=true;this._maxDataSizeExceeded=false;this._released=false;this._bufferedEvents=[]}util.inherits(DelayedStream,Stream);DelayedStream.create=function(e,c){var a=new this();c=c||{};for(var d in c){a[d]=c[d]}a.source=e;var b=e.emit;e.emit=function(){a._handleEmit(arguments);return b.apply(e,arguments)};e.on("error",function(){});if(a.pauseStream){e.pause()}return a};Object.defineProperty(DelayedStream.prototype,"readable",{configurable:true,enumerable:true,get:function(){return this.source.readable}});DelayedStream.prototype.setEncoding=function(){return this.source.setEncoding.apply(this.source,arguments)};DelayedStream.prototype.resume=function(){if(!this._released){this.release()}this.source.resume()};DelayedStream.prototype.pause=function(){this.source.pause()};DelayedStream.prototype.release=function(){this._released=true;this._bufferedEvents.forEach(function(a){this.emit.apply(this,a)}.bind(this));this._bufferedEvents=[]};DelayedStream.prototype.pipe=function(){var a=Stream.prototype.pipe.apply(this,arguments);this.resume();return a};DelayedStream.prototype._handleEmit=function(a){if(this._released){this.emit.apply(this,a);return}if(a[0]==="data"){this.dataSize+=a[1].length;this._checkIfMaxDataSizeExceeded()}this._bufferedEvents.push(a)};DelayedStream.prototype._checkIfMaxDataSizeExceeded=function(){if(this._maxDataSizeExceeded){return}if(this.dataSize<=this.maxDataSize){return}this._maxDataSizeExceeded=true;var a="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this.emit("error",new Error(a))};