var Stream=require("stream");exports=module.exports=through;through.through=through;function through(j,c,a){j=j||function(k){this.queue(k)};c=c||function(){this.queue(null)};var f=false,h=false,d=[],i=false;var g=new Stream();g.readable=g.writable=true;g.paused=false;g.autoDestroy=!(a&&a.autoDestroy===false);g.write=function(k){j.call(this,k);return !g.paused};function b(){while(d.length&&!g.paused){var k=d.shift();if(null===k){return g.emit("end")}else{g.emit("data",k)}}}g.queue=g.push=function(k){if(i){return g}if(k===null){i=true}d.push(k);b();return g};g.on("end",function(){g.readable=false;if(!g.writable&&g.autoDestroy){process.nextTick(function(){g.destroy()})}});function e(){g.writable=false;c.call(g);if(!g.readable&&g.autoDestroy){g.destroy()}}g.end=function(k){if(f){return}f=true;if(arguments.length){g.write(k)}e();return g};g.destroy=function(){if(h){return}h=true;f=true;d.length=0;g.writable=g.readable=false;g.emit("close");return g};g.pause=function(){if(g.paused){return}g.paused=true;return g};g.resume=function(){if(g.paused){g.paused=false;g.emit("resume")}b();if(!g.paused){g.emit("drain")}return g};return g};