module.exports=Extract;var tar=require("../tar.js"),fstream=require("fstream"),inherits=require("inherits"),path=require("path");function Extract(b){if(!(this instanceof Extract)){return new Extract(b)}tar.Parse.apply(this);if(typeof b!=="object"){b={path:b}}b.path=b.path||path.resolve("node-tar-extract");b.type="Directory";b.Directory=true;b.strip=+b.strip;if(!b.strip||b.strip<=0){b.strip=0}this._fst=fstream.Writer(b);this.pause();var a=this;a.on("entry",function(f){if(b.strip){var h=f.path.split("/").slice(b.strip).join("/");f.path=f.props.path=h;if(f.linkpath){var d=f.linkpath.split("/").slice(b.strip).join("/");f.linkpath=f.props.linkpath=d}}if(f.type==="Link"){f.linkpath=f.props.linkpath=path.join(b.path,path.join("/",f.props.linkpath))}if(f.type==="SymbolicLink"){var c=path.dirname(f.path)||"";var e=f.props.linkpath;var g=path.resolve(b.path,c,e);if(g.indexOf(b.path)!==0){e=path.join(b.path,path.join("/",e))}f.linkpath=f.props.linkpath=e}});this._fst.on("ready",function(){a.pipe(a._fst,{end:false});a.resume()});this._fst.on("error",function(c){a.emit("error",c)});this._fst.on("drain",function(){a.emit("drain")});this._fst.on("close",function(){a.emit("finish");a.emit("end");a.emit("close")})}inherits(Extract,tar.Parse);Extract.prototype._streamEnd=function(){var a=this;if(!a._ended||a._entry){a.error("unexpected eof")}a._fst.end()};