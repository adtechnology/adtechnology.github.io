module.exports=Entry;var TarHeader=require("./header.js"),tar=require("../tar"),assert=require("assert").ok,Stream=require("stream").Stream,inherits=require("inherits"),fstream=require("fstream").Abstract;function Entry(d,a,c){Stream.call(this);this.readable=true;this.writable=true;this._needDrain=false;this._paused=false;this._reading=false;this._ending=false;this._ended=false;this._remaining=0;this._abort=false;this._queue=[];this._index=0;this._queueLen=0;this._read=this._read.bind(this);this.props={};this._header=d;this._extended=a||{};this._global={};var b=this;Object.keys(c||{}).forEach(function(e){b._global[e]=c[e]});this._setProps()}inherits(Entry,Stream);Entry.prototype.write=function(b){if(this._ending){this.error("write() after end()",null,true)}if(this._remaining===0){this.error("invalid bytes past eof")}if(b.length>this._remaining){b=b.slice(0,this._remaining)}this._remaining-=b.length;var a=this._queueLen;this._queue.push(b);this._queueLen++;this._read();if(this._paused||a>0){this._needDrain=true;return false}return true};Entry.prototype.end=function(a){if(a){this.write(a)}this._ending=true;this._read()};Entry.prototype.pause=function(){this._paused=true;this.emit("pause")};Entry.prototype.resume=function(){this.emit("resume");this._paused=false;this._read();return this._queueLen-this._index>1};Entry.prototype._read=function(){if(this._paused||this._reading||this._ended){return}this._reading=true;while(this._index<this._queueLen&&!this._paused){var b=this._queue[this._index++];this.emit("data",b)}if(this._index>=this._queueLen){this._queue.length=this._queueLen=this._index=0;if(this._needDrain){this._needDrain=false;this.emit("drain")}if(this._ending){this._ended=true;this.emit("end")}}var a=this._maxQueueLen;if(this._queueLen>a&&this._index>0){a=Math.min(this._index,a);this._index-=a;this._queueLen-=a;this._queue=this._queue.slice(a)}this._reading=false};Entry.prototype._setProps=function(){var d=this._header,c=this._extended,a=this._global,i=this.props;var e=tar.fields;for(var g=0;e[g]!==null;g++){var j=e[g],b=d[j];if(typeof b!=="undefined"){i[j]=b}}[a,c].forEach(function(f){Object.keys(f).forEach(function(k){if(typeof f[k]!=="undefined"){i[k]=f[k]}})});["path","linkpath"].forEach(function(f){if(i.hasOwnProperty(f)){i[f]=i[f].split("\0")[0]}});["mtime","ctime","atime"].forEach(function(f){if(i.hasOwnProperty(f)){i[f]=new Date(i[f]*1000)}});var h;switch(tar.types[i.type]){case"OldFile":case"ContiguousFile":h="File";break;case"GNUDumpDir":h="Directory";break;case undefined:h="Unknown";break;case"Link":case"SymbolicLink":case"CharacterDevice":case"BlockDevice":case"Directory":case"FIFO":default:h=tar.types[i.type]}this.type=h;this.path=i.path;this.size=i.size;this._remaining=i.size};Entry.prototype.abort=function(){this._abort=true};Entry.prototype.warn=fstream.warn;Entry.prototype.error=fstream.error;