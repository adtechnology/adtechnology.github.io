module.exports=ProxyWriter;var Writer=require("./writer.js");var getType=require("./get-type.js");var inherits=require("inherits");var collect=require("./collect.js");var fs=require("fs");inherits(ProxyWriter,Writer);function ProxyWriter(b){var a=this;if(!(a instanceof ProxyWriter)){throw new Error("ProxyWriter must be called as constructor.")}a.props=b;a._needDrain=false;Writer.call(a,b)}ProxyWriter.prototype._stat=function(){var a=this;var c=a.props;var b=c.follow?"stat":"lstat";fs[b](c.path,function(f,e){var d;if(f||!e){d="File"}else{d=getType(e)}c[d]=true;c.type=a.type=d;a._old=e;a._addProxy(Writer(c,e))})};ProxyWriter.prototype._addProxy=function(c){var a=this;if(a._proxy){return a.error("proxy already set")}a._proxy=c;["ready","error","close","pipe","drain","warn"].forEach(function(d){c.on(d,a.emit.bind(a,d))});a.emit("proxy",c);var b=a._buffer;b.forEach(function(d){c[d[0]].apply(c,d[1])});a._buffer.length=0;if(a._needsDrain){a.emit("drain")}};ProxyWriter.prototype.add=function(a){collect(a);if(!this._proxy){this._buffer.push(["add",[a]]);this._needDrain=true;return false}return this._proxy.add(a)};ProxyWriter.prototype.write=function(a){if(!this._proxy){this._buffer.push(["write",[a]]);this._needDrain=true;return false}return this._proxy.write(a)};ProxyWriter.prototype.end=function(a){if(!this._proxy){this._buffer.push(["end",[a]]);return false}return this._proxy.end(a)};