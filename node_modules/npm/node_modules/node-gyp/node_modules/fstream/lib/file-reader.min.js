module.exports=FileReader;var fs=require("graceful-fs");var inherits=require("inherits");var Reader=require("./reader.js");var EOF={EOF:true};var CLOSE={CLOSE:true};inherits(FileReader,Reader);function FileReader(b){var a=this;if(!(a instanceof FileReader)){throw new Error("FileReader must be called as constructor.")}if(!((b.type==="Link"&&b.Link)||(b.type==="File"&&b.File))){throw new Error("Non-file type "+b.type)}a._buffer=[];a._bytesEmitted=0;Reader.call(a,b)}FileReader.prototype._getStream=function(){var a=this;var b=a._stream=fs.createReadStream(a._path,a.props);if(a.props.blksize){b.bufferSize=a.props.blksize}b.on("open",a.emit.bind(a,"open"));b.on("data",function(d){a._bytesEmitted+=d.length;if(!d.length){return}else{if(a._paused||a._buffer.length){a._buffer.push(d);a._read()}else{a.emit("data",d)}}});b.on("end",function(){if(a._paused||a._buffer.length){a._buffer.push(EOF);a._read()}else{a.emit("end")}if(a._bytesEmitted!==a.props.size){a.error("Didn't get expected byte count\nexpect: "+a.props.size+"\nactual: "+a._bytesEmitted)}});b.on("close",function(){if(a._paused||a._buffer.length){a._buffer.push(CLOSE);a._read()}else{a.emit("close")}});b.on("error",function(c){a.emit("error",c)});a._read()};FileReader.prototype._read=function(){var b=this;if(b._paused){return}if(!b._stream){return b._getStream()}if(b._buffer.length){var d=b._buffer;for(var e=0,a=d.length;e<a;e++){var f=d[e];if(f===EOF){b.emit("end")}else{if(f===CLOSE){b.emit("close")}else{b.emit("data",f)}}if(b._paused){b._buffer=d.slice(e);return}}b._buffer.length=0}};FileReader.prototype.pause=function(b){var a=this;if(a._paused){return}b=b||a;a._paused=true;if(a._stream){a._stream.pause()}a.emit("pause",b)};FileReader.prototype.resume=function(b){var a=this;if(!a._paused){return}b=b||a;a.emit("resume",b);a._paused=false;if(a._stream){a._stream.resume()}a._read()};