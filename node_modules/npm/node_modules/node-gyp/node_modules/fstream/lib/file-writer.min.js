module.exports=FileWriter;var fs=require("graceful-fs");var Writer=require("./writer.js");var inherits=require("inherits");var EOF={};inherits(FileWriter,Writer);function FileWriter(b){var a=this;if(!(a instanceof FileWriter)){throw new Error("FileWriter must be called as constructor.")}if(b.type!=="File"||!b.File){throw new Error("Non-file type "+b.type)}a._buffer=[];a._bytesWritten=0;Writer.call(this,b)}FileWriter.prototype._create=function(){var a=this;if(a._stream){return}var b={};if(a.props.flags){b.flags=a.props.flags}b.mode=Writer.filemode;if(a._old&&a._old.blksize){b.bufferSize=a._old.blksize}a._stream=fs.createWriteStream(a._path,b);a._stream.on("open",function(){a.ready=true;a._buffer.forEach(function(d){if(d===EOF){a._stream.end()}else{a._stream.write(d)}});a.emit("ready");a.emit("drain")});a._stream.on("error",function(c){a.emit("error",c)});a._stream.on("drain",function(){a.emit("drain")});a._stream.on("close",function(){a._finish()})};FileWriter.prototype.write=function(d){var a=this;a._bytesWritten+=d.length;if(!a.ready){if(!Buffer.isBuffer(d)&&typeof d!=="string"){throw new Error("invalid write data")}a._buffer.push(d);return false}var b=a._stream.write(d);if(b===false&&a._stream._queue){return a._stream._queue.length<=2}else{return b}};FileWriter.prototype.end=function(b){var a=this;if(b){a.write(b)}if(!a.ready){a._buffer.push(EOF);return false}return a._stream.end()};FileWriter.prototype._finish=function(){var a=this;if(typeof a.size==="number"&&a._bytesWritten!==a.size){a.error("Did not get expected byte count.\nexpect: "+a.size+"\nactual: "+a._bytesWritten)}Writer.prototype._finish.call(a)};