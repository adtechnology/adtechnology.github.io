module.exports=LinkWriter;var fs=require("graceful-fs");var Writer=require("./writer.js");var inherits=require("inherits");var path=require("path");var rimraf=require("rimraf");inherits(LinkWriter,Writer);function LinkWriter(b){var a=this;if(!(a instanceof LinkWriter)){throw new Error("LinkWriter must be called as constructor.")}if(!((b.type==="Link"&&b.Link)||(b.type==="SymbolicLink"&&b.SymbolicLink))){throw new Error("Non-link type "+b.type)}if(b.linkpath===""){b.linkpath="."}if(!b.linkpath){a.error("Need linkpath property to create "+b.type)}Writer.call(this,b)}LinkWriter.prototype._create=function(){var a=this;var d=a.type==="Link"||process.platform==="win32";var c=d?"link":"symlink";var b=d?path.resolve(a.dirname,a.linkpath):a.linkpath;if(d){return clobber(a,b,c)}fs.readlink(a._path,function(f,e){if(e&&e===b){return finish(a)}clobber(a,b,c)})};function clobber(a,b,c){rimraf(a._path,function(d){if(d){return a.error(d)}create(a,b,c)})}function create(a,b,c){fs[c](b,a._path,function(d){if(d){if((d.code==="ENOENT"||d.code==="EACCES"||d.code==="EPERM")&&process.platform==="win32"){a.ready=true;a.emit("ready");a.emit("end");a.emit("close");a.end=a._finish=function(){}}else{return a.error(d)}}finish(a)})}function finish(a){a.ready=true;a.emit("ready");if(a._ended&&!a._finished){a._finish()}}LinkWriter.prototype.end=function(){this._ended=true;if(this.ready){this._finished=true;this._finish()}};