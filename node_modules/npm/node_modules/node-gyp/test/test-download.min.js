"use strict";var fs=require("fs");var http=require("http");var https=require("https");var test=require("tape");var install=require("../lib/install");test("download over http",function(a){a.plan(2);var c=http.createServer(function(e,d){a.strictEqual(e.headers["user-agent"],"node-gyp v42 (node "+process.version+")");d.end("ok");c.close()});var b="127.0.0.1";c.listen(0,b,function(){var d=this.address().port;var f={opts:{},version:"42"};var e="http://"+b+":"+d;var g=install.test.download(f,{},e);g.on("response",function(i){var h="";i.setEncoding("utf8");i.on("data",function(j){h+=j});i.on("end",function(){a.strictEqual(h,"ok")})})})});test("download over https with custom ca",function(e){e.plan(3);var d=fs.readFileSync(__dirname+"/fixtures/server.crt","utf8");var c=fs.readFileSync(__dirname+"/fixtures/server.key","utf8");var f=__dirname+"/fixtures/ca.crt";var a=install.test.readCAFile(f);e.strictEqual(a.length,1);var b={ca:a,cert:d,key:c};var h=https.createServer(b,function(j,i){e.strictEqual(j.headers["user-agent"],"node-gyp v42 (node "+process.version+")");i.end("ok");h.close()});h.on("clientError",function(i){throw i});var g="127.0.0.1";h.listen(8000,g,function(){var i=this.address().port;var k={opts:{cafile:f},version:"42"};var j="https://"+g+":"+i;var l=install.test.download(k,{},j);l.on("response",function(n){var m="";n.setEncoding("utf8");n.on("data",function(o){m+=o});n.on("end",function(){e.strictEqual(m,"ok")})})})});test("download with missing cafile",function(b){b.plan(1);var a={opts:{cafile:"no.such.file"}};try{install.test.download(a,{},"http://bad/")}catch(c){b.ok(/no.such.file/.test(c.message))}});test("check certificate splitting",function(b){var a=install.test.readCAFile(__dirname+"/fixtures/ca-bundle.crt");b.plan(2);b.strictEqual(a.length,2);b.notStrictEqual(a[0],a[1])});