exports.parse=exports.decode=decode;exports.stringify=exports.encode=encode;exports.safe=safe;exports.unsafe=unsafe;var eol=typeof process!=="undefined"&&process.platform==="win32"?"\r\n":"\n";function encode(e,c){var b=[];var a="";if(typeof c==="string"){c={section:c,whitespace:false}}else{c=c||{};c.whitespace=c.whitespace===true}var d=c.whitespace?" = ":"=";Object.keys(e).forEach(function(f,g,h){var i=e[f];if(i&&Array.isArray(i)){i.forEach(function(j){a+=safe(f+"[]")+d+safe(j)+"\n"})}else{if(i&&typeof i==="object"){b.push(f)}else{a+=safe(f)+d+safe(i)+eol}}});if(c.section&&a.length){a="["+safe(c.section)+"]"+eol+a}b.forEach(function(g,h,i){var f=dotSplit(g).join("\\.");var j=(c.section?c.section+".":"")+f;var l=encode(e[g],{section:j,whitespace:c.whitespace});if(a.length&&l.length){a+=eol}a+=l});return a}function dotSplit(a){return a.replace(/\1/g,"\u0002LITERAL\\1LITERAL\u0002").replace(/\\\./g,"\u0001").split(/\./).map(function(b){return b.replace(/\1/g,"\\.").replace(/\2LITERAL\\1LITERAL\2/g,"\u0001")})}function decode(f){var b={};var e=b;var d=null;var c=/^\[([^\]]*)\]$|^([^=]+)(=(.*))?$/i;var a=f.split(/[\r\n]+/g);a.forEach(function(g,i,k){if(!g||g.match(/^\s*[;#]/)){return}var h=g.match(c);if(!h){return}if(h[1]!==undefined){d=unsafe(h[1]);e=b[d]=b[d]||{};return}var j=unsafe(h[2]);var l=h[3]?unsafe(h[4]):true;switch(l){case"true":case"false":case"null":l=JSON.parse(l)}if(j.length>2&&j.slice(-2)==="[]"){j=j.substring(0,j.length-2);if(!e[j]){e[j]=[]}else{if(!Array.isArray(e[j])){e[j]=[e[j]]}}}if(Array.isArray(e[j])){e[j].push(l)}else{e[j]=l}});Object.keys(b).filter(function(i,j,m){if(!b[i]||typeof b[i]!=="object"||Array.isArray(b[i])){return false}var o=dotSplit(i);var n=b;var h=o.pop();var g=h.replace(/\\\./g,".");o.forEach(function(l,k,p){if(!n[l]||typeof n[l]!=="object"){n[l]={}}n=n[l]});if(n===b&&g===h){return false}n[g]=b[i];return true}).forEach(function(g,h,i){delete b[g]});return b}function isQuoted(a){return(a.charAt(0)==='"'&&a.slice(-1)==='"')||(a.charAt(0)==="'"&&a.slice(-1)==="'")}function safe(a){return(typeof a!=="string"||a.match(/[=\r\n]/)||a.match(/^\[/)||(a.length>1&&isQuoted(a))||a!==a.trim())?JSON.stringify(a):a.replace(/;/g,"\\;").replace(/#/g,"\\#")}function unsafe(g,d){g=(g||"").trim();if(isQuoted(g)){if(g.charAt(0)==="'"){g=g.substr(1,g.length-2)}try{g=JSON.parse(g)}catch(e){}}else{var b=false;var j="";for(var f=0,a=g.length;f<a;f++){var h=g.charAt(f);if(b){if("\\;#".indexOf(h)!==-1){j+=h}else{j+="\\"+h}b=false}else{if(";#".indexOf(h)!==-1){break}else{if(h==="\\"){b=true}else{j+=h}}}}if(b){j+="\\"}return j.trim()}return g};