module.exports=rebuild;var readInstalled=require("read-installed");var semver=require("semver");var log=require("npmlog");var npm=require("./npm.js");var npa=require("npm-package-arg");var usage=require("./utils/usage");var output=require("./utils/output.js");rebuild.usage=usage("rebuild","npm rebuild [[<@scope>/<name>]...]");rebuild.completion=require("./utils/completion/installed-deep.js");function rebuild(b,a){var c={depth:npm.config.get("depth"),dev:true};readInstalled(npm.prefix,c,function(g,e){log.info("readInstalled",typeof e);if(g){return a(g)}var f=filter(e,b);var d=Object.keys(f).filter(function(h){return h!==npm.prefix});if(!d.length){return a()}log.silly("rebuild set",d);cleanBuild(d,f,a)})}function cleanBuild(b,c,a){npm.commands.build(b,function(d){if(d){return a(d)}output(b.map(function(e){return c[e]+" "+e}).join("\n"));a()})}function filter(d,g,h,a){if(!h){h={}}if(!a){a=new Set()}if(h.hasOwnProperty(d.path)){return h}if(a.has(d)){return h}a.add(d);var k;if(!g.length){k=true}else{if(d.name&&d._id){for(var e=0,c=g.length;e<c;e++){var m=g[e];var f=npa(m);var b=f.name;var j=f.rawSpec;if(b!==d.name){continue}if(!semver.satisfies(d.version,j,true)){continue}k=true;break}}}if(k&&d._id){log.verbose("rebuild","path, id",[d.path,d._id]);h[d.path]=d._id}Object.keys(d.dependencies||{}).forEach(function(l){var i=d.dependencies[l];if(typeof i==="string"){return}filter(i,g,h,a)});return h};