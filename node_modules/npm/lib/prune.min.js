module.exports=prune;module.exports.Pruner=Pruner;prune.usage="npm prune [[<@scope>/]<pkg>...] [--production]";var npm=require("./npm.js");var log=require("npmlog");var util=require("util");var moduleName=require("./utils/module-name.js");var Installer=require("./install.js").Installer;var isExtraneous=require("./install/is-extraneous.js");var isOnlyDev=require("./install/is-only-dev.js");var removeDeps=require("./install/deps.js").removeDeps;var loadExtraneous=require("./install/deps.js").loadExtraneous;var chain=require("slide").chain;var computeMetadata=require("./install/deps.js").computeMetadata;prune.completion=require("./utils/completion/installed-deep.js");function prune(c,b){var a=!!npm.config.get("dry-run");new Pruner(".",a,c).run(b)}function Pruner(c,a,b){Installer.call(this,c,a,b);this.autoPrune=true}util.inherits(Pruner,Installer);Pruner.prototype.loadAllDepsIntoIdealTree=function(c){log.silly("uninstall","loadAllDepsIntoIdealTree");var b=this.progress["loadIdealTree:loadAllDepsIntoIdealTree"];var g=[];computeMetadata(this.idealTree);var i=this;var e=npm.config.get("production")||/^prod(uction)?$/.test(npm.config.get("only"));function h(k){if(isExtraneous(k)){return true}if(!e){return false}return isOnlyDev(k)}function d(k){return moduleName(k)}function f(k){return i.args.length===0||i.args.indexOf(k)!==-1}function j(k){return{name:k}}var a=this.idealTree.children.filter(h).map(d).filter(f).map(j);g.push([removeDeps,a,this.idealTree,null],[loadExtraneous,this.idealTree,b.newGroup("loadExtraneous")]);chain(g,c)};Pruner.prototype.runPreinstallTopLevelLifecycles=function(a){a()};Pruner.prototype.runPostinstallTopLevelLifecycles=function(a){a()};Pruner.prototype.saveToDependencies=function(a){a()};