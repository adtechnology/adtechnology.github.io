"use strict";const BB=require("bluebird");const exec=require("child_process").execFile;const spawn=require("./spawn");const npm=require("../npm.js");const which=require("which");const git=npm.config.get("git");const assert=require("assert");const log=require("npmlog");const noProgressTillDone=require("./no-progress-while-running.js").tillDone;exports.spawn=spawnGit;exports.exec=BB.promisify(execGit);exports.chainableExec=chainableExec;exports.whichAndExec=whichAndExec;function prefixGitArgs(){return process.platform==="win32"?["-c","core.longpaths=true"]:[]}function execGit(c,b,a){log.info("git",c);const d=prefixGitArgs().concat(c||[]);return exec(git,d,b,noProgressTillDone(a))}function spawnGit(b,a){log.info("git",b);return spawn(git,prefixGitArgs().concat(b||[]),a)}function chainableExec(){var a=Array.prototype.slice.call(arguments);return[execGit].concat(a)}function whichAndExec(c,b,a){assert.equal(typeof a,"function","no callback provided");which(git,function(d){if(d){d.code="ENOGIT";return a(d)}execGit(c,b,a)})};