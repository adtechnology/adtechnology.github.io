module.exports=installedShallow;var npm=require("../../npm.js");var fs=require("graceful-fs");var path=require("path");var readJson=require("read-package-json");var asyncMap=require("slide").asyncMap;function installedShallow(a,c,e){if(typeof e!=="function"){e=c;c=null}var g=a.conf;var h=g.argv.remain;if(h.length>3){return e()}var i;var b;var j=npm.dir;var d=npm.globalDir;if(npm.config.get("global")){i=[];f()}else{fs.readdir(j,function(l,k){i=(k||[]).filter(function(m){return m.charAt(0)!=="."});f()})}fs.readdir(d,function(l,k){b=(k||[]).filter(function(m){return m.charAt(0)!=="."});f()});function f(){if(!i||!b){return}filterInstalled(i,b,c,e)}}function filterInstalled(d,g,f,a){var h;var c;if(!f){h=d;c=g;return e()}asyncMap(d,function(j,i){readJson(path.join(npm.dir,j,"package.json"),function(l,k){if(!k||!f(k)){return i(null,[])}return i(null,k.name)})},function(j,i){h=i||[];e()});var b=npm.globalDir;asyncMap(g,function(j,i){readJson(path.join(b,j,"package.json"),function(l,k){if(!k||!f(k)){return i(null,[])}return i(null,k.name)})},function(j,i){c=i||[];e()});function e(){if(!c||!h){return}if(!npm.config.get("global")){c=c.map(function(i){return[i,"-g"]})}console.error("filtered",h,c);return a(null,h.concat(c))}};