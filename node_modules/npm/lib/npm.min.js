(function(){if(typeof WScript!=="undefined"){WScript.echo('npm does not work when run\nwith the Windows Scripting Host\n\n"cd" to a different directory,\nor type "npm.cmd <args>",\nor type "node npm <args>".');WScript.quit(1);return}var f=require("../lib/utils/unsupported.js");f.checkForBrokenNode();var x=require("graceful-fs");var p=x.gracefulify(require("fs"));var i=require("events").EventEmitter;var u=module.exports=new i();var c=require("./config/core.js");var g=require("npmlog");var h=require("util").inspect;process.on("log",function(T){try{return g[T].apply(g,[].slice.call(arguments,1))}catch(j){g.verbose("attempt to log "+h(arguments)+" crashed: "+j.message)}});var L=require("path");var b=require("abbrev");var v=require("which");var r=require("glob");var Q=require("rimraf");var F=require("lazy-property");var o=require("./utils/parse-json.js");var n=require("./config/reg-client.js");var w=require("./config/cmd-list").aliases;var m=require("./config/cmd-list").cmdList;var D=require("./config/cmd-list").plumbing;var q=require("./utils/output.js");var e=require("./utils/metrics.js").start;var a=require("./utils/perf.js");a.emit("time","npm");a.on("timing",function(j,T){g.timing(j,"Completed in",T+"ms")});u.config={loaded:false,get:function(){throw new Error("npm.load() required")},set:function(){throw new Error("npm.load() required")}};u.commands={};u.limit={fetch:10,action:50};u.lockfileVersion=1;u.rollbacks=[];try{var O=o(p.readFileSync(L.join(__dirname,"../package.json"))+"");u.name=O.name;u.version=O.version}catch(K){try{g.info("error reading version",K)}catch(N){}u.version=K}var k={};var B=Object.keys(w);var s=["isntall","verison"];var G=m.concat(B).filter(function(j){return D.indexOf(j)===-1});var l=b(G);G=u.fullList=G.filter(function(j){return s.indexOf(j)===-1});var S;var P;Object.keys(l).concat(D).forEach(function H(j){Object.defineProperty(u.commands,j,{get:function(){if(!z){throw new Error("Call npm.load(config, cb) before using this command.\nSee the README.md or bin/npm-cli.js for example usage.")}var T=u.deref(j);if(j==="la"||j==="ll"){u.config.set("long",true)}u.command=j;if(k[T]){return k[T]}var U=require(L.join(__dirname,T+".js"));k[T]=function(){var V=Array.prototype.slice.call(arguments,0);if(typeof V[V.length-1]!=="function"){V.push(M)}if(V.length===1){V.unshift([])}Array(V[0]).forEach(function(W){if(/^[\u2010-\u2015\u2212\uFE58\uFE63\uFF0D]/.test(W)){g.error("arg","Argument starts with non-ascii dash, this is probably invalid:",W)}});if(!S){S=[T].concat(V[0]).map(function(W){if(W&&W.match&&W.match(/\/|\\/)){return"[REDACTED]"}else{return W}}).filter(function(W){return W&&W.match}).join(" ");if(P){u.registry.refer=S}}U.apply(u,V)};Object.keys(U).forEach(function(V){k[T][V]=U[V]});return k[T]},enumerable:G.indexOf(j)!==-1,configurable:true});if(j.match(/-([a-z])/)){H(j.replace(/-([a-z])/g,function(U,T){return T.toUpperCase()}))}});function M(T,j){g.disableProgress();if(T){console.error(T.stack||T.message)}else{q(j)}}u.deref=function(T){if(!T){return""}if(T.match(/[A-Z]/)){T=T.replace(/([A-Z])/g,function(U){return"-"+U.toLowerCase()})}if(D.indexOf(T)!==-1){return T}var j=l[T];while(w[j]){j=w[j]}return j};var z=false;var R=false;var C=null;var J=[];function E(j){J.forEach(function(T){process.nextTick(T.bind(u,j,u))});J.length=0}u.load=function(T,U){if(!U&&typeof T==="function"){U=T;T={}}if(!U){U=function(){}}if(!T){T={}}J.push(U);if(z||C){return j(C)}if(R){return}R=true;var V=true;function j(X){if(C){return}C=X;if(X){return U(X)}if(u.config.get("force")){g.warn("using --force","I sure hope you know what you are doing.")}u.config.loaded=true;z=true;E(C=X);V=V&&u.config.get("onload-script");if(V){try{require(V)}catch(W){g.warn("onload-script","failed to require onload script",V);g.warn("onload-script",W)}V=false}}g.pause();I(u,T,j)};function I(U,T,j){v(process.argv[0],function(X,W){if(!X&&W.toUpperCase()!==process.execPath.toUpperCase()){g.verbose("node symlink",W);process.execPath=W;process.installPrefix=L.resolve(W,"..","..")}var V=L.resolve(__dirname,"..","npmrc");c.load(T,V,function(ae,Z){if(ae===Z){ae=null}U.config=Z;if(ae){return j(ae)}if(!Z.get("global")&&Z.sources.project&&Z.sources.project.type!=="ini"){g.verbose("config","Skipping project config: %s. (matches userconfig)",Z.localPrefix+"/.npmrc")}var ab=Z.get("user-agent")||"";ab=ab.replace(/\{node-version\}/gi,process.version);ab=ab.replace(/\{npm-version\}/gi,U.version);ab=ab.replace(/\{platform\}/gi,process.platform);ab=ab.replace(/\{arch\}/gi,process.arch);Z.set("user-agent",ab);if(Z.get("metrics-registry")==null){Z.set("metrics-registry",Z.get("registry"))}var Y=Z.get("color");if(U.config.get("timing")&&U.config.get("loglevel")==="notice"){g.level="timing"}else{g.level=Z.get("loglevel")}g.heading=Z.get("heading")||"npm";g.stream=Z.get("logstream");switch(Y){case"always":U.color=true;break;case false:U.color=false;break;default:U.color=process.stdout.isTTY&&process.env.TERM!=="dumb";break}if(U.color){g.enableColor()}else{g.disableColor()}if(Z.get("unicode")){g.enableUnicode()}else{g.disableUnicode()}if(Z.get("progress")&&process.stderr.isTTY&&process.env.TERM!=="dumb"){g.enableProgress()}else{g.disableProgress()}r(L.resolve(U.cache,"_logs","*-debug.log"),function(ag,af){if(ag){return j(ag)}while(af.length>=U.config.get("logs-max")){Q.sync(af[0]);af.splice(0,1)}});g.resume();var ad=U.config.get("umask");U.modes={exec:parseInt("0777",8)&(~ad),file:parseInt("0666",8)&(~ad),umask:ad};var ac=Object.getOwnPropertyDescriptor(Z,"globalPrefix");Object.defineProperty(U,"globalPrefix",ac);var aa=Object.getOwnPropertyDescriptor(Z,"localPrefix");Object.defineProperty(U,"localPrefix",aa);Z.set("scope",d(Z.get("scope")));U.projectScope=Z.get("scope")||d(t(U.prefix));F(U,"registry",function(){P=true;var ag=require("npm-registry-client");var af=new ag(n(U,g,U.config));af.version=U.version;af.refer=S;return af});e();return j(null,U)})})}Object.defineProperty(u,"prefix",{get:function(){return u.config.get("global")?u.globalPrefix:u.localPrefix},set:function(T){var j=u.config.get("global")?"globalPrefix":"localPrefix";u[j]=T;return T},enumerable:true});Object.defineProperty(u,"bin",{get:function(){if(u.config.get("global")){return u.globalBin}return L.resolve(u.root,".bin")},enumerable:true});Object.defineProperty(u,"globalBin",{get:function(){var j=u.globalPrefix;if(process.platform!=="win32"){j=L.resolve(j,"bin")}return j}});Object.defineProperty(u,"dir",{get:function(){if(u.config.get("global")){return u.globalDir}return L.resolve(u.prefix,"node_modules")},enumerable:true});Object.defineProperty(u,"globalDir",{get:function(){return(process.platform!=="win32")?L.resolve(u.globalPrefix,"lib","node_modules"):L.resolve(u.globalPrefix,"node_modules")},enumerable:true});Object.defineProperty(u,"root",{get:function(){return u.dir}});Object.defineProperty(u,"cache",{get:function(){return u.config.get("cache")},set:function(j){return u.config.set("cache",j)},enumerable:true});var y;var A=require("crypto").randomBytes(4).toString("hex");Object.defineProperty(u,"tmp",{get:function(){if(!y){y="npm-"+process.pid+"-"+A}return L.resolve(u.config.get("tmp"),y)},enumerable:true});Object.getOwnPropertyNames(u.commands).forEach(function(j){if(u.hasOwnProperty(j)||j==="config"){return}Object.defineProperty(u,j,{get:function(){return function(){var U=Array.prototype.slice.call(arguments,0);var T=M;if(U.length===1&&Array.isArray(U[0])){U=U[0]}if(typeof U[U.length-1]==="function"){T=U.pop()}u.commands[j](U,T)}},enumerable:false,configurable:true})});if(require.main===module){require("../bin/npm-cli.js")}function d(j){return(!j||j[0]==="@")?j:("@"+j)}function t(V){try{var T=JSON.parse(p.readFileSync(L.join(V,"package.json")));if(typeof T.name!=="string"){return""}var j=T.name.indexOf("/");if(j===-1){return""}return T.name.slice(0,j)}catch(U){return""}}})();