module.exports=unpublish;var log=require("npmlog");var npm=require("./npm.js");var readJson=require("read-package-json");var path=require("path");var mapToRegistry=require("./utils/map-to-registry.js");var npa=require("npm-package-arg");var getPublishConfig=require("./utils/get-publish-config.js");var output=require("./utils/output.js");unpublish.usage="npm unpublish [<@scope>/]<pkg>[@<version>]";unpublish.completion=function(b,a){if(b.conf.argv.remain.length>=3){return a()}npm.commands.whoami([],true,function(f,e){if(f){return a()}var d=encodeURIComponent(e);if(!d){return a()}var c="-/by-user/"+d;mapToRegistry(c,npm.config,function(i,h,g){if(i){return a(i)}npm.registry.get(h,{auth:g},function(l,k){k=k[d];if(!k||!k.length){return a()}var j=npa(b.partialWord).name;k=k.filter(function(m){return m.indexOf(j)===0});if(k.length>1){return a(null,k)}mapToRegistry(k[0],npm.config,function(o,n,m){if(o){return a(o)}npm.registry.get(n,{auth:m},function(r,q){if(r){return a(r)}var p=Object.keys(q.versions);if(!p.length){return a(null,k)}return a(null,p.map(function(s){return k[0]+"@"+s}))})})})})})};function unpublish(d,a){if(d.length>1){return a(unpublish.usage)}var c=d.length?npa(d[0]):{};var f=c.name;var b=c.rawSpec;log.silly("unpublish","args[0]",d[0]);log.silly("unpublish","thing",c);if(!b&&!npm.config.get("force")){return a("Refusing to delete entire project.\nRun with --force to do this.\n"+unpublish.usage)}if(!f||path.resolve(f)===npm.localPrefix){var e=path.join(npm.localPrefix,"package.json");return readJson(e,function(h,g){if(h&&h.code!=="ENOENT"&&h.code!=="ENOTDIR"){return a(h)}if(h){return a("Usage:\n"+unpublish.usage)}log.verbose("unpublish",g);gotProject(g.name,g.version,g.publishConfig,a)})}return gotProject(f,b,a)}function gotProject(g,c,f,b){if(typeof b!=="function"){b=f;f=null}function a(i){if(i){return b(i)}output("- "+g+(c?"@"+c:""));b()}var h=getPublishConfig(f,npm.config,npm.registry);var e=h.config;var d=h.client;mapToRegistry(g,e,function(l,j,i){if(l){return a(l)}var k={version:c,auth:i};d.unpublish(j,k,a)})};