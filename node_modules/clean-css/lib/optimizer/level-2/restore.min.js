var shallowClone=require("./clone").shallow;var Token=require("../../tokenizer/token");var Marker=require("../../tokenizer/marker");function isInheritOnly(b){for(var c=0,a=b.length;c<a;c++){var d=b[c][1];if(d!="inherit"&&d!=Marker.COMMA&&d!=Marker.FORWARD_SLASH){return false}}return true}function background(o,k,h){var j=o.components;var n=[];var p,q;function f(i){Array.prototype.unshift.apply(n,i.value)}function a(i){var r=k[i.name];if(r.doubleValues&&r.defaultValue.length==1){return i.value[0][1]==r.defaultValue[0]&&(i.value[1]?i.value[1][1]==r.defaultValue[0]:true)}else{if(r.doubleValues&&r.defaultValue.length!=1){return i.value[0][1]==r.defaultValue[0]&&(i.value[1]?i.value[1][1]:i.value[0][1])==r.defaultValue[1]}else{return i.value[0][1]==r.defaultValue}}}for(var g=j.length-1;g>=0;g--){var m=j[g];var d=a(m);if(m.name=="background-clip"){var b=j[g-1];var c=a(b);p=m.value[0][1]==b.value[0][1];q=!p&&((c&&!d)||(!c&&!d)||(!c&&d&&m.value[0][1]!=b.value[0][1]));if(p){f(b)}else{if(q){f(m);f(b)}}g--}else{if(m.name=="background-size"){var e=j[g-1];var l=a(e);p=!l&&d;q=!p&&(l&&!d||!l&&!d);if(p){f(e)}else{if(q){f(m);n.unshift([Token.PROPERTY_VALUE,Marker.FORWARD_SLASH]);f(e)}else{if(e.value.length==1){f(e)}}}g--}else{if(d||k[m.name].multiplexLastOnly&&!h){continue}f(m)}}}if(n.length===0&&o.value.length==1&&o.value[0][1]=="0"){n.push(o.value[0])}if(n.length===0){n.push([Token.PROPERTY_VALUE,k[o.name].defaultValue])}if(isInheritOnly(n)){return[n[0]]}return n}function borderRadius(j,g){if(j.multiplex){var b=shallowClone(j);var c=shallowClone(j);for(var e=0;e<4;e++){var h=j.components[e];var k=shallowClone(j);k.value=[h.value[0]];b.components.push(k);var d=shallowClone(j);d.value=[h.value[1]||h.value[0]];c.components.push(d)}var a=fourValues(b,g);var f=fourValues(c,g);if(a.length==f.length&&a[0][1]==f[0][1]&&(a.length>1?a[1][1]==f[1][1]:true)&&(a.length>2?a[2][1]==f[2][1]:true)&&(a.length>3?a[3][1]==f[3][1]:true)){return a}else{return a.concat([[Token.PROPERTY_VALUE,Marker.FORWARD_SLASH]]).concat(f)}}else{return fourValues(j,g)}}function font(g,b){var f=g.components;var e=[];var c;var a=0;var d=0;if(g.value[0][1].indexOf(Marker.INTERNAL)===0){g.value[0][1]=g.value[0][1].substring(Marker.INTERNAL.length);return g.value}while(a<4){c=f[a];if(c.value[0][1]!=b[c.name].defaultValue){Array.prototype.push.apply(e,c.value)}a++}Array.prototype.push.apply(e,f[a].value);a++;if(f[a].value[0][1]!=b[f[a].name].defaultValue){Array.prototype.push.apply(e,[[Token.PROPERTY_VALUE,Marker.FORWARD_SLASH]]);Array.prototype.push.apply(e,f[a].value)}a++;while(f[a].value[d]){e.push(f[a].value[d]);if(f[a].value[d+1]){e.push([Token.PROPERTY_VALUE,Marker.COMMA])}d++}if(isInheritOnly(e)){return[e[0]]}return e}function fourValues(e){var d=e.components;var c=d[0].value[0];var b=d[1].value[0];var a=d[2].value[0];var f=d[3].value[0];if(c[1]==b[1]&&c[1]==a[1]&&c[1]==f[1]){return[c]}else{if(c[1]==a[1]&&b[1]==f[1]){return[c,b]}else{if(b[1]==f[1]){return[c,b,a]}else{return[c,b,a,f]}}}}function multiplex(a){return function(u,q){if(!u.multiplex){return a(u,q,true)}var w=0;var s=[];var p={};var h,d;for(h=0,d=u.components[0].value.length;h<d;h++){if(u.components[0].value[h][1]==Marker.COMMA){w++}}for(h=0;h<=w;h++){var v=shallowClone(u);for(var g=0,c=u.components.length;g<c;g++){var f=u.components[g];var r=shallowClone(f);v.components.push(r);for(var e=p[r.name]||0,b=f.value.length;e<b;e++){if(f.value[e][1]==Marker.COMMA){p[r.name]=e+1;break}r.value.push(f.value[e])}}var o=h==w;var t=a(v,q,o);Array.prototype.push.apply(s,t);if(h<w){s.push([Token.PROPERTY_VALUE,Marker.COMMA])}}return s}}function withoutDefaults(f,a){var e=f.components;var d=[];for(var c=e.length-1;c>=0;c--){var b=e[c];var g=a[b.name];if(b.value[0][1]!=g.defaultValue||("keepUnlessDefault" in g)&&!isDefault(e,a,g.keepUnlessDefault)){d.unshift(b.value[0])}}if(d.length===0){d.push([Token.PROPERTY_VALUE,a[f.name].defaultValue])}if(isInheritOnly(d)){return[d[0]]}return d}function isDefault(f,c,b){var d;var e,a;for(e=0,a=f.length;e<a;e++){d=f[e];if(d.name==b&&d.value[0][1]==c[b].defaultValue){return true}}return false}module.exports={background:background,borderRadius:borderRadius,font:font,fourValues:fourValues,multiplex:multiplex,withoutDefaults:withoutDefaults};