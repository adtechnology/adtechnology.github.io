var mergeAdjacent=require("./merge-adjacent");var mergeMediaQueries=require("./merge-media-queries");var mergeNonAdjacentByBody=require("./merge-non-adjacent-by-body");var mergeNonAdjacentBySelector=require("./merge-non-adjacent-by-selector");var reduceNonAdjacent=require("./reduce-non-adjacent");var removeDuplicateFontAtRules=require("./remove-duplicate-font-at-rules");var removeDuplicateMediaQueries=require("./remove-duplicate-media-queries");var removeDuplicates=require("./remove-duplicates");var removeUnusedAtRules=require("./remove-unused-at-rules");var restructure=require("./restructure");var optimizeProperties=require("./properties/optimize");var OptimizationLevel=require("../../options/optimization-level").OptimizationLevel;var Token=require("../../tokenizer/token");function removeEmpty(i){for(var j=0,g=i.length;j<g;j++){var f=i[j];var h=false;switch(f[0]){case Token.RULE:h=f[1].length===0||f[2].length===0;break;case Token.NESTED_BLOCK:removeEmpty(f[2]);h=f[2].length===0;break;case Token.AT_RULE:h=f[1].length===0;break;case Token.AT_RULE_BLOCK:h=f[2].length===0}if(h){i.splice(j,1);j--;g--}}}function recursivelyOptimizeBlocks(i,j){for(var k=0,g=i.length;k<g;k++){var l=i[k];if(l[0]==Token.NESTED_BLOCK){var h=/@(-moz-|-o-|-webkit-)?keyframes/.test(l[1][0][1]);level2Optimize(l[2],j,!h)}}}function recursivelyOptimizeProperties(h,i){for(var j=0,g=h.length;j<g;j++){var f=h[j];switch(f[0]){case Token.RULE:optimizeProperties(f[2],true,true,i);break;case Token.NESTED_BLOCK:recursivelyOptimizeProperties(f[2],i)}}}function level2Optimize(j,k,g){var i=k.options.level[OptimizationLevel.Two];var h;var l;recursivelyOptimizeBlocks(j,k);recursivelyOptimizeProperties(j,k);if(i.removeDuplicateRules){removeDuplicates(j,k)}if(i.mergeAdjacentRules){mergeAdjacent(j,k)}if(i.reduceNonAdjacentRules){reduceNonAdjacent(j,k)}if(i.mergeNonAdjacentRules&&i.mergeNonAdjacentRules!="body"){mergeNonAdjacentBySelector(j,k)}if(i.mergeNonAdjacentRules&&i.mergeNonAdjacentRules!="selector"){mergeNonAdjacentByBody(j,k)}if(i.restructureRules&&i.mergeAdjacentRules&&g){restructure(j,k);mergeAdjacent(j,k)}if(i.restructureRules&&!i.mergeAdjacentRules&&g){restructure(j,k)}if(i.removeDuplicateFontRules){removeDuplicateFontAtRules(j,k)}if(i.removeDuplicateMediaBlocks){removeDuplicateMediaQueries(j,k)}if(i.removeUnusedAtRules){removeUnusedAtRules(j,k)}if(i.mergeMedia){h=mergeMediaQueries(j,k);for(l=h.length-1;l>=0;l--){level2Optimize(h[l][2],k,false)}}if(i.removeEmpty){removeEmpty(j)}return j}module.exports=level2Optimize;