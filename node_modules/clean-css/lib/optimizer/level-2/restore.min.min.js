var shallowClone=require("./clone").shallow;var Token=require("../../tokenizer/token");var Marker=require("../../tokenizer/marker");function isInheritOnly(e){for(var h=0,f=e.length;h<f;h++){var g=e[h][1];if(g!="inherit"&&g!=Marker.COMMA&&g!=Marker.FORWARD_SLASH){return false}}return true}function background(s,w,y){var x=s.components;var t=[];var r,i;function A(a){Array.prototype.unshift.apply(t,a.value)}function F(a){var b=w[a.name];if(b.doubleValues&&b.defaultValue.length==1){return a.value[0][1]==b.defaultValue[0]&&(a.value[1]?a.value[1][1]==b.defaultValue[0]:true)}else{if(b.doubleValues&&b.defaultValue.length!=1){return a.value[0][1]==b.defaultValue[0]&&(a.value[1]?a.value[1][1]:a.value[0][1])==b.defaultValue[1]}else{return a.value[0][1]==b.defaultValue}}}for(var z=x.length-1;z>=0;z--){var u=x[z];var C=F(u);if(u.name=="background-clip"){var E=x[z-1];var D=F(E);r=u.value[0][1]==E.value[0][1];i=!r&&((D&&!C)||(!D&&!C)||(!D&&C&&u.value[0][1]!=E.value[0][1]));if(r){A(E)}else{if(i){A(u);A(E)}}z--}else{if(u.name=="background-size"){var B=x[z-1];var v=F(B);r=!v&&C;i=!r&&(v&&!C||!v&&!C);if(r){A(B)}else{if(i){A(u);t.unshift([Token.PROPERTY_VALUE,Marker.FORWARD_SLASH]);A(B)}else{if(B.value.length==1){A(B)}}}z--}else{if(C||w[u.name].multiplexLastOnly&&!y){continue}A(u)}}}if(t.length===0&&s.value.length==1&&s.value[0][1]=="0"){t.push(s.value[0])}if(t.length===0){t.push([Token.PROPERTY_VALUE,w[s.name].defaultValue])}if(isInheritOnly(t)){return[t[0]]}return t}function borderRadius(l,n){if(l.multiplex){var s=shallowClone(l);var r=shallowClone(l);for(var p=0;p<4;p++){var m=l.components[p];var i=shallowClone(l);i.value=[m.value[0]];s.components.push(i);var q=shallowClone(l);q.value=[m.value[1]||m.value[0]];r.components.push(q)}var t=fourValues(s,n);var o=fourValues(r,n);if(t.length==o.length&&t[0][1]==o[0][1]&&(t.length>1?t[1][1]==o[1][1]:true)&&(t.length>2?t[2][1]==o[2][1]:true)&&(t.length>3?t[3][1]==o[3][1]:true)){return t}else{return t.concat([[Token.PROPERTY_VALUE,Marker.FORWARD_SLASH]]).concat(o)}}else{return fourValues(l,n)}}function font(j,h){var k=j.components;var l=[];var n;var i=0;var m=0;if(j.value[0][1].indexOf(Marker.INTERNAL)===0){j.value[0][1]=j.value[0][1].substring(Marker.INTERNAL.length);return j.value}while(i<4){n=k[i];if(n.value[0][1]!=h[n.name].defaultValue){Array.prototype.push.apply(l,n.value)}i++}Array.prototype.push.apply(l,k[i].value);i++;if(k[i].value[0][1]!=h[k[i].name].defaultValue){Array.prototype.push.apply(l,[[Token.PROPERTY_VALUE,Marker.FORWARD_SLASH]]);Array.prototype.push.apply(l,k[i].value)}i++;while(k[i].value[m]){l.push(k[i].value[m]);if(k[i].value[m+1]){l.push([Token.PROPERTY_VALUE,Marker.COMMA])}m++}if(isInheritOnly(l)){return[l[0]]}return l}function fourValues(j){var k=j.components;var l=k[0].value[0];var g=k[1].value[0];var h=k[2].value[0];var i=k[3].value[0];if(l[1]==g[1]&&l[1]==h[1]&&l[1]==i[1]){return[l]}else{if(l[1]==h[1]&&g[1]==i[1]){return[l,g]}else{if(g[1]==i[1]){return[l,g,h]}else{return[l,g,h,i]}}}}function multiplex(b){return function(D,i){if(!D.multiplex){return b(D,i,true)}var B=0;var F=[];var j={};var l,y;for(l=0,y=D.components[0].value.length;l<y;l++){if(D.components[0].value[l][1]==Marker.COMMA){B++}}for(l=0;l<=B;l++){var C=shallowClone(D);for(var m=0,z=D.components.length;m<z;m++){var n=D.components[m];var a=shallowClone(n);C.components.push(a);for(var x=j[a.name]||0,A=n.value.length;x<A;x++){if(n.value[x][1]==Marker.COMMA){j[a.name]=x+1;break}a.value.push(n.value[x])}}var k=l==B;var E=b(C,i,k);Array.prototype.push.apply(F,E);if(l<B){F.push([Token.PROPERTY_VALUE,Marker.COMMA])}}return F}}function withoutDefaults(k,i){var l=k.components;var m=[];for(var n=l.length-1;n>=0;n--){var h=l[n];var j=i[h.name];if(h.value[0][1]!=j.defaultValue||("keepUnlessDefault" in j)&&!isDefault(l,i,j.keepUnlessDefault)){m.unshift(h.value[0])}}if(m.length===0){m.push([Token.PROPERTY_VALUE,i[k.name].defaultValue])}if(isInheritOnly(m)){return[m[0]]}return m}function isDefault(i,l,g){var k;var j,h;for(j=0,h=i.length;j<h;j++){k=i[j];if(k.name==g&&k.value[0][1]==l[g].defaultValue){return true}}return false}module.exports={background:background,borderRadius:borderRadius,font:font,fourValues:fourValues,multiplex:multiplex,withoutDefaults:withoutDefaults};