var canReorder=require("./reorderable").canReorder;var canReorderSingle=require("./reorderable").canReorderSingle;var extractProperties=require("./extract-properties");var rulesOverlap=require("./rules-overlap");var serializeRules=require("../../writer/one-time").rules;var OptimizationLevel=require("../../options/optimization-level").OptimizationLevel;var Token=require("../../tokenizer/token");function mergeMediaQueries(m,b){var r=b.options.level[OptimizationLevel.Two].mergeSemantically;var k=b.cache.specificity;var d={};var p=[];for(var u=m.length-1;u>=0;u--){var g=m[u];if(g[0]!=Token.NESTED_BLOCK){continue}var A=serializeRules(g[1]);var f=d[A];if(!f){f=[];d[A]=f}f.push(u)}for(var B in d){var h=d[B];positionLoop:for(var t=h.length-1;t>0;t--){var w=h[t];var o=m[w];var l=h[t-1];var c=m[l];directionLoop:for(var y=1;y>=-1;y-=2){var n=y==1;var s=n?w+1:l-1;var a=n?l:w;var x=n?1:-1;var q=n?o:c;var z=n?c:o;var v=extractProperties(q);while(s!=a){var e=extractProperties(m[s]);s+=x;if(r&&allSameRulePropertiesCanBeReordered(v,e,k)){continue}if(!canReorder(v,e,k)){continue directionLoop}}z[2]=n?q[2].concat(z[2]):z[2].concat(q[2]);q[2]=[];p.push(z);continue positionLoop}}}return p}function allSameRulePropertiesCanBeReordered(a,g,o){var b;var n;var k;var e;var h,d;var f,c;for(h=0,d=a.length;h<d;h++){b=a[h];n=b[5];for(f=0,c=g.length;f<c;f++){k=g[f];e=k[5];if(rulesOverlap(n,e,true)&&!canReorderSingle(b,k,o)){return false}}}return true}module.exports=mergeMediaQueries;