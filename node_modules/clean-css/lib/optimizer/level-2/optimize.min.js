var mergeAdjacent=require("./merge-adjacent");var mergeMediaQueries=require("./merge-media-queries");var mergeNonAdjacentByBody=require("./merge-non-adjacent-by-body");var mergeNonAdjacentBySelector=require("./merge-non-adjacent-by-selector");var reduceNonAdjacent=require("./reduce-non-adjacent");var removeDuplicateFontAtRules=require("./remove-duplicate-font-at-rules");var removeDuplicateMediaQueries=require("./remove-duplicate-media-queries");var removeDuplicates=require("./remove-duplicates");var removeUnusedAtRules=require("./remove-unused-at-rules");var restructure=require("./restructure");var optimizeProperties=require("./properties/optimize");var OptimizationLevel=require("../../options/optimization-level").OptimizationLevel;var Token=require("../../tokenizer/token");function removeEmpty(d){for(var c=0,a=d.length;c<a;c++){var b=d[c];var e=false;switch(b[0]){case Token.RULE:e=b[1].length===0||b[2].length===0;break;case Token.NESTED_BLOCK:removeEmpty(b[2]);e=b[2].length===0;break;case Token.AT_RULE:e=b[1].length===0;break;case Token.AT_RULE_BLOCK:e=b[2].length===0}if(e){d.splice(c,1);c--;a--}}}function recursivelyOptimizeBlocks(f,e){for(var d=0,b=f.length;d<b;d++){var c=f[d];if(c[0]==Token.NESTED_BLOCK){var a=/@(-moz-|-o-|-webkit-)?keyframes/.test(c[1][0][1]);level2Optimize(c[2],e,!a)}}}function recursivelyOptimizeProperties(e,d){for(var c=0,a=e.length;c<a;c++){var b=e[c];switch(b[0]){case Token.RULE:optimizeProperties(b[2],true,true,d);break;case Token.NESTED_BLOCK:recursivelyOptimizeProperties(b[2],d)}}}function level2Optimize(e,d,b){var f=d.options.level[OptimizationLevel.Two];var a;var c;recursivelyOptimizeBlocks(e,d);recursivelyOptimizeProperties(e,d);if(f.removeDuplicateRules){removeDuplicates(e,d)}if(f.mergeAdjacentRules){mergeAdjacent(e,d)}if(f.reduceNonAdjacentRules){reduceNonAdjacent(e,d)}if(f.mergeNonAdjacentRules&&f.mergeNonAdjacentRules!="body"){mergeNonAdjacentBySelector(e,d)}if(f.mergeNonAdjacentRules&&f.mergeNonAdjacentRules!="selector"){mergeNonAdjacentByBody(e,d)}if(f.restructureRules&&f.mergeAdjacentRules&&b){restructure(e,d);mergeAdjacent(e,d)}if(f.restructureRules&&!f.mergeAdjacentRules&&b){restructure(e,d)}if(f.removeDuplicateFontRules){removeDuplicateFontAtRules(e,d)}if(f.removeDuplicateMediaBlocks){removeDuplicateMediaQueries(e,d)}if(f.removeUnusedAtRules){removeUnusedAtRules(e,d)}if(f.mergeMedia){a=mergeMediaQueries(e,d);for(c=a.length-1;c>=0;c--){level2Optimize(a[c][2],d,false)}}if(f.removeEmpty){removeEmpty(e)}return e}module.exports=level2Optimize;