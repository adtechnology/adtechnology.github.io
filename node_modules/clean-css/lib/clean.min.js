var level0Optimize=require("./optimizer/level-0/optimize");var level1Optimize=require("./optimizer/level-1/optimize");var level2Optimize=require("./optimizer/level-2/optimize");var validator=require("./optimizer/validator");var compatibilityFrom=require("./options/compatibility");var fetchFrom=require("./options/fetch");var formatFrom=require("./options/format").formatFrom;var inlineFrom=require("./options/inline");var inlineRequestFrom=require("./options/inline-request");var inlineTimeoutFrom=require("./options/inline-timeout");var OptimizationLevel=require("./options/optimization-level").OptimizationLevel;var optimizationLevelFrom=require("./options/optimization-level").optimizationLevelFrom;var rebaseFrom=require("./options/rebase");var rebaseToFrom=require("./options/rebase-to");var inputSourceMapTracker=require("./reader/input-source-map-tracker");var readSources=require("./reader/read-sources");var serializeStyles=require("./writer/simple");var serializeStylesAndSourceMap=require("./writer/source-maps");var CleanCSS=module.exports=function CleanCSS(a){a=a||{};this.options={compatibility:compatibilityFrom(a.compatibility),fetch:fetchFrom(a.fetch),format:formatFrom(a.format),inline:inlineFrom(a.inline),inlineRequest:inlineRequestFrom(a.inlineRequest),inlineTimeout:inlineTimeoutFrom(a.inlineTimeout),level:optimizationLevelFrom(a.level),rebase:rebaseFrom(a.rebase),rebaseTo:rebaseToFrom(a.rebaseTo),returnPromise:!!a.returnPromise,sourceMap:!!a.sourceMap,sourceMapInlineSources:!!a.sourceMapInlineSources}};CleanCSS.prototype.minify=function(a,d,c){var b=this.options;if(b.returnPromise){return new Promise(function(f,e){minify(a,b,d,function(h,g){return h?e(h):f(g)})})}else{return minify(a,b,d,c)}};function minify(a,b,g,d){var e=typeof g!="function"?g:null;var f=typeof d=="function"?d:(typeof g=="function"?g:null);var c={stats:{efficiency:0,minifiedSize:0,originalSize:0,startedAt:Date.now(),timeSpent:0},cache:{specificity:{}},errors:[],inlinedStylesheets:[],inputSourceMapTracker:inputSourceMapTracker(),localOnly:!f,options:b,source:null,sourcesContent:{},validator:validator(b.compatibility),warnings:[]};if(e){c.inputSourceMapTracker.track(undefined,e)}return runner(c.localOnly)(function(){return readSources(a,c,function(k){var j=c.options.sourceMap?serializeStylesAndSourceMap:serializeStyles;var h=optimize(k,c);var l=j(h,c);var i=withMetadata(l,c);return f?f(c.errors.length>0?c.errors:null,i):i})})}function runner(a){return a?function(b){return b()}:process.nextTick}function optimize(c,b){var a;a=level0Optimize(c,b);a=OptimizationLevel.One in b.options.level?level1Optimize(c,b):c;a=OptimizationLevel.Two in b.options.level?level2Optimize(c,b,true):a;return a}function withMetadata(a,b){a.stats=calculateStatsFrom(a.styles,b);a.errors=b.errors;a.inlinedStylesheets=b.inlinedStylesheets;a.warnings=b.warnings;return a}function calculateStatsFrom(c,b){var a=Date.now();var d=a-b.stats.startedAt;delete b.stats.startedAt;b.stats.timeSpent=d;b.stats.efficiency=1-c.length/b.stats.originalSize;b.stats.minifiedSize=c.length;return b.stats};