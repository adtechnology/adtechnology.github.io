var SourceMapGenerator=require("source-map").SourceMapGenerator;var all=require("./helpers").all;var lineBreak=require("os").EOL;var isRemoteResource=require("../utils/is-remote-resource");var isWindows=process.platform=="win32";var NIX_SEPARATOR_PATTERN=/\//g;var UNKNOWN_SOURCE="$stdin";var WINDOWS_SEPARATOR="\\";function store(d,a){var f=typeof a=="string";var c=f?a:a[1];var e=f?null:a[2];var b=d.wrap;b(d,c);track(d,c,e);d.output.push(c)}function wrap(b,a){if(b.column+a.length>b.format.wrapAt){track(b,lineBreak,false);b.output.push(lineBreak)}}function track(c,a,d){var b=a.split("\n");if(d){trackAllMappings(c,d)}c.line+=b.length-1;c.column=b.length>1?0:(c.column+b.pop().length)}function trackAllMappings(c,d){for(var b=0,a=d.length;b<a;b++){trackMapping(c,d[b])}}function trackMapping(g,d){var b=d[0];var e=d[1];var c=d[2];var f=c;var a=f||UNKNOWN_SOURCE;if(isWindows&&f&&!isRemoteResource(f)){a=f.replace(NIX_SEPARATOR_PATTERN,WINDOWS_SEPARATOR)}g.outputMap.addMapping({generated:{line:g.line,column:g.column},source:a,original:{line:b,column:e}});if(g.inlineSources&&(c in g.sourcesContent)){g.outputMap.setSourceContent(a,g.sourcesContent[c])}}function serializeStylesAndSourceMap(c,a){var b={column:0,format:a.options.format,indentBy:0,indentWith:"",inlineSources:a.options.sourceMapInlineSources,line:1,output:[],outputMap:new SourceMapGenerator(),sourcesContent:a.sourcesContent,spaceAfterClosingBrace:a.options.compatibility.properties.spaceAfterClosingBrace,store:store,wrap:a.options.format.wrapAt?wrap:function(){}};all(b,c);return{sourceMap:b.outputMap,styles:b.output.join("")}}module.exports=serializeStylesAndSourceMap;