var lineBreak=require("os").EOL;var emptyCharacter="";var Breaks=require("../options/format").Breaks;var Spaces=require("../options/format").Spaces;var Marker=require("../tokenizer/marker");var Token=require("../tokenizer/token");function supportsAfterClosingBrace(a){return a[1][1]=="background"||a[1][1]=="transform"||a[1][1]=="src"}function afterClosingBrace(a,b){return a[b][1][a[b][1].length-1]==Marker.CLOSE_ROUND_BRACKET}function afterComma(a,b){return a[b][1]==Marker.COMMA}function afterSlash(a,b){return a[b][1]==Marker.FORWARD_SLASH}function beforeComma(a,b){return a[b+1]&&a[b+1][1]==Marker.COMMA}function beforeSlash(a,b){return a[b+1]&&a[b+1][1]==Marker.FORWARD_SLASH}function inFilter(a){return a[1][1]=="filter"||a[1][1]=="-ms-filter"}function disallowsSpace(b,a,c){return !b.spaceAfterClosingBrace&&supportsAfterClosingBrace(a)&&afterClosingBrace(a,c)||beforeSlash(a,c)||afterSlash(a,c)||beforeComma(a,c)||afterComma(a,c)}function rules(d,e){var b=d.store;for(var c=0,a=e.length;c<a;c++){b(d,e[c]);if(c<a-1){b(d,comma(d))}}}function body(d,e){var c=lastPropertyIndex(e);for(var b=0,a=e.length;b<a;b++){property(d,e,b,c)}}function lastPropertyIndex(b){var a=b.length-1;for(;a>=0;a--){if(b[a][0]!=Token.COMMENT){break}}return a}function property(c,g,f,h){var i=c.store;var d=g[f];var b=d[2][0]==Token.PROPERTY_BLOCK;var a=f<h||b;var e=f===h;switch(d[0]){case Token.AT_RULE:i(c,d);i(c,semicolon(c,Breaks.AfterProperty,false));break;case Token.AT_RULE_BLOCK:rules(c,d[1]);i(c,openBrace(c,Breaks.AfterRuleBegins,true));body(c,d[2]);i(c,closeBrace(c,Breaks.AfterRuleEnds,false,e));break;case Token.COMMENT:i(c,d);break;case Token.PROPERTY:i(c,d[1]);i(c,colon(c));value(c,d);i(c,a?semicolon(c,Breaks.AfterProperty,e):emptyCharacter)}}function value(e,d){var b=e.store;var c,a;if(d[2][0]==Token.PROPERTY_BLOCK){b(e,openBrace(e,Breaks.AfterBlockBegins,false));body(e,d[2][1]);b(e,closeBrace(e,Breaks.AfterBlockEnds,false,true))}else{for(c=2,a=d.length;c<a;c++){b(e,d[c]);if(c<a-1&&(inFilter(d)||!disallowsSpace(e,d,c))){b(e,Marker.SPACE)}}}}function allowsBreak(b,a){return b.format&&b.format.breaks[a]}function allowsSpace(b,a){return b.format&&b.format.spaces[a]}function openBrace(b,a,c){if(b.format){b.indentBy+=b.format.indentBy;b.indentWith=b.format.indentWith.repeat(b.indentBy);return(c&&allowsSpace(b,Spaces.BeforeBlockBegins)?Marker.SPACE:emptyCharacter)+Marker.OPEN_CURLY_BRACKET+(allowsBreak(b,a)?lineBreak:emptyCharacter)+b.indentWith}else{return Marker.OPEN_CURLY_BRACKET}}function closeBrace(b,a,d,c){if(b.format){b.indentBy-=b.format.indentBy;b.indentWith=b.format.indentWith.repeat(b.indentBy);return(allowsBreak(b,Breaks.AfterProperty)||d&&allowsBreak(b,Breaks.BeforeBlockEnds)?lineBreak:emptyCharacter)+b.indentWith+Marker.CLOSE_CURLY_BRACKET+(c?emptyCharacter:(allowsBreak(b,a)?lineBreak:emptyCharacter)+b.indentWith)}else{return Marker.CLOSE_CURLY_BRACKET}}function colon(a){return a.format?Marker.COLON+(allowsSpace(a,Spaces.BeforeValue)?Marker.SPACE:emptyCharacter):Marker.COLON}function semicolon(b,a,c){return b.format?Marker.SEMICOLON+(c||!allowsBreak(b,a)?emptyCharacter:lineBreak+b.indentWith):Marker.SEMICOLON}function comma(a){return a.format?Marker.COMMA+(allowsBreak(a,Breaks.BetweenSelectors)?lineBreak:emptyCharacter)+a.indentWith:Marker.COMMA}function all(e,g){var b=e.store;var d;var f;var c,a;for(c=0,a=g.length;c<a;c++){d=g[c];f=c==a-1;switch(d[0]){case Token.AT_RULE:b(e,d);b(e,semicolon(e,Breaks.AfterAtRule,f));break;case Token.AT_RULE_BLOCK:rules(e,d[1]);b(e,openBrace(e,Breaks.AfterRuleBegins,true));body(e,d[2]);b(e,closeBrace(e,Breaks.AfterRuleEnds,false,f));break;case Token.NESTED_BLOCK:rules(e,d[1]);b(e,openBrace(e,Breaks.AfterBlockBegins,true));all(e,d[2]);b(e,closeBrace(e,Breaks.AfterBlockEnds,true,f));break;case Token.COMMENT:b(e,d);b(e,allowsBreak(e,Breaks.AfterComment)?lineBreak:emptyCharacter);break;case Token.RULE:rules(e,d[1]);b(e,openBrace(e,Breaks.AfterRuleBegins,true));body(e,d[2]);b(e,closeBrace(e,Breaks.AfterRuleEnds,false,f));break}}}module.exports={all:all,body:body,property:property,rules:rules,value:value};