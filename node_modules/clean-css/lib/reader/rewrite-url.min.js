var path=require("path");var url=require("url");var DOUBLE_QUOTE='"';var SINGLE_QUOTE="'";var URL_PREFIX="url(";var URL_SUFFIX=")";var QUOTE_PREFIX_PATTERN=/^["']/;var QUOTE_SUFFIX_PATTERN=/["']$/;var ROUND_BRACKETS_PATTERN=/[\(\)]/;var URL_PREFIX_PATTERN=/^url\(/i;var URL_SUFFIX_PATTERN=/\)$/;var WHITESPACE_PATTERN=/\s/;var isWindows=process.platform=="win32";function rebase(b,a){if(!a){return b}if(isAbsolute(b)&&!isRemote(a.toBase)){return b}if(isRemote(b)||isSVGMarker(b)||isInternal(b)){return b}if(isData(b)){return"'"+b+"'"}if(isRemote(a.toBase)){return url.resolve(a.toBase,b)}return a.absolute?normalize(absolute(b,a)):normalize(relative(b,a))}function isAbsolute(a){return path.isAbsolute(a)}function isSVGMarker(a){return a[0]=="#"}function isInternal(a){return/^\w+:\w+/.test(a)}function isRemote(a){return/^[^:]+?:\/\//.test(a)||a.indexOf("//")===0}function isData(a){return a.indexOf("data:")===0}function absolute(b,a){return path.resolve(path.join(a.fromBase||"",b)).replace(a.toBase,"")}function relative(b,a){return path.relative(a.toBase,path.join(a.fromBase||"",b))}function normalize(a){return isWindows?a.replace(/\\/g,"/"):a}function quoteFor(a){if(a.indexOf(SINGLE_QUOTE)>-1){return DOUBLE_QUOTE}else{if(a.indexOf(DOUBLE_QUOTE)>-1){return SINGLE_QUOTE}else{if(hasWhitespace(a)||hasRoundBrackets(a)){return SINGLE_QUOTE}else{return""}}}}function hasWhitespace(a){return WHITESPACE_PATTERN.test(a)}function hasRoundBrackets(a){return ROUND_BRACKETS_PATTERN.test(a)}function rewriteUrl(e,f,d){var b=e.replace(URL_PREFIX_PATTERN,"").replace(URL_SUFFIX_PATTERN,"").trim();var c=b.replace(QUOTE_PREFIX_PATTERN,"").replace(QUOTE_SUFFIX_PATTERN,"").trim();var a=b[0]==SINGLE_QUOTE||b[0]==DOUBLE_QUOTE?b[0]:quoteFor(c);return d?rebase(c,f):URL_PREFIX+a+rebase(c,f)+a+URL_SUFFIX}module.exports=rewriteUrl;