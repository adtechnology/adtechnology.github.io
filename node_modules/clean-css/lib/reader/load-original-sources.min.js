var fs=require("fs");var path=require("path");var isAllowedResource=require("./is-allowed-resource");var hasProtocol=require("../utils/has-protocol");var isRemoteResource=require("../utils/is-remote-resource");function loadOriginalSources(a,c){var b={callback:c,fetch:a.options.fetch,index:0,inline:a.options.inline,inlineRequest:a.options.inlineRequest,inlineTimeout:a.options.inlineTimeout,localOnly:a.localOnly,rebaseTo:a.options.rebaseTo,sourcesContent:a.sourcesContent,uriToSource:uriToSourceMapping(a.inputSourceMapTracker.all()),warnings:a.warnings};return a.options.sourceMap&&a.options.sourceMapInlineSources?doLoadOriginalSources(b):c()}function uriToSourceMapping(g){var b={};var d;var e;var f;var c,a;for(f in g){d=g[f];for(c=0,a=d.sources.length;c<a;c++){e=d.sources[c];f=d.sourceContentFor(e,true);b[e]=f}}return b}function doLoadOriginalSources(e){var a=Object.keys(e.uriToSource);var c;var d;var b;for(b=a.length;e.index<b;e.index++){c=a[e.index];d=e.uriToSource[c];if(d){e.sourcesContent[c]=d}else{return loadOriginalSource(c,e)}}return e.callback()}function loadOriginalSource(b,c){var a;if(isRemoteResource(b)){return loadOriginalSourceFromRemoteUri(b,c,function(d){c.index++;c.sourcesContent[b]=d;return doLoadOriginalSources(c)})}else{a=loadOriginalSourceFromLocalUri(b,c);c.index++;c.sourcesContent[b]=a;return doLoadOriginalSources(c)}}function loadOriginalSourceFromRemoteUri(d,e,c){var b=isAllowedResource(d,true,e.inline);var a=!hasProtocol(d);if(e.localOnly){e.warnings.push('Cannot fetch remote resource from "'+d+'" as no callback given.');return c(null)}else{if(a){e.warnings.push('Cannot fetch "'+d+'" as no protocol given.');return c(null)}else{if(!b){e.warnings.push('Cannot fetch "'+d+'" as resource is not allowed.');return c(null)}}}e.fetch(d,e.inlineRequest,e.inlineTimeout,function(f,g){if(f){e.warnings.push('Missing original source at "'+d+'" - '+f)}c(g)})}function loadOriginalSourceFromLocalUri(b,c){var a=isAllowedResource(b,false,c.inline);var d=path.resolve(c.rebaseTo,b);if(!fs.existsSync(d)||!fs.statSync(d).isFile()){c.warnings.push('Ignoring local source map at "'+d+'" as resource is missing.');return null}else{if(!a){c.warnings.push('Cannot fetch "'+d+'" as resource is not allowed.');return null}}return fs.readFileSync(d,"utf8")}module.exports=loadOriginalSources;